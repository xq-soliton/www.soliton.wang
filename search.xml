<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>ElasticSearch_单机_Install</title>
      <link href="/2018/12/17/ElasticSearch-%E5%8D%95%E6%9C%BA-Install/"/>
      <url>/2018/12/17/ElasticSearch-%E5%8D%95%E6%9C%BA-Install/</url>
      
        <content type="html"><![CDATA[<p>什么是ElasticSearch,根据其中文文档可以简单定义为以下三点,与传统的关系型数据库还是有较大的区别。<br>一个分布式的实施文档存储,每个字段可以被索引与搜索。<br>一个分布式实时分析搜索引擎。<br>可以胜任上百个服务节点的扩展，并支持PB级别的结构化或者非结构化数据。<br><a id="more"></a></p><h3>系统环境<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">OS</span>     ：<span class="selector-tag">CentOS</span> <span class="selector-tag">Linux</span> <span class="selector-tag">release</span> 7<span class="selector-class">.3</span><span class="selector-class">.1611</span> (<span class="selector-tag">Core</span>)</span><br><span class="line"><span class="selector-tag">kernel</span> : 3<span class="selector-class">.10</span><span class="selector-class">.0-514</span><span class="selector-class">.el7</span><span class="selector-class">.x86_64</span></span><br><span class="line"><span class="selector-tag">Memory</span> : 3<span class="selector-tag">G</span></span><br></pre></td></tr></table></figure><br><br><h3>关闭防火墙 &amp;&amp; SELINUX<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">stop</span> firewalld</span><br><span class="line">systemctl disable firewalld</span><br><span class="line">setenforce <span class="number">0</span></span><br><span class="line">sed -i <span class="string">"s/enforcing/disabled/g"</span> /etc/selinux/<span class="built_in">config</span></span><br></pre></td></tr></table></figure><br><br><h3>ELK版本信息:<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Elasticsearch</span>：6<span class="selector-class">.5</span><span class="selector-class">.3</span></span><br><span class="line"><span class="selector-tag">Kibana</span> ：6<span class="selector-class">.5</span><span class="selector-class">.3</span></span><br><span class="line"><span class="selector-tag">Logstash</span> ：6<span class="selector-class">.5</span><span class="selector-class">.3</span></span><br></pre></td></tr></table></figure><br><br><h3>安装目录:  /elk<br><h3>下载ElasticSearch安装包</h3><br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https:<span class="regexp">//</span>artifacts.elastic.co<span class="regexp">/downloads/</span>elasticsearch<span class="regexp">/elasticsearch-6.5.3.tar.gz</span></span><br></pre></td></tr></table></figure><br><br>提示：安装ES需要JAVA支持,最低jdk1.8,因为ES是用Java写的,所以咯还是安装jdk1.8吧!其他版本的我没有试过,编译安装或是rpm都行,编译安装记得配置JAVA全局变量,在这里我就略过了。<br><br><h3>Elasticsearch安装及配置：</h3><br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tar zxvf /elk/elasticsearch<span class="number">-6.5</span><span class="number">.3</span>.tar.gz</span><br><span class="line">cd /elk/elasticsearch<span class="number">-6.5</span><span class="number">.3</span></span><br></pre></td></tr></table></figure><br><br><h3>修改elasticsearch配置文件,默认全是注释的</h3><p>vim /elk/elasticsearch-6.5.3/config/elasticsearch.yml<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">+集群名,你配置所有的都需要一样</span><br><span class="line">cluster<span class="selector-class">.name</span>: soliton-es-cluster</span><br><span class="line"></span><br><span class="line">+安装elasticsearch的主机名</span><br><span class="line">node<span class="selector-class">.name</span>: test_a</span><br><span class="line"></span><br><span class="line">+ES存放数据的目录</span><br><span class="line">path<span class="selector-class">.data</span>: /data/es-data</span><br><span class="line"></span><br><span class="line">+存放ES日志的目录</span><br><span class="line">path<span class="selector-class">.logs</span>: /logs/es</span><br><span class="line"></span><br><span class="line">-<span class="string">"true"</span> 锁住内存,使内存不会在swap中使用</span><br><span class="line"><span class="selector-id">#bootstrap</span><span class="selector-class">.memory_lock</span>: true <span class="comment">//我用的是虚拟机开了很多台，内存不够用所有我注释了</span></span><br><span class="line"></span><br><span class="line">+允许访问的IP</span><br><span class="line">network<span class="selector-class">.host</span>: <span class="number">0.0</span>.<span class="number">0.0</span></span><br><span class="line"></span><br><span class="line">+ES启动端口</span><br><span class="line">http<span class="selector-class">.port</span>: <span class="number">9200</span></span><br></pre></td></tr></table></figure></p><h3>创建存放数据和日志的目录</h3><br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -<span class="selector-tag">p</span> /data/es-data</span><br><span class="line">mkdir -<span class="selector-tag">p</span> /logs/es</span><br></pre></td></tr></table></figure><br><br><h3>修改ES内存参数配置文件</h3><p>vim  /elk/elasticsearch-6.5.3/config/jvm.options<br><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-Xms2g        <span class="comment">//开启，代表内存。所以还要根据你的需要设置</span></span><br><span class="line">-Xmx2g        <span class="comment">//开启</span></span><br><span class="line">```</span><br><span class="line"></span><br><span class="line">&lt;h3&gt;ES内存分配设置&lt;/h3&gt;</span><br><span class="line">vim /etc/profile</span><br></pre></td></tr></table></figure></p><p>export ES_HEAP_SIZE=2g        #我虚拟机3G内存我给了2G,启动的时候回读取这个环境变量<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">&lt;h3&gt;</span>配置linux资源限制&lt;/h3&gt;</span><br><span class="line">-在启动的时候如果没有配置这个它会报:</span><br><span class="line">bound <span class="built_in">or</span> publishing <span class="keyword">to</span> <span class="keyword">a</span> non-loopback address, enforcing bootstrap checks</span><br><span class="line">ERROR: [<span class="number">2</span>] bootstrap checks failed</span><br><span class="line">[<span class="number">1</span>]: <span class="built_in">max</span> <span class="keyword">file</span> descriptors [<span class="number">65535</span>] <span class="keyword">for</span> elasticsearch process <span class="keyword">is</span> too low, increase <span class="keyword">to</span> at least [<span class="number">65536</span>]</span><br><span class="line">[<span class="number">2</span>]: <span class="built_in">max</span> virtual memory areas <span class="keyword">vm</span>.max_map_count [<span class="number">65530</span>] <span class="keyword">is</span> too low, increase <span class="keyword">to</span> at least [<span class="number">262144</span>]</span><br></pre></td></tr></table></figure></p><p>vim /etc/security/limits.conf</p><ul><li>soft nofile 65536</li><li>hard nofile 65536<br><br>vim /etc/sysctl.conf</li></ul><p>vm.max_map_count=655360</p><p>执行 sysctl -p 生效,或是重启<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>创建elk用户<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>#以root用户来创建新的用户 ， groupadd 添加一个用户组<br>groupadd elasticsearch </p><p>#添加一个用户，-g是在用户组下 -p是密码<br>useradd elasticsearch -g elasticsearch -p elasticsearch<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;h3&gt;赋予目录所有者&lt;/h3&gt;</span><br><span class="line">```</span><br><span class="line">chown -R elasticsearch<span class="selector-class">.elasticsearch</span> /elk</span><br><span class="line">chown -R elasticsearch<span class="selector-class">.elasticsearch</span> /data-es-data</span><br><span class="line">chown -R elasticsearch<span class="selector-class">.elasticsearc</span>/logs/es</span><br></pre></td></tr></table></figure></p><p></p><h3>用elasticsearch用户启动ElasticSearch</h3><br><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">su elasticsearch </span><br><span class="line"></span><br><span class="line"><span class="meta-keyword">/elk/</span>elasticsearch<span class="number">-6.5</span><span class="number">.3</span><span class="meta-keyword">/bin/</span>elasticsearch &gt;&gt; <span class="meta-keyword">/elk/</span>elk.log</span><br><span class="line"></span><br><span class="line">另开终端,查看启动过程</span><br><span class="line"></span><br><span class="line">tail -f <span class="meta-keyword">/elk/</span>elk.log</span><br><span class="line"></span><br><span class="line">访问 http:<span class="comment">//IP:9200 即可访问</span></span><br><span class="line"><span class="params">&lt;h3&gt;</span>配置ElasticSearch启动脚本,实现自启动<span class="params">&lt;/h3&gt;</span></span><br></pre></td></tr></table></figure><p></p><p>如果java是用编译安装的在脚本开头记得加环境变量</p><p>export JAVA_HOME=/usr/java/jdk1.8.0_112<br>export JAVA_BIN=/usr/java/jdk1.8.0_112/bin<br>export PATH=$PATH:$JAVA_HOME/bin<br>export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar<br>export JAVA_HOME JAVA_BIN PATH CLASSPATH<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">脚本位置<span class="symbol">:/etc/init</span>.d/</span><br></pre></td></tr></table></figure></p><p>vim /etc/init.d/elasticsearch</p><p>#!/bin/sh</p><p>#chkconfig: 2345 80 05</p><p>#description: elasticsearch</p><p>case “$1” in<br>start)<br>su elasticsearch&lt;&lt;elk<br>cd /elk/elasticsearch-6.5.3/<br>./bin/elasticsearch -d<br>elk<br>echo “elasticsearch startup”<br>;;<br>stop)<br>es_pid=<code>ps aux|grep elasticsearch | grep -v &#39;grep elasticsearch&#39; | awk &#39;{print $2}&#39;</code><br>kill -9 $es_pid<br>echo “elasticsearch stopped”<br>;;<br>restart)<br>es_pid=<code>ps aux|grep elasticsearch | grep -v &#39;grep elasticsearch&#39; | awk &#39;{print $2}&#39;</code><br>kill -9 $es_pid<br>echo “elasticsearch stopped”<br>su elasticsearch&lt;&lt;elk<br>cd /elk/elasticsearch-6.5.3/<br>./bin/elasticsearch -d<br>elk<br>echo “elasticsearch startup”<br>;;<br>*)<br>echo “start|stop|restart”<br>;;<br>esac<br>exit $?<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">配置自启动</span><br><span class="line"></span><br><span class="line">chkconfig --add elasticsearch</span><br><span class="line"></span><br><span class="line">systemctl start elasticsearch<span class="selector-class">.service</span><span class="comment">//启动</span></span><br><span class="line">systemctl sotp elasticsearch<span class="selector-class">.service</span><span class="comment">//关闭</span></span><br><span class="line">systemctl status elasticsearch<span class="selector-class">.service</span> <span class="comment">//状态</span></span><br><span class="line">systemctl enbale elasticsearch<span class="selector-class">.service</span><span class="comment">//开机启动</span></span><br><span class="line">systemctl disable elasticsearch<span class="selector-class">.service</span><span class="comment">//开机不启动</span></span><br></pre></td></tr></table></figure></p><p>添加安装访问:<br>找到了一个利用插件进行网页访问控制,感觉还不错(主要开源).<br><a heaf="https://blog.csdn.net/envinfo2012/article/details/76685818">SearchGuard</a><br>单机版的ES做到这里就结束了,后面还会做集群。</p></h3></h3></h3></h3>]]></content>
      
      
      <categories>
          
          <category> ElasticSearch </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ELK </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>nginx_extend</title>
      <link href="/2018/12/13/nginx-extend/"/>
      <url>/2018/12/13/nginx-extend/</url>
      
        <content type="html"><![CDATA[<p>本文讲解的是nginx一些配置。<br><a id="more"></a></p><h3>禁止某些访问请求</h3><p>判断请求连接,带<code>?360</code>所有的网页返回404.<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ($request_uri <span class="string">"360"</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">404</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>判断请求连接 尾缀是<code>html?360</code>返回404.<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ($request_uri <span class="string">"html\?360$"</span>)&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="number">404</span><span class="comment">;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Service_Nginx </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Nginx_Install_parameter</title>
      <link href="/2018/12/13/Nginx-Install-Parameter/"/>
      <url>/2018/12/13/Nginx-Install-Parameter/</url>
      
        <content type="html"><![CDATA[<p>Nginx安装参数详情<br><a id="more"></a></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br></pre></td><td class="code"><pre><span class="line">–prefix=指向安装目录</span><br><span class="line"></span><br><span class="line">–sbin-path 指向（执行）程序文件（nginx）</span><br><span class="line"></span><br><span class="line">–conf-path= 指向配置文件（nginx.conf）</span><br><span class="line"></span><br><span class="line">–error-log-path=指向错误日志目录</span><br><span class="line"></span><br><span class="line">–pid-path= 指向 pid 文件（nginx.pid）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">lock</span>-<span class="keyword">path</span>= 指向 <span class="keyword">lock</span> 文件（nginx.lock）（安装文件锁定，防止安装文件被别人利用，或自己误操作。）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">user</span>= 指定程序运行时的非特权用户</span><br><span class="line"></span><br><span class="line">–<span class="keyword">group</span>=指定程序运行时的非特权用户组</span><br><span class="line"></span><br><span class="line">–builddir= 指向编译目录</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-cc= 指向 C 编译器路径</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-cpp= 指向 C 预处理路径</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-<span class="keyword">md5</span>-opt= 在编译时为 <span class="keyword">md5</span> 库设置附加参数</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-pcre= 指向 pcre 库文件目录</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-<span class="keyword">md5</span>-asm 使用 <span class="keyword">md5</span> 汇编源</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-<span class="keyword">md5</span>= 指向 <span class="keyword">md5</span> 库文件目录（消息摘要算法第五版，用以提供消息的完整性保护）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-<span class="keyword">sha1</span>= 指向 <span class="keyword">sha1</span> 库目录（数字签名算法，主要用于数字签名）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-zlib= 指向 zlib 库目录</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-zlib-asm= 为指定的 CPU 使用 zlib 汇编源进行优化，CPU 类型为 pentium, pentiumpro</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-libatomic= 指向 libatomic_ops 安装目录</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-openssl= 指向 openssl 安装目录</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-perl_modules_path= 设定 perl 模块路径</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-perl= 设定 perl 库文件路径</span><br><span class="line"></span><br><span class="line">–<span class="keyword">http</span>-<span class="keyword">log</span>-<span class="keyword">path</span>= 设定 <span class="keyword">access</span> <span class="keyword">log</span> 路径</span><br><span class="line"></span><br><span class="line">–<span class="keyword">http</span>-<span class="keyword">client</span>-<span class="keyword">body</span>-temp-<span class="keyword">path</span>= 设定 <span class="keyword">http</span> 客户端请求临时文件路径</span><br><span class="line"></span><br><span class="line">–<span class="keyword">http</span>-proxy-temp-<span class="keyword">path</span>= 设定 <span class="keyword">http</span> 代理临时文件路径</span><br><span class="line"></span><br><span class="line">–<span class="keyword">http</span>-fastcgi-temp-<span class="keyword">path</span>= 设定 <span class="keyword">http</span> fastcgi 临时文件路径</span><br><span class="line"></span><br><span class="line">–<span class="keyword">http</span>-uwsgi-temp-<span class="keyword">path</span>= 设定 <span class="keyword">http</span> uwsgi 临时文件路径</span><br><span class="line"></span><br><span class="line">–<span class="keyword">http</span>-scgi-temp-<span class="keyword">path</span>= 设定 <span class="keyword">http</span> scgi 临时文件路径</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-cc-opt= 设置 C 编译器参数（PCRE 库，需要指定–<span class="keyword">with</span>-cc-opt=”-I /usr/<span class="keyword">local</span>/<span class="keyword">include</span>”，如果使用<span class="keyword">select</span>()函数则需要同时增加文件描述符数量，可以通过–<span class="keyword">with</span>-cc- opt=”-D FD_SETSIZE=<span class="number">2048</span>”指定。）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-ld-opt= 设置连接文件参数。（PCRE 库，需要指定–<span class="keyword">with</span>-ld-opt=”-L /usr/<span class="keyword">local</span>/lib”。）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-cpu-opt= 指定编译的 CPU，可用的值为: pentium, pentiumpro, pentium3, pentium4, athlon,opteron, amd64, sparc32, sparc64, ppc64</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-<span class="keyword">sha1</span>-opt= 在编译时为 <span class="keyword">sha1</span> 库设置附加参数</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-<span class="keyword">sha1</span>-asm 使用 <span class="keyword">sha1</span> 汇编源</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-zlib-opt= 在编译时为 zlib 设置附加参数</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-openssl-opt 在编译时为 openssl 设置附加参数</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-pcre-opt= 在编译时为 pcre 库设置附加参数</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-libatomic 为原子内存的更新操作的实现提供一个架构</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-debug 启用 debug 日志</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-http_perl_module 启用 ngx_http_perl_module 支持（该模块使 nginx 可以直接使用 perl 或通过 ssi 调用 perl）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-mail 启用 POP3/IMAP4/SMTP 代理模块支持</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-mail_ssl_module 启用 ngx_mail_ssl_module 支持</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-google_perftools_module启用 ngx_google_perftools_module 支持（调试用，剖析程序性能瓶颈）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-cpp_test_module 启用 ngx_cpp_test_module 支持</span><br><span class="line"></span><br><span class="line">–<span class="keyword">add</span>-<span class="keyword">module</span>= 启用外部模块支持</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-pcre 启用 pcre 库</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-rtsig_module启用 rtsig 模块支持（实时信号）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-select_module 启用 <span class="keyword">select</span> 模块支持（一种轮询模式,不推荐在高载环境下使用）禁用：–withoutselect_module</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-poll_module 启用 poll 模块支持（功能与 <span class="keyword">select</span> 相同，与 <span class="keyword">select</span> 特性相同，为一种轮询模式,不推荐在高载环境下使用）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-<span class="keyword">file</span>-aio 启用 <span class="keyword">file</span> aio 支持（一种 APL 文件传输格式）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-ipv6 启用 ipv6 支持</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-http_ssl_module 启用 ngx_http_ssl_module 支持（使支持 https 请求，需已安装 openssl）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-http_realip_module启用 ngx_http_realip_module 支持（这个模块允许从请求标头更改客户端的 IP 地址值，默认为关）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-http_addition_module  启用 ngx_http_addition_module 支持（作为一个输出过滤器，支持不完全缓冲，分部响应请求）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-http_xslt_module 启用 ngx_http_xslt_module 支持（过滤转换 <span class="keyword">XML</span> 请求）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-http_image_filter_module 启用 ngx_http_image_filter_module 支持（传输 JPEG/GIF/PNG 图片的一个过滤器）（默认为不启用。gd 库要用到）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-http_geoip_module 启用 ngx_http_geoip_module 支持（该模块创建基于与 MaxMind GeoIP 二进制文件相配的客户端 IP 地址的 ngx_http_geoip_module 变量）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-http_sub_module 启用 ngx_http_sub_module 支持（允许用一些其他文本替换 nginx 响应中的一些文本）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-http_dav_module 启用 ngx_http_dav_module 支持（增加 PUT,<span class="keyword">DELETE</span>,MKCOL：创建集合,COPY 和 <span class="keyword">MOVE</span> 方法）默认情况下为关闭，需编译开启</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-http_flv_module 启用 ngx_http_flv_module 支持（提供寻求内存使用基于时间的偏移量文件）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-http_gzip_static_module   启用 ngx_http_gzip_static_module 支持（在线实时压缩输出数据流）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-http_random_index_module  启用 ngx_http_random_index_module 支持（从目录中随机挑选一个目录索引）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-http_secure_link_module 启用 ngx_http_secure_link_module 支持（计算和检查要求所需的安全链接网址）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-http_degradation_module 启用 ngx_http_degradation_module 支持（允许在内存不足的情况下返回<span class="number">204</span> 或 <span class="number">444</span> 码）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">with</span>-http_stub_status_module 启用 ngx_http_stub_status_module 支持（获取 nginx 自上次启动以来的工作状态）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">without</span>-http_charset_module禁用 ngx_http_charset_module 支持（重新编码 web 页面，但只能是一个方向服务器端到客户端，并且只有一个字节的编码可以被重新编码）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">without</span>-http_gzip_module 禁用 ngx_http_gzip_module 支持（该模块同-<span class="keyword">with</span>-http_gzip_static_module 功能一样）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">without</span>-http_ssi_module 禁用 ngx_http_ssi_module 支持（该模块提供了一个在输入端处理处理服务器包含文件（SSI）的过滤器，目前支持 SSI 命令的列表是不完整的）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">without</span>-http_userid_module 禁用 ngx_http_userid_module 支持（该模块用来处理用来确定客户端后续请求的 cookies）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">without</span>-http_access_module 禁用 ngx_http_access_module 支持（该模块提供了一个简单的基于主机的访问控制。允许/拒绝基于 ip 地址）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">without</span>-http_auth_basic_module 禁用 ngx_http_auth_basic_module（该模块是可以使用用户名和密码基于<span class="keyword">http</span> 基本认证方法来保护你的站点或其部分内容）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">without</span>-http_autoindex_module  禁用 <span class="keyword">disable</span> ngx_http_autoindex_module 支持（该模块用于自动生成目录列表，只在 ngx_http_index_module 模块未找到索引文件时发出请求。）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">without</span>-http_geo_module 禁用 ngx_http_geo_module 支持（创建一些变量，其值依赖于客户端的 IP 地址）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">without</span>-http_map_module 禁用 ngx_http_map_module 支持（使用任意的键/值对设置配置变量）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">without</span>-http_split_clients_module禁用 ngx_http_split_clients_module 支持（该模块用来基于某些条件划分用户。条件如：ip 地址、报头、cookies 等等）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">without</span>-http_referer_module 禁用 <span class="keyword">disable</span> ngx_http_referer_module 支持（该模块用来过滤请求，拒绝报头中 Referer 值不正确的请求）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">without</span>-http_rewrite_module 禁用 ngx_http_rewrite_module 支持（该模块允许使用正则表达式改变 URI，并且根据变量来转向以及选择配置。</span><br><span class="line">如果在 <span class="keyword">server</span> 级别设置该选项，那么他们将在 location 之前生效。如果在location 还有更进一步的重写规则，location 部分的规则依然会被执行。如果这个 URI 重写是因为 location 部分的规则造成的，那么 location 部分会再次被执行作为新的 URI。 这个循环会执行 <span class="number">10</span> 次，然后 Nginx 会返回一个 <span class="number">500</span> 错误。）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">without</span>-http_proxy_module 禁用 ngx_http_proxy_module 支持（有关代理服务器）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">without</span>-http_fastcgi_module 禁用 ngx_http_fastcgi_module 支持（该模块允许 Nginx 与 FastCGI 进程交互，并通过传递参数来控制 FastCGI 进程工作。 ）FastCGI 一个常驻型的公共网关接口。</span><br><span class="line"></span><br><span class="line">–<span class="keyword">without</span>-http_uwsgi_module 禁用 ngx_http_uwsgi_module 支持（该模块用来医用 uwsgi 协议，uWSGI 服务器相关）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">without</span>-http_scgi_module 禁用 ngx_http_scgi_module 支持（该模块用来启用 SCGI 协议支持，SCGI 协议是CGI 协议的替代。它是一种应用程序与 <span class="keyword">HTTP</span> 服务接口标准。它有些像 FastCGI 但他的设计 更容易实现。）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">without</span>-http_memcached_module  禁用 ngx_http_memcached_module 支持（该模块用来提供简单的缓存，以提高系统效率）</span><br><span class="line"></span><br><span class="line">-<span class="keyword">without</span>-http_limit_zone_module 禁用 ngx_http_limit_zone_module 支持（该模块可以针对条件，进行会话的并发连接数控制）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">without</span>-http_limit_req_module 禁用 ngx_http_limit_req_module 支持（该模块允许你对于一个地址进行请求数量的限制用一个给定的 <span class="keyword">session</span> 或一个特定的事件）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">without</span>-http_empty_gif_module 禁用 ngx_http_empty_gif_module 支持（该模块在内存中常驻了一个 <span class="number">1</span>*<span class="number">1</span> 的透明 GIF 图像，可以被非常快速的调用）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">without</span>-http_browser_module 禁用 ngx_http_browser_module 支持（该模块用来创建依赖于请求报头的值。如果浏览器为 modern ，则$modern_browser 等于 modern_browser_value 指令分配的值；如 果浏览器为 <span class="keyword">old</span>，则$ancient_browser 等于 ancient_browser_value 指令分配的值；如果浏览器为 MSIE 中的任意版本，则 $msie 等于 <span class="number">1</span>）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">without</span>-http_upstream_ip_hash_module禁用 ngx_http_upstream_ip_hash_module 支持（该模块用于简单的负载均衡）</span><br><span class="line"></span><br><span class="line">-<span class="keyword">without</span>-<span class="keyword">http</span> 禁用 <span class="keyword">http</span> <span class="keyword">server</span> 功能</span><br><span class="line"></span><br><span class="line">–<span class="keyword">without</span>-<span class="keyword">http</span>-<span class="keyword">cache</span> 禁用 <span class="keyword">http</span> <span class="keyword">cache</span> 功能</span><br><span class="line"></span><br><span class="line">–<span class="keyword">without</span>-mail_pop3_module 禁用 pop3 协议（POP3 即邮局协议的第 <span class="number">3</span> 个版本,它是规定个人计算机如何连接到互</span><br><span class="line">联网上的邮件服务器进行收发邮件的协议。是因特网电子邮件的第一个离线协议标 准,POP3 协议允许用户从服务</span><br><span class="line">器上把邮件存储到本地主机上,同时根据客户端的操作删除或保存在邮件服务器上的邮件。POP3 协议是 TCP/IP 协</span><br><span class="line">议族中的一员，主要用于 支持使用客户端远程管理在服务器上的电子邮件）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">without</span>-mail_imap_module 禁用 imap 协议（一种邮件获取协议。它的主要作用是邮件客户端可以通过这种协</span><br><span class="line">议从邮件服务器上获取邮件的信息，下载邮件等。IMAP 协议运行在 TCP/IP 协议之上， 使用的端口是 <span class="number">143</span>。它与</span><br><span class="line">POP3 协议的主要区别是用户可以不用把所有的邮件全部下载，可以通过客户端直接对服务器上的邮件进行操作。）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">without</span>-mail_smtp_module 禁用 smtp 协议（SMTP 即简单邮件传输协议,它是一组用于由源地址到目的地址传送</span><br><span class="line">邮件的规则，由它来控制信件的中转方式。SMTP 协议属于 TCP/IP 协议族，它帮助每台计算机在发送或中转信件时找到下一个目的地。）</span><br><span class="line"></span><br><span class="line">–<span class="keyword">without</span>-pcre 禁用 pcre 库</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Service_Nginx </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Centos7_Install_Mongodb</title>
      <link href="/2018/11/19/Centos7-Install-Mongodb/"/>
      <url>/2018/11/19/Centos7-Install-Mongodb/</url>
      
        <content type="html"><![CDATA[<p>MongoDB是用C++语言编写的非关系型数据库。特点是高性能、易部署、易使用，存储数据十分方便，主要特性有：<br>面向集合存储，易于存储对象类型的数据<br>模式自由<br>支持动态查询<br>支持完全索引，包含内部对象<br>支持复制和故障恢复<br>使用高效的二进制数据存储，包括大型对象<br>文件存储格式为BSON(一种JSON的扩展)<br><a id="more"></a><br>系统环境<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OS    :Red Hat Enterprise Linux<span class="built_in"> Server </span>release 7.2 (Maipo)</span><br><span class="line">Kernel:3.10.0-327.el7.x86_64</span><br></pre></td></tr></table></figure></p><p>关闭防火墙和SELINUX<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Selinux：</span><br><span class="line">setenforce 0  宽松模式</span><br><span class="line">sed -i <span class="string">"s/enforcing/disabled/g"</span>  /etc/selinux<span class="built_in">/config </span> 永久关闭</span><br><span class="line">Firewalld：</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl disabled firewalld</span><br></pre></td></tr></table></figure></p><p></p><h3>配置MongoDB的yum源</h3><br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/yum.repos.d/mongodb-org-3.4.repo</span><br><span class="line"><span class="section">+添加以下内容:</span></span><br><span class="line"></span><br><span class="line">[mongodb-org-3.4]  </span><br><span class="line">name=MongoDB Repository  </span><br><span class="line">baseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/3.4/x86_64/  </span><br><span class="line">gpgcheck=1  </span><br><span class="line">enabled=1  </span><br><span class="line">gpgkey=https://www.mongodb.org/static/pgp/server-3.4.asc</span><br><span class="line"></span><br><span class="line"><span class="section">+注: gpgcheck 也可以写0，省去验证</span></span><br></pre></td></tr></table></figure><p></p><p></p><h3>安装MongoDB</h3><br><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="addition">+安装:</span></span><br><span class="line"></span><br><span class="line">yum -y install mongodb-org</span><br><span class="line"></span><br><span class="line"><span class="addition">+安装位置:</span></span><br><span class="line"></span><br><span class="line">whereis mongod</span><br><span class="line"></span><br><span class="line"><span class="addition">+查看修改配置文件：</span></span><br><span class="line"></span><br><span class="line">vim /etc/mongod.conf</span><br></pre></td></tr></table></figure><p></p><p></p><h3>启动MongoDB</h3><br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">启动mongodb ：</span><br><span class="line">systemctl start mongod.service</span><br><span class="line"></span><br><span class="line">停止mongodb ：</span><br><span class="line">systemctl stop mongod.service</span><br><span class="line"></span><br><span class="line">查到mongodb的状态：</span><br><span class="line">systemctl status mongod.service</span><br></pre></td></tr></table></figure><p></p><p></p><h3>启动MongoDB shell</h3><br><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="addition">+命令： mongo</span></span><br><span class="line"></span><br><span class="line"><span class="addition">+查看数据库: show dbs</span></span><br></pre></td></tr></table></figure><p></p><p></p><h3>设置mongodb远程访问：</h3><br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">+编辑mongod.<span class="keyword">conf</span>注释bindIp,并重启mongodb.(这句配置代表只能本机使用，所以需注释):</span><br><span class="line"></span><br><span class="line"><span class="keyword">vim</span> /etc/mongod.<span class="keyword">conf</span></span><br><span class="line"></span><br><span class="line">+重启MongoDB使修改配置生效:</span><br><span class="line"></span><br><span class="line">systemctl restart mongod.service</span><br></pre></td></tr></table></figure><p></p>]]></content>
      
      
      <categories>
          
          <category> Database </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Mongodb </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>rsync+inotify</title>
      <link href="/2018/11/13/rsync-inotify/"/>
      <url>/2018/11/13/rsync-inotify/</url>
      
        <content type="html"><![CDATA[<p>rsync+inotify实现文件实时同步和实时监控。<br><a id="more"></a></p><h3>系统环境：</h3><br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OS      :Red Hat Enterprise Linux<span class="built_in"> Server </span>release 7.2 (Maipo)</span><br><span class="line">Kernel: :3.10.0-327.el7.x86_64</span><br></pre></td></tr></table></figure><br><br><h3>关闭防火墙和SELINUX</h3><br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Selinux：</span><br><span class="line">setenforce 0  宽松模式</span><br><span class="line">sed -i <span class="string">"s/enforcing/disabled/g"</span>  /etc/selinux<span class="built_in">/config </span>  永久关闭</span><br><span class="line">Firewalld：</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl disabled firewalld</span><br></pre></td></tr></table></figure><br><br><h3>主：10.10.1.15</h3><br>安装rsync+inotify<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">yum  -<span class="keyword">y</span> install rsync</span><br><span class="line"></span><br><span class="line">wget http<span class="variable">s:</span>//soliton.net.<span class="keyword">cn</span>/download/linux/inotify-tools-<span class="number">3.14</span>.tar.gz</span><br><span class="line">tar zxvf inotify-tools-<span class="number">3.14</span>.tar.gz</span><br><span class="line"><span class="keyword">cd</span> inotify-tools-<span class="number">3.14</span></span><br><span class="line">./configure –prefix=/usr/local/inotify</span><br><span class="line"><span class="keyword">make</span> &amp;&amp; <span class="keyword">make</span> install</span><br></pre></td></tr></table></figure><br><br>创建rsync同步的用户和密码<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="regexp">/etc/</span>rsyncd_password</span><br><span class="line">rsynctb</span><br></pre></td></tr></table></figure><br><br>给文件赋予权限<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod <span class="number">600</span> <span class="regexp">/etc/</span>rsyncd_password</span><br></pre></td></tr></table></figure><br><br>编写脚本同步<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vim /sh/rsync_inotify.sh</span><br><span class="line"><span class="comment">#/bin/bash</span></span><br><span class="line">DIR=<span class="string">"/home/www/"</span><span class="comment">###同步目录</span></span><br><span class="line">RSYNC_CMD=<span class="string">"rsync -azH --delete --password-file=/etc/rsyncd_password <span class="variable">$DIR</span> rsynctb@10.10.1.16::www"</span>     <span class="comment">##密码文件 和  同步用户   客户端共享目录</span></span><br><span class="line">INOTIFY_CMD=<span class="string">"inotifywait -rqq -e modify,move,create,delete,attrib <span class="variable">$DIR</span>"</span>     <span class="comment">#监控目录</span></span><br><span class="line"><span class="keyword">while</span> <span class="variable">$INOTIFY_CMD</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="variable">$RSYNC_CMD</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">done</span>&amp;</span><br></pre></td></tr></table></figure><br><br>给脚本赋予权限<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x /<span class="keyword">sh</span>/rsync_inotify.<span class="keyword">sh</span></span><br></pre></td></tr></table></figure><br><br>写到开机执行<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cat</span> /<span class="keyword">sh</span>/rsync_inotify.<span class="keyword">sh</span> &gt; /root/.bashrc</span><br></pre></td></tr></table></figure><br><br>启动服务并设置开机自启<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start rsyncd</span><br><span class="line">systemctl <span class="builtin-name">enable</span> rsyncd</span><br></pre></td></tr></table></figure><br><br><h3>从:10.10.1.16</h3><br>安装且配置rsync服务<br><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">yum -y install rsync</span><br><span class="line"></span><br><span class="line">vim <span class="string">/etc/rsyncd.conf</span></span><br><span class="line"></span><br><span class="line">[www]<span class="comment">##共享名</span></span><br><span class="line">path=<span class="string">/home/www</span><span class="comment">##共享路径</span></span><br><span class="line">auth users=rsynctb<span class="comment">##认证用户名为  rsynctb</span></span><br><span class="line">secrets file=<span class="string">/etc/rsyncd_users.db</span>认证用户存放文件</span><br><span class="line">dont compress = *<span class="string">.gz</span> *<span class="string">.bz2</span> *<span class="string">.tgz</span> *<span class="string">.zip</span> *<span class="string">.rar</span> *<span class="string">.z</span></span><br><span class="line">hosts allow     =  192.168.0.5<span class="comment">## 允许这个IP 连接</span></span><br><span class="line">hosts deny   =  all <span class="comment">##拒绝所有IP</span></span><br><span class="line">read only=<span class="literal">false</span></span><br><span class="line">    timeout = 300<span class="comment">##超时时间</span></span><br><span class="line">    <span class="comment">#log file /var/log/rsyncd.log</span></span><br><span class="line">    <span class="comment">#pid file = /var/run/rsyncd.pid</span></span><br><span class="line">uid=root</span><br><span class="line">gid=root</span><br></pre></td></tr></table></figure><br><br>创建rsync用户和密码的存放文件<br><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/rsyncd_users<span class="meta">.db</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">rsynctb:</span><span class="number">123456</span></span><br></pre></td></tr></table></figure><br><br>给文件赋予权限<br><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod <span class="number">600</span> /etc/rsyncd_users<span class="meta">.db</span></span><br></pre></td></tr></table></figure><br><br>启动服务并设置开机自启<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start rsyncd</span><br><span class="line">systemctl <span class="builtin-name">enable</span> rsyncd</span><br></pre></td></tr></table></figure><br><br><h3>现在可以去测试实时同步了</h3>]]></content>
      
      
      <categories>
          
          <category> 文件实时同步 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> rsync+inotify </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Python2.7_Update_3.7</title>
      <link href="/2018/10/29/Python2-7-Update-3-7/"/>
      <url>/2018/10/29/Python2-7-Update-3-7/</url>
      
        <content type="html"><![CDATA[<p>Python2.x版本预计在2020年4月12日退出历史舞台，将由Python3代替Python2继续引领新的时代。<br><a id="more"></a></p><p></p><h3>系统环境：<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OS      :Red Hat Enterprise Linux<span class="built_in"> Server </span>release 7.2 (Maipo)</span><br><span class="line">Kernel: :3.10.0-327.el7.x86_64</span><br></pre></td></tr></table></figure><p></p><p></p><h3>安装依赖环境<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh  <span class="symbol">https:</span>/<span class="regexp">/soliton.net.cn/download</span><span class="regexp">/linux/epel</span>-release-<span class="number">7</span>-<span class="number">11</span>.noarch.rpm</span><br><span class="line">yum -y install zlib-devel bzip2-devel openssl-devel ncurses-devel libffi-devel sqlite-devel readline-devel tk-devel gdbm-devel db4-devel libpcap-devel xz-devel</span><br></pre></td></tr></table></figure><p></p><p></p><h3>下载Python3.7<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget http<span class="variable">s:</span>//www.<span class="keyword">python</span>.org/ftp/<span class="keyword">python</span>/<span class="number">3.7</span>.<span class="number">0</span>/Python-<span class="number">3.7</span>.<span class="number">0</span>.tgz</span><br><span class="line"></span><br><span class="line">wget http<span class="variable">s:</span>//soliton.net.<span class="keyword">cn</span>/download/linux/Python-<span class="number">3.7</span>.<span class="number">0</span>.tgz</span><br><span class="line"></span><br><span class="line">+以上二选一</span><br></pre></td></tr></table></figure><p></p><p></p><h3>解压，编译<br><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">tar zxf Python-3.7.0.tgz</span><br><span class="line"></span><br><span class="line"><span class="keyword">cd</span> Python-3.7</span><br><span class="line"></span><br><span class="line"><span class="string">./configure</span> <span class="params">--prefix=/usr/local/python3</span> <span class="params">--enable-optimizations</span> <span class="params">--with-ssl</span></span><br><span class="line"></span><br><span class="line">make -j 4 &amp;&amp; make install</span><br></pre></td></tr></table></figure><p></p><p></p><h3>配置环境变量<br><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">export PATH=<span class="variable">$PATH</span><span class="symbol">:/usr/local/python3/bin</span>          <span class="comment">#临时</span></span><br><span class="line"></span><br><span class="line">vim /etc/profile</span><br><span class="line"></span><br><span class="line">+ 翻到最后面追加：</span><br><span class="line"></span><br><span class="line">PATH=<span class="variable">$PATH</span><span class="symbol">:/usr/local/python3/bin</span></span><br></pre></td></tr></table></figure><p></p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">python</span>             <span class="selector-tag">python2</span><span class="selector-class">.7</span>          <span class="selector-tag">python3</span><span class="selector-class">.7</span>          <span class="selector-tag">python3</span><span class="selector-class">.7m</span>         <span class="selector-tag">python3-config</span>     </span><br><span class="line"><span class="selector-tag">python2</span>            <span class="selector-tag">python3</span>            <span class="selector-tag">python3</span><span class="selector-class">.7-config</span>   <span class="selector-tag">python3</span><span class="selector-class">.7m-config</span>  </span><br><span class="line"><span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span> <span class="selector-tag">-</span></span><br><span class="line"><span class="selector-tag">pip</span>      <span class="selector-tag">pip-2</span><span class="selector-class">.7</span>  <span class="selector-tag">pip3</span>     <span class="selector-tag">pip3</span><span class="selector-class">.7</span></span><br></pre></td></tr></table></figure><p></p><h3>以上即是Python3升级，保留Python2<p></p></h3></h3></h3></h3></h3></h3>]]></content>
      
      
      <categories>
          
          <category> Update </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Python_Update </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Centos_install_Vsftpd</title>
      <link href="/2018/10/17/centos-install-vsftpd/"/>
      <url>/2018/10/17/centos-install-vsftpd/</url>
      
        <content type="html"><![CDATA[<p>Liunx外部文件的传输，避免不了使用FTP服务，所以现在就整理下，CentOS7环境下，FTP服务的搭建。FTP服务器需要安装vsftp服务端软件。我们知道，在建立vsftpd用户时，我们一般是在linux下建立用户useradd的方式来访问ftp，但有时我们只想提供ftp服务，而避免用户用ftp的帐号去登录linux，采用一般的方式只能是限制该用户的访问权限，但还是避免不了用户登录进linux系统，所以比较好的方法是用vsftpd的虚拟用户（virtual users）。<br><a id="more"></a></p><p></p><h3>系统环境<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OS    :Red Hat Enterprise Linux<span class="built_in"> Server </span>release 7.2 (Maipo)</span><br><span class="line">Kernel:3.10.0-327.el7.x86_64</span><br></pre></td></tr></table></figure><p></p><p></p><h3>关闭防火墙和SELINUX<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Selinux：</span><br><span class="line">setenforce 0  宽松模式</span><br><span class="line">sed -i <span class="string">"s/enforcing/disabled/g"</span>  /etc/selinux<span class="built_in">/config </span>  永久关闭</span><br><span class="line">Firewalld：</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="builtin-name">disable</span> firewalld</span><br></pre></td></tr></table></figure><p></p><p></p><h3>安装vsftpd<br><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">rpm -qa | grep vsftpd <span class="comment">#查询vsftpd是否安装</span></span><br><span class="line"></span><br><span class="line">yum <span class="keyword">install</span> -y vsftpd <span class="comment">#安装vsftpd</span></span><br><span class="line"></span><br><span class="line">yum <span class="keyword">install</span> -y psmisc net-tools systemd-devel libdb-devel perl-DBI  <span class="comment">#安装vsftpd虚拟用户配置依赖包</span></span><br><span class="line"></span><br><span class="line">systemctl start vsftpd.service <span class="comment">#启动</span></span><br><span class="line"></span><br><span class="line">systemctl enable vsftpd.service <span class="comment">#设置vsftpd开机启动</span></span><br></pre></td></tr></table></figure><p></p><p></p><h3>新建系统用户vsftpd<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">useradd vsftpd -d <span class="regexp">/home/</span>wwwroot -s <span class="regexp">/bin/</span><span class="keyword">false</span> #用户目录为<span class="regexp">/home/</span>wwwroot, 用户登录终端设为<span class="regexp">/bin/</span><span class="keyword">false</span>(即使之不能登录系统)</span><br><span class="line"></span><br><span class="line">chown vsftpd:vsftpd <span class="regexp">/home/</span>wwwroot -R</span><br></pre></td></tr></table></figure><p></p><p></p><h3>建立虚拟用户个人Vsftp的配置文件和子账号FTP权限<br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">mkdir /etc/vsftpd/vconf</span><br><span class="line"></span><br><span class="line">cd /etc/vsftpd/vconf</span><br><span class="line"></span><br><span class="line">touch web1  <span class="comment">#这里创建虚拟用户配置文件</span></span><br><span class="line"></span><br><span class="line">mkdir -p /home/wwwroot/web1/http/mydic</span><br><span class="line"></span><br><span class="line">设置FTP上传文件新增权限，最新的vsftpd要求对主目录不能有写的权限所以ftp为755，主目录下面的子目录再设置777权限  </span><br><span class="line"></span><br><span class="line">chmod -R 755 /home/wwwroot/web1/http</span><br><span class="line">chmod R 777 /home/wwwroot/web1/http/mydic</span><br><span class="line"></span><br><span class="line">vi web1 <span class="comment">#编辑用户web1配置文件，其他的跟这个配置文件类似，输入下面内容</span></span><br><span class="line"></span><br><span class="line">local_root=/home/wwwroot/web1/http/　　<span class="comment">#设置FTP账号根目录</span></span><br><span class="line">write_enable=YES</span><br><span class="line">anon_world_readable_only=NO</span><br><span class="line">anon_upload_enable=YES</span><br><span class="line">anon_mkdir_write_enable=YES</span><br><span class="line">anon_other_write_enable=YES</span><br></pre></td></tr></table></figure><p></p><p></p><h3>配置vsftp服务器<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp <span class="regexp">/etc/</span>vsftpd<span class="regexp">/vsftpd.conf /</span>etc<span class="regexp">/vsftpd/</span>vsftpd.conf-bak <span class="comment">#备份默认配置文件</span></span><br></pre></td></tr></table></figure><p></p><p></p><h3>修改vsftpd主配置文件<br><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">"s/anonymous_enable=YES/anonymous_enable=NO/g"</span> <span class="string">'/etc/vsftpd/vsftpd.conf'</span></span><br><span class="line"></span><br><span class="line">sed -i <span class="string">"s/<span class="subst">#anon_upload_enable</span>=YES/anon_upload_enable=NO/g"</span> <span class="string">'/etc/vsftpd/vsftpd.conf'</span></span><br><span class="line"></span><br><span class="line">sed -i <span class="string">"s/<span class="subst">#anon_mkdir_write_enable</span>=YES/anon_mkdir_write_enable=YES/g"</span> <span class="string">'/etc/vsftpd/vsftpd.conf'</span></span><br><span class="line"></span><br><span class="line">sed -i <span class="string">"s/<span class="subst">#chown_uploads</span>=YES/chown_uploads=NO/g"</span> <span class="string">'/etc/vsftpd/vsftpd.conf'</span></span><br><span class="line"></span><br><span class="line">sed -i <span class="string">"s/<span class="subst">#async_abor_enable</span>=YES/async_abor_enable=YES/g"</span> <span class="string">'/etc/vsftpd/vsftpd.conf'</span></span><br><span class="line"></span><br><span class="line">sed -i <span class="string">"s/<span class="subst">#ascii_upload_enable</span>=YES/ascii_upload_enable=YES/g"</span> <span class="string">'/etc/vsftpd/vsftpd.conf'</span></span><br><span class="line"></span><br><span class="line">sed -i <span class="string">"s/<span class="subst">#ascii_download_enable</span>=YES/ascii_download_enable=YES/g"</span> <span class="string">'/etc/vsftpd/vsftpd.conf'</span></span><br><span class="line"></span><br><span class="line">sed -i <span class="string">"s/<span class="subst">#ftpd_banner</span>=Welcome to blah FTP service./ftpd_banner=Welcome to FTP service./g"</span> <span class="string">'/etc/vsftpd/vsftpd.conf'</span></span><br><span class="line"></span><br><span class="line">echo -e <span class="string">"use_localtime=YES\nlisten_port=21\nchroot_local_user=YES\nidle_session_timeout=300</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\ndata_connection_timeout=1\nguest_enable=YES\nguest_username=vsftpd  #此处要和刚刚创建的用户名一直</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\nuser_config_dir=/etc/vsftpd/vconf\nvirtual_use_local_privs=YES</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\npasv_min_port=10060\npasv_max_port=10090</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">\naccept_timeout=5\nconnect_timeout=1"</span> &gt;&gt; /etc/vsftpd/vsftpd.conf</span><br></pre></td></tr></table></figure><p></p><p></p><h3>配置文件说明：<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">anonymous_enable</span>=<span class="literal">NO</span>  //设定不允许匿名访问</span><br><span class="line"><span class="attr">local_enable</span>=<span class="literal">YES</span>    //设定本地用户可以访问。注：如使用虚拟宿主用户，在该项目设定为<span class="literal">NO</span>的情况下所有虚拟用户将无法访问</span><br><span class="line"><span class="attr">chroot_list_enable</span>=<span class="literal">YES</span>       //使用户不能离开主目录</span><br><span class="line"><span class="attr">ascii_upload_enable</span>=<span class="literal">YES</span></span><br><span class="line"><span class="attr">ascii_download_enable</span>=<span class="literal">YES</span> //设定支持ASCII模式的上传和下载功能</span><br><span class="line"><span class="attr">pam_service_name</span>=vsftpd   //PAM认证文件名。PAM将根据/etc/pam.d/vsftpd进行认证</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#以下这些是关于vsftpd虚拟用户支持的重要配置项，默认vsftpd.conf中不包含这些设定项目，需要自己手动添加</span></span><br><span class="line"></span><br><span class="line"><span class="attr">guest_enable</span>=<span class="literal">YES</span> //设定启用虚拟用户功能</span><br><span class="line"><span class="attr">guest_username</span>=vsftpd //指定虚拟用户的宿主用户，CentOS中已经有内置的ftp用户了,通过映射到vsftpd</span><br><span class="line"><span class="attr">user_config_dir</span>=/etc/vsftpd/vuser_conf //设定虚拟用户个人vsftp的CentOS FTP服务文件存放路径。存放虚拟用户个性的CentOS FTP服务文件(配置文件名=虚拟用户名)</span><br></pre></td></tr></table></figure><p></p><p></p><h3>建立虚拟用户名单文件<br><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim  /etc/vsftpd/virtusers</span><br><span class="line"></span><br><span class="line"><span class="addition">+编辑虚拟用户名单文件：（第一行账号，第二行密码，注意：不能使用root做用户名，系统保留）</span></span><br><span class="line"></span><br><span class="line">ceshi</span><br><span class="line">123456</span><br></pre></td></tr></table></figure><p></p><p></p><h3>生成虚拟用户数据文件<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db_load -T -t hash -f <span class="regexp">/etc/</span>vsftpd<span class="regexp">/virtusers /</span>etc<span class="regexp">/vsftpd/</span>virtusers.db</span><br><span class="line">chmod <span class="number">600</span> <span class="regexp">/etc/</span>vsftpd<span class="regexp">/virtusers.db #设定PAM验证文件，并指定对虚拟用户数据库文件进行读取</span></span><br></pre></td></tr></table></figure><p></p><p></p><h3>在/etc/pam.d/vsftpd的文件头部加入以下信息（在后面加入无效）<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cp <span class="meta-keyword">/etc/</span>pam.d/vsftpd <span class="meta-keyword">/etc/</span>pam.d/vsftpdbak<span class="meta">#备份</span></span><br><span class="line"></span><br><span class="line">vi <span class="meta-keyword">/etc/</span>pam.d/vsftpd</span><br><span class="line"></span><br><span class="line">auth    sufficient <span class="meta-keyword">/lib64/</span>security/pam_userdb.so db=<span class="meta-keyword">/etc/</span>vsftpd/virtusers</span><br><span class="line">account sufficient <span class="meta-keyword">/lib64/</span>security/pam_userdb.so db=<span class="meta-keyword">/etc/</span>vsftpd/virtusers</span><br></pre></td></tr></table></figure><p></p><p><code>如果系统为32位，上面改为lib，否则配置失败</code></p><p></p><h3>重启vsftpd服务用创建的虚拟用户登录<br><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart vsftpd</span><br><span class="line"></span><br><span class="line">ftp localhost</span><br><span class="line"><span class="symbol">username:</span> ceshi</span><br><span class="line"><span class="symbol">password:</span> <span class="number">123456</span></span><br></pre></td></tr></table></figure><p></p><p><code>可通过  tail -f /var/log/secure 指令，查看服务器安全日志，便于分析错误问题，设置操作效果一定要仔细.....</code></p></h3></h3></h3></h3></h3></h3></h3></h3></h3></h3></h3></h3>]]></content>
      
      
      <categories>
          
          <category> FTP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Service_vsftpd </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Centos_install_shadowsocks</title>
      <link href="/2018/10/16/Centos-install-Shadowsocks/"/>
      <url>/2018/10/16/Centos-install-Shadowsocks/</url>
      
        <content type="html"><![CDATA[<p>在国内是访问不了 <code>谷歌搜索引擎</code>,我们可以买一台云服务器，只要不是国内大陆即可，通过VPN技术进行翻墙。<br><a id="more"></a></p><p></p><h3>系统环境<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OS    :Red Hat Enterprise Linux<span class="built_in"> Server </span>release 7.2 (Maipo)</span><br><span class="line">Kernel:3.10.0-327.el7.x86_64</span><br></pre></td></tr></table></figure><p></p><p></p><h3>关闭防火墙和SELINUX<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Selinux：</span><br><span class="line">setenforce 0  宽松模式</span><br><span class="line">sed -i <span class="string">"s/enforcing/disabled/g"</span>  /etc/selinux<span class="built_in">/config </span>  永久关闭</span><br><span class="line">Firewalld：</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="builtin-name">disable</span> firewalld</span><br></pre></td></tr></table></figure><p></p><p></p><h3>下载安装shadowsocks脚本并安装<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wget --<span class="keyword">no</span>-check-certificate  http<span class="variable">s:</span>//soliton.net.<span class="keyword">cn</span>/download/linux/shadowsocks.<span class="keyword">sh</span> </span><br><span class="line"></span><br><span class="line">chmod +<span class="keyword">x</span> shadowsocks.<span class="keyword">sh</span></span><br><span class="line"></span><br><span class="line">./shadowsocks.<span class="keyword">sh</span> <span class="number">2</span>&gt;&amp;<span class="number">1</span> | tee shadowsocks.<span class="built_in">log</span></span><br></pre></td></tr></table></figure><p></p><p></p><h3>安装过程<br><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">1.请输入密码，默认密码：teddysun.com</span><br><span class="line"><span class="addition">+ Please enter password for shadowsocks-python</span></span><br><span class="line"><span class="addition">+ (Default password: teddysun.com):123456</span></span><br><span class="line"></span><br><span class="line"><span class="deletion">- password = 123456</span></span><br><span class="line"></span><br><span class="line">2.请输入端口，默认端口17100</span><br><span class="line"><span class="addition">+ Please enter a port for shadowsocks-python [1-65535]</span></span><br><span class="line"><span class="addition">+ (Default port: 17100)::4456</span></span><br><span class="line"></span><br><span class="line"><span class="deletion">- port = 4456</span></span><br><span class="line"></span><br><span class="line">3.选择加密方式：默认(aes-256-gcm)</span><br><span class="line"><span class="addition">+ Please select stream cipher for shadowsocks-python:</span></span><br><span class="line"><span class="addition">+ aes-256-gcm</span></span><br><span class="line"><span class="addition">+ aes-192-gcm</span></span><br><span class="line"><span class="addition">+ aes-128-gcm</span></span><br><span class="line"><span class="addition">+ aes-256-ctr</span></span><br><span class="line"><span class="addition">+ aes-192-ctr</span></span><br><span class="line"><span class="addition">+ aes-128-ctr</span></span><br><span class="line"><span class="addition">+ aes-256-cfb</span></span><br><span class="line"><span class="addition">+ aes-192-cfb</span></span><br><span class="line"><span class="addition">+ aes-128-cfb</span></span><br><span class="line"><span class="addition">+ camellia-128-cfb</span></span><br><span class="line"><span class="addition">+ camellia-192-cfb</span></span><br><span class="line"><span class="addition">+ camellia-256-cfb</span></span><br><span class="line"><span class="addition">+ chacha20-ietf-poly1305</span></span><br><span class="line"><span class="addition">+ chacha20-ietf</span></span><br><span class="line"><span class="addition">+ chacha20</span></span><br><span class="line"><span class="addition">+ rc4-md5</span></span><br><span class="line"><span class="addition">+Which cipher you'd select(Default: aes-256-gcm):7这里填数字</span></span><br><span class="line"></span><br><span class="line"><span class="deletion">- cipher = aes-256-cfb</span></span><br><span class="line"></span><br><span class="line">4.按 Enter键进行安装 </span><br><span class="line"><span class="addition">+ Press any key to start...or Press Ctrl+C to cancel  ----&gt;Enter</span></span><br><span class="line"></span><br><span class="line"><span class="deletion">- Loaded plugins: fastestmirror, ovl</span></span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line"> * base: mirrors.aliyun.com</span><br><span class="line"> * extras: mirrors.huaweicloud.com</span><br><span class="line"> * updates: mirrors.163.com</span><br><span class="line">Package python-2.7.5-69.el7_5.x86_64 already installed and latest version</span><br><span class="line">Package curl-7.29.0-46.el7.x86_64 already installed and latest version</span><br><span class="line">Package wget-1.14-15.el7_4.1.x86_64 already installed and latest version</span><br><span class="line">Resolving Dependencies</span><br><span class="line"><span class="deletion">--&gt; Running transaction check</span></span><br><span class="line">…………</span><br></pre></td></tr></table></figure><p></p><p></p><h3>安装完成，脚本提示：<br><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Congratulations, Shadowsocks-python server install completed!</span><br><span class="line">./shadowsocks.sh: line <span class="number">136</span>: ip: command <span class="keyword">not</span> found</span><br><span class="line">Your Server IP        :  xxx.xxx.xxx.xxx</span><br><span class="line">Your Server Port      :  <span class="number">4456</span></span><br><span class="line">Your Password         :  <span class="number">123456</span></span><br><span class="line">Your Encryption <span class="function"><span class="keyword">Method</span>:</span>  aes-<span class="number">256</span>-cfb</span><br><span class="line"></span><br><span class="line">Welcome <span class="keyword">to</span> visit:https:<span class="comment">//teddysun.com/342.html</span></span><br><span class="line">Enjoy it!</span><br></pre></td></tr></table></figure><p></p><p></p><h3>安装完成后的配置文件路径：/etc/shadowsocks.json<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="regexp">/etc/</span>shadowsocks.json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"server"</span>:<span class="string">"0.0.0.0"</span>,</span><br><span class="line">    <span class="string">"server_port"</span>:<span class="number">8520</span>,</span><br><span class="line">    <span class="string">"local_address"</span>:<span class="string">"127.0.0.1"</span>,</span><br><span class="line">    <span class="string">"local_port"</span>:<span class="number">4456</span>,</span><br><span class="line">    <span class="string">"password"</span>:<span class="string">"123456"</span>,</span><br><span class="line">    <span class="string">"timeout"</span>:<span class="number">300</span>,</span><br><span class="line">    <span class="string">"method"</span>:<span class="string">"aes-256-cfb"</span>,</span><br><span class="line">    <span class="string">"fast_open"</span>:<span class="keyword">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">如果想多用户就添加：</span><br><span class="line"></span><br><span class="line"><span class="string">"password"</span>:<span class="string">"1234567"</span>,</span><br></pre></td></tr></table></figure><p></p><p></p><h3>启动shadowsocks<br><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">卸载 <span class="string">./shadowsocks.sh</span> uninstall </span><br><span class="line">启动：<span class="string">/etc/init.d/shadowsocks</span> start </span><br><span class="line">停止：<span class="string">/etc/init.d/shadowsocks</span> stop </span><br><span class="line">重启：<span class="string">/etc/init.d/shadowsocks</span> restart </span><br><span class="line">状态：<span class="string">/etc/init.d/shadowsocks</span> status</span><br></pre></td></tr></table></figure><p></p><p></p><h3>客户端连接<br><a href="https://soliton.net.cn/download/windwos/Shadowsocks.exe" target="_blank" rel="noopener">Shadowsocks 下载（windwos）</a><br><a href="https://soliton.net.cn/download/apk/ssr-3.4.0.6.apk" target="_blank" rel="noopener">Shadowsocks 下载（Android）</a><br><a href="https://soliton.net.cn/download/mac/ShadowsocksX-NG-R8.dmg" target="_blank" rel="noopener">Shadowsocks 下载（MAC）</a><br><img src="https://soliton.net.cn/soliton.images/shadowsocks_client.png"><p></p></h3></h3></h3></h3></h3></h3></h3></h3>]]></content>
      
      
      <categories>
          
          <category> VPN </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Centos </tag>
            
            <tag> Shadowsocks </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Centos7 Add a hard disk</title>
      <link href="/2018/10/09/Centos-add-a-hard-disk/"/>
      <url>/2018/10/09/Centos-add-a-hard-disk/</url>
      
        <content type="html"><![CDATA[<p>主机新增一个2G硬盘，如何在不重启的情况下格式并开机挂载！<br><a id="more"></a></p><p></p><h3>系统环境<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OS    :Red Hat Enterprise Linux<span class="built_in"> Server </span>release 7.2 (Maipo)</span><br><span class="line">Kernel:3.10.0-327.el7.x86_64</span><br></pre></td></tr></table></figure><p></p><p></p><h3>关闭防火墙和SELINUX<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Selinux：</span><br><span class="line">setenforce 0  宽松模式</span><br><span class="line">sed -i <span class="string">"s/enforcing/disabled/g"</span>  /etc/selinux<span class="built_in">/config </span>  永久关闭</span><br><span class="line">Firewalld：</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="builtin-name">disable</span> firewalld</span><br></pre></td></tr></table></figure><p></p><p></p><h3>添加前操作<p></p><p><li>查看磁盘信息<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">fdisk -l</span><br><span class="line"></span><br><span class="line">磁盘 /dev/sda：<span class="number">85.9</span> GB, <span class="number">85899345920</span> 字节，<span class="number">167772160</span> 个扇区</span><br><span class="line">Units = 扇区 of <span class="number">1</span> * <span class="number">512</span> = <span class="number">512</span> bytes</span><br><span class="line">扇区大小(逻辑/物理)：<span class="number">512</span> 字节 / <span class="number">512</span> 字节</span><br><span class="line">I/O 大小(最小/最佳)：<span class="number">512</span> 字节 / <span class="number">512</span> 字节</span><br><span class="line">磁盘标签类型：dos</span><br><span class="line">磁盘标识符：<span class="number">0x000946de</span></span><br><span class="line"></span><br><span class="line">   设备 Boot      Start       End       Blocks    Id  System</span><br><span class="line">/dev/sda1   *        <span class="number">2048</span>      <span class="number">411647</span>      <span class="number">204800</span>   <span class="number">83</span>  Linux</span><br><span class="line">/dev/sda2          <span class="number">411648</span>    <span class="number">33972223</span>    <span class="number">16780288</span>   <span class="number">8</span>e  Linux LVM</span><br><span class="line">/dev/sda3        <span class="number">33972224</span>   <span class="number">167772159</span>    <span class="number">66899968</span>   <span class="number">83</span>  Linux</span><br><span class="line">………………</span><br></pre></td></tr></table></figure></li></p><p></p><h3>添加一块2G硬盘<p></p><p></p><h5><code>添加后也是查看不到刚刚添加的硬盘</code><p></p><p><li>查看主机总线号并写脚本进行刷新<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ls /sys/class/scsi_host/</span><br><span class="line"></span><br><span class="line">information:</span><br><span class="line">host0  host10  host12  host14  host16  host18  host2   host21  host23  host25  host27  host29  host30  host32  host5  host7  host9</span><br><span class="line">host1  host11  host13  host15  host17  host19  host20  host22  host24  host26  host28  host3   host31  host4   host6  host8</span><br><span class="line"></span><br><span class="line">ls /sys/class/scsi_host/ | wc -l</span><br><span class="line"></span><br><span class="line">information：</span><br><span class="line">注：从0开始循环到32</span><br><span class="line">vim scsi_host.sh</span><br><span class="line"></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> `seq 0 32`</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"- - -"</span> &gt; /sys/class/scsi_host/host<span class="variable">$i</span>/scan</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure></li></p><p></p><h3>再重新来查看磁盘信息<br><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">fdisk -l</span><br><span class="line"></span><br><span class="line">information:</span><br><span class="line"></span><br><span class="line">磁盘 /dev/sda：85.9 GB,<span class="number"> 85899345920 </span>字节，167772160 个扇区</span><br><span class="line">Units = 扇区 of<span class="number"> 1 </span>*<span class="number"> 512 </span>=<span class="number"> 512 </span>bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 /<span class="number"> 512 </span>字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 /<span class="number"> 512 </span>字节</span><br><span class="line">磁盘标签类型：dos</span><br><span class="line">磁盘标识符：0x000946de</span><br><span class="line"></span><br><span class="line">   设备 Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sda1   *       <span class="number"> 2048 </span>    <span class="number"> 411647 </span>    <span class="number"> 204800 </span> <span class="number"> 83 </span> Linux</span><br><span class="line">/dev/sda2         <span class="number"> 411648 </span>  <span class="number"> 33972223 </span>  <span class="number"> 16780288 </span>  8e  Linux LVM</span><br><span class="line">/dev/sda3       <span class="number"> 33972224 </span> <span class="number"> 167772159 </span>  <span class="number"> 66899968 </span> <span class="number"> 83 </span> Linux</span><br><span class="line"></span><br><span class="line">…………</span><br><span class="line">磁盘 /dev/sdb：2147 MB,<span class="number"> 2147483648 </span>字节，4194304 个扇区</span><br><span class="line">Units = 扇区 of<span class="number"> 1 </span>*<span class="number"> 512 </span>=<span class="number"> 512 </span>bytes</span><br><span class="line">扇区大小(逻辑/物理)：512 字节 /<span class="number"> 512 </span>字节</span><br><span class="line">I/O 大小(最小/最佳)：512 字节 /<span class="number"> 512 </span>字节</span><br><span class="line"></span><br><span class="line">这就是刚刚添加的2G硬盘</span><br><span class="line"></span><br><span class="line">执行dmseg命令也可以查看新添加的硬盘</span><br><span class="line">dmseg | grep sdb</span><br></pre></td></tr></table></figure><p></p><p></p><h3>格式化并挂载<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">fdisk /dev/sdb</span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：n</span><br><span class="line">Partition type:</span><br><span class="line">   p   primary (0 primary, 0 extended, 4 free)</span><br><span class="line">   e   extended</span><br><span class="line">Select (default p): p</span><br><span class="line">分区号 (1-4，默认 1)：</span><br><span class="line">起始 扇区 (2048-4194303，默认为 2048)：</span><br><span class="line">将使用默认值 2048</span><br><span class="line">Last 扇区, +扇区 <span class="keyword">or</span> +size&#123;K,M,G&#125; (2048-4194303，默认为 4194303)：+2040M</span><br><span class="line">分区 1 已设置为 Linux 类型，大小设为 2 GiB</span><br><span class="line"></span><br><span class="line">命令(输入 m 获取帮助)：w</span><br><span class="line">The partition table has been altered!</span><br><span class="line"></span><br><span class="line">Calling ioctl</span><br><span class="line"></span><br><span class="line">_________________________________________________________________________</span><br><span class="line">mkfs.ext4 /dev/sdb</span><br><span class="line">information:</span><br><span class="line">/dev/sdb1: <span class="attribute">UUID</span>=<span class="string">"d3f57d6d-3820-489a-a82e-eb573249b99e"</span> <span class="attribute">TYPE</span>=<span class="string">"ext4"</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mkdir /zabbix</span><br><span class="line">vim /etc/fstab</span><br><span class="line"></span><br><span class="line"><span class="attribute">UUID</span>=d3f57d6d-3820-489a-a82e-eb573249b99e  /zabbix  ext4 defaults 0 0</span><br><span class="line"><span class="attribute">UUID</span>=sdb1分区， /<span class="attribute">zabbix</span>=挂载目录， <span class="attribute">ext4</span>=分区格式  <span class="attribute">defualts</span>=使用文件系统的默认挂载参数    <span class="attribute">0</span>=忽略检查  <span class="attribute">0</span>=不检查</span><br><span class="line"></span><br><span class="line">mount -a #挂载</span><br></pre></td></tr></table></figure><p></p><p></p><h3>查看挂载<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">df -h </span><br><span class="line">/dev/sda3               <span class="number">63</span>G  <span class="number">4.9</span>G   <span class="number">55</span>G    <span class="number">9</span>% /</span><br><span class="line">devtmpfs               <span class="number">1.9</span>G     <span class="number">0</span>  <span class="number">1.9</span>G    <span class="number">0</span>% /dev</span><br><span class="line">tmpfs                  <span class="number">1.9</span>G  <span class="number">140</span>K  <span class="number">1.9</span>G    <span class="number">1</span>% /dev/shm</span><br><span class="line">tmpfs                  <span class="number">1.9</span>G  <span class="number">9.0</span>M  <span class="number">1.9</span>G    <span class="number">1</span>% /run</span><br><span class="line">tmpfs                  <span class="number">1.9</span>G     <span class="number">0</span>  <span class="number">1.9</span>G    <span class="number">0</span>% /sys/fs/cgroup</span><br><span class="line">/dev/mapper/rhel-home   <span class="number">10</span>G   <span class="number">33</span>M   <span class="number">10</span>G    <span class="number">1</span>% /home</span><br><span class="line">/dev/sda1              <span class="number">197</span>M  <span class="number">147</span>M   <span class="number">51</span>M   <span class="number">75</span>% /boot</span><br><span class="line">tmpfs                  <span class="number">378</span>M   <span class="number">36</span>K  <span class="number">378</span>M    <span class="number">1</span>% /run/user/<span class="number">0</span></span><br><span class="line">/dev/sr0               <span class="number">3.8</span>G  <span class="number">3.8</span>G     <span class="number">0</span>  <span class="number">100</span>% /mnt</span><br><span class="line">/dev/sdb1              <span class="number">2.0</span>G  <span class="number">6.0</span>M  <span class="number">1.9</span>G    <span class="number">1</span>% /zabbix</span><br></pre></td></tr></table></figure><p></p></h3></h3></h3></h5></h3></h3></h3></h3>]]></content>
      
      
      <categories>
          
          <category> Disk </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Centos7 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>sphinx+coreseek</title>
      <link href="/2018/10/09/sphinx-coreseek/"/>
      <url>/2018/10/09/sphinx-coreseek/</url>
      
        <content type="html"><![CDATA[<p>sphinx是国外的一款搜索软件,coreseek是在sphinx的基础上，增加了中文分词功能，换句话说，就是支持了中文。<br><a id="more"></a></p><p></p><h3>系统环境<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OS    :Red Hat Enterprise Linux<span class="built_in"> Server </span>release 7.2 (Maipo)</span><br><span class="line">Kernel:3.10.0-327.el7.x86_64</span><br></pre></td></tr></table></figure><p></p><p></p><h3>关闭防火墙和SELINUX<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Selinux：</span><br><span class="line">setenforce 0  宽松模式</span><br><span class="line">sed -i <span class="string">"s/enforcing/disabled/g"</span>  /etc/selinux<span class="built_in">/config </span>  永久关闭</span><br><span class="line">Firewalld：</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="builtin-name">disable</span> firewalld</span><br></pre></td></tr></table></figure><p></p><p></p><h3>创建软件目录<br><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">mkdir</span> -p /<span class="class"><span class="keyword">data</span>/soft</span></span><br><span class="line"><span class="title">cd</span> /<span class="class"><span class="keyword">data</span>/soft</span></span><br></pre></td></tr></table></figure><p></p><p></p><h3>安装服务和依赖包并启动服务设置开机自启<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> httpd php php-devel php-rpm php-mysql mysql  mysql-<span class="keyword">server</span> mysql-devel libtool make gcc gcc-c++ lrzsz</span><br><span class="line"></span><br><span class="line">systemctl <span class="keyword">start</span> httpd</span><br><span class="line">systemctl <span class="keyword">enable</span>  httpd</span><br><span class="line">systemctl <span class="keyword">start</span> mysqld </span><br><span class="line">systemctl <span class="keyword">start</span> mariadb</span><br><span class="line">systemctl <span class="keyword">enable</span> mariadb</span><br><span class="line">systemctl <span class="keyword">start</span> php-fpm</span><br><span class="line">systemctl <span class="keyword">enable</span> php-fpm</span><br></pre></td></tr></table></figure><p></p><p></p><h3>下载 coreseek ， sphinx 编译安装包<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">wget http:<span class="regexp">//</span>files.opstool.com<span class="regexp">/man/</span>coreseek-<span class="number">4.1</span>-beta.tar.gz</span><br><span class="line">wget http:<span class="regexp">//</span>pecl.php.net<span class="regexp">/get/</span>sphinx-<span class="number">1.3</span>.<span class="number">0</span>.tgz</span><br></pre></td></tr></table></figure><p></p><p></p><h3>开始搭建coreseek+sphinx<p></p><p><li>安装mmseg3<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf coreseek<span class="number">-4.1</span>-beta.tar.gz</span><br><span class="line">cd coreseek<span class="number">-4.1</span>-beta/</span><br><span class="line">cd coreseek<span class="number">-4.1</span>-beta/mmseg<span class="number">-3.2</span><span class="number">.14</span></span><br><span class="line">cd mmseg<span class="number">-3.2</span><span class="number">.14</span>/</span><br><span class="line">./bootstrap </span><br><span class="line">./configure --prefix=/usr/local/mmseg3 </span><br><span class="line">make </span><br><span class="line">make install</span><br></pre></td></tr></table></figure></li></p><p></p><h3>安装coreseek<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">yum -y install expat-devel</span><br><span class="line"><span class="built_in">cd</span> ../csft-4.1/</span><br><span class="line">vim src/sphinxexpr.cpp</span><br><span class="line"> </span><br><span class="line">将文件中的T val = ExprEval ( this-&gt;m_pArg, tMatch ) </span><br><span class="line">都修改为    T val = this-&gt;ExprEval ( this-&gt;m_pArg, tMatch ),总共有三处</span><br><span class="line"></span><br><span class="line">vim buildconf.sh </span><br><span class="line">在&amp;&amp; aclocal \   下添加一行 </span><br><span class="line">&amp;&amp; automake --add-missing \</span><br><span class="line"></span><br><span class="line">配置文件：</span><br><span class="line"><span class="meta">#! /bin/sh</span></span><br><span class="line">autoheader \</span><br><span class="line">&amp;&amp; aclocal \</span><br><span class="line">&amp;&amp; automake --add-missing \</span><br><span class="line">&amp;&amp; automake --foreign \</span><br><span class="line">&amp;&amp; autoconf</span><br><span class="line"></span><br><span class="line">vim ./configure.ac </span><br><span class="line"></span><br><span class="line">找到    ：AM_INIT_AUTOMAKE([-Wall -Werror foreign])</span><br><span class="line">修改为: AM_INIT_AUTOMAKE([-Wall foreign])</span><br></pre></td></tr></table></figure><p></p><p></p><h3>生成configure 文件并开始编译安装<br><figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sh buildconf.sh </span><br><span class="line">./configure --prefix=/usr/<span class="keyword">local</span>/coreseek --without-unixodbc --<span class="keyword">with</span>-mmseg --<span class="keyword">with</span>-mmseg-includes=/usr/<span class="keyword">local</span>/mmseg3/<span class="keyword">include</span>/mmseg/ --<span class="keyword">with</span>-mmseg-libs=/usr/<span class="keyword">local</span>/mmseg3/lib/ --<span class="keyword">with</span>-mysql</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p></p><p></p><h3>#如果在编译过程中遇到了报错：error: cannot find input file: src/Makefile.in<br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">解决办法：</span><br><span class="line">aclocal</span><br><span class="line">libtoolize --force</span><br><span class="line">automake --<span class="keyword">add</span><span class="bash">-missing</span></span><br><span class="line"><span class="bash">autoconf</span></span><br><span class="line"><span class="bash">autoheader</span></span><br><span class="line"><span class="bash">make clean</span></span><br><span class="line"><span class="bash"></span></span><br><span class="line"><span class="bash">以上每行为一条命令，执行后即可重新编译。</span></span><br></pre></td></tr></table></figure><p></p><p></p><h3>命令行执行mmseg分词<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">cd ../testpack/</span><br><span class="line">cat var/test/test.xml </span><br><span class="line"></span><br><span class="line">information:</span><br><span class="line">  返回的都是中英文结合。</span><br><span class="line">  </span><br><span class="line">/usr/<span class="built_in">local</span>/mmseg3/bin/mmseg -d /usr/<span class="built_in">local</span>/mmseg3/etc/</span><br><span class="line"></span><br><span class="line">/usr/<span class="built_in">local</span>/coreseek/bin/indexer -c etc/csft.conf <span class="comment">--all</span></span><br><span class="line">information：</span><br><span class="line">Coreseek Fulltext <span class="number">4.1</span> [ Sphinx <span class="number">2.0</span><span class="number">.2</span>-dev (r2922)]</span><br><span class="line">Copyright (c) <span class="number">2007</span><span class="number">-2011</span>,</span><br><span class="line">Beijing Choice Software Technologies Inc (<span class="keyword">http</span>://www.coreseek.com)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">using</span> config <span class="built_in">file</span> <span class="string">'etc/csft.conf'</span>...</span><br><span class="line">indexing index <span class="string">'xml'</span>...</span><br><span class="line">collected <span class="number">3</span> docs, <span class="number">0.0</span> MB</span><br><span class="line">sorted <span class="number">0.0</span> Mhits, <span class="number">100.0</span>% done</span><br><span class="line">total <span class="number">3</span> docs, <span class="number">7585</span> <span class="keyword">bytes</span></span><br><span class="line">total <span class="number">0.004</span> <span class="built_in">sec</span>, <span class="number">1860436</span> <span class="keyword">bytes</span>/<span class="built_in">sec</span>, <span class="number">735.83</span> docs/<span class="built_in">sec</span></span><br><span class="line">total <span class="number">3</span> reads, <span class="number">0.000</span> <span class="built_in">sec</span>, <span class="number">2.8</span> kb/call <span class="built_in">avg</span>, <span class="number">0.0</span> msec/call <span class="built_in">avg</span></span><br><span class="line">total <span class="number">9</span> writes, <span class="number">0.000</span> <span class="built_in">sec</span>, <span class="number">2.2</span> kb/call <span class="built_in">avg</span>, <span class="number">0.0</span> msec/call <span class="built_in">avg</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/usr/<span class="built_in">local</span>/coreseek/bin/search -c etc/csft.conf  网络搜索</span><br><span class="line">information:</span><br><span class="line">Coreseek Fulltext <span class="number">4.1</span> [ Sphinx <span class="number">2.0</span><span class="number">.2</span>-dev (r2922)]</span><br><span class="line">Copyright (c) <span class="number">2007</span><span class="number">-2011</span>,</span><br><span class="line">Beijing Choice Software Technologies Inc (<span class="keyword">http</span>://www.coreseek.com)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">using</span> config <span class="built_in">file</span> <span class="string">'etc/csft.conf'</span>...</span><br><span class="line">index <span class="string">'xml'</span>: query <span class="string">'网络搜索 '</span>: returned <span class="number">1</span> matches <span class="keyword">of</span> <span class="number">1</span> total <span class="keyword">in</span> <span class="number">0.000</span> <span class="built_in">sec</span></span><br><span class="line"></span><br><span class="line">displaying matches:</span><br><span class="line"><span class="number">1.</span> document=<span class="number">1</span>, weight=<span class="number">1590</span>, published=Thu Apr  <span class="number">1</span> <span class="number">22</span>:<span class="number">20</span>:<span class="number">07</span> <span class="number">2010</span>, author_id=<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">words</span>:</span><br><span class="line"><span class="number">1.</span> <span class="string">'网络'</span>: <span class="number">1</span> documents, <span class="number">1</span> hits</span><br><span class="line"><span class="number">2.</span> <span class="string">'搜索'</span>: <span class="number">2</span> documents, <span class="number">5</span> hits</span><br></pre></td></tr></table></figure><p></p><p></p><h3>sphinx扩展安装<p></p><p><li>安装libsphinxclient<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cd ..<span class="regexp">/csft-4.1/</span>api<span class="regexp">/libsphinxclient/</span></span><br><span class="line">.<span class="regexp">/configure --prefix=/</span>usr<span class="regexp">/local/</span>sphinxclient</span><br><span class="line">-报错：</span><br><span class="line">config.<span class="string">status:</span> <span class="string">error:</span> cannot find input <span class="string">file:</span> Makefile.<span class="keyword">in</span></span><br><span class="line"></span><br><span class="line">+解决方案：</span><br><span class="line">aclocal</span><br><span class="line">libtoolize --force</span><br><span class="line">automake --add-missing</span><br><span class="line">autoconf</span><br><span class="line">autoheader</span><br><span class="line">make clean</span><br><span class="line"></span><br><span class="line">重新执行：</span><br><span class="line">.<span class="regexp">/configure --prefix=/</span>usr<span class="regexp">/local/</span>sphinxclient</span><br><span class="line"></span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure></li></p><p></p><h3>安装sphinx的PHP的扩展<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cd <span class="regexp">/data/</span>soft</span><br><span class="line">tar -zxvf sphinx<span class="number">-1.3</span><span class="number">.0</span>.tgz</span><br><span class="line">cd sphinx<span class="number">-1.3</span><span class="number">.0</span></span><br><span class="line">phpize</span><br><span class="line">.<span class="regexp">/configure --with-php-config=/</span>usr<span class="regexp">/bin/</span>php-config --with-sphinx=<span class="regexp">/usr/</span>local/sphinxclient</span><br><span class="line">make </span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="string">information:</span></span><br><span class="line">Installing shared <span class="string">extensions:</span>     <span class="regexp">/usr/</span>lib64<span class="regexp">/php/</span>modules/</span><br></pre></td></tr></table></figure><p></p><p></p><h3>修改php.ini添加扩展<br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">直接写入到最后即可：</span><br><span class="line"></span><br><span class="line">[Extension]</span><br><span class="line">Extension_dir = <span class="string">"/usr/lib64/php/modules/"</span></span><br><span class="line">Extension = sphinx.so</span><br></pre></td></tr></table></figure><p></p><p></p><h3>查看sphinx扩展是否添加成功<br><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">重启php-fpm 服务</span><br><span class="line">systemctl restart php-fpm</span><br><span class="line"></span><br><span class="line">php -m <span class="string">| grep sphinx</span></span><br></pre></td></tr></table></figure><p></p><p></p><h3>创建库并导入表(上传sql表)<br><code>需要sql表的私聊我QQ即可,记得打上备注。</code><br><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">cd /root/</span><br><span class="line"></span><br><span class="line">由于第一次登陆需要修改密码：</span><br><span class="line">mysqladmin -uroot -h127.0.0.1 password <span class="string">"W@k$!%hz"</span></span><br><span class="line"></span><br><span class="line">mysql -uroot -h127.0.0.1 -p'W<span class="meta">@k$!%hz'</span></span><br><span class="line">mariadb&gt; create database sphinx;</span><br><span class="line">mariadb&gt; use sphinx;</span><br><span class="line">mariadb&gt; source jt_news.sql;</span><br><span class="line">mariadb&gt; desc jt_news;</span><br><span class="line">+-------------+-----------------------+------+-----+---------+----------------+</span><br><span class="line">|<span class="string"> Field       </span>|<span class="string"> Type                  </span>|<span class="string"> Null </span>|<span class="string"> Key </span>|<span class="string"> Default </span>|<span class="string"> Extra          </span>|</span><br><span class="line">+-------------+-----------------------+------+-----+---------+----------------+</span><br><span class="line">|<span class="string"> id          </span>|<span class="string"> mediumint(8) unsigned </span>|<span class="string"> NO   </span>|<span class="string"> PRI </span>|<span class="string"> NULL    </span>|<span class="string"> auto_increment </span>|</span><br><span class="line">|<span class="string"> moid        </span>|<span class="string"> tinyint(2) unsigned   </span>|<span class="string"> NO   </span>|<span class="string"> MUL </span>|<span class="string"> 0       </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string"> cat_id      </span>|<span class="string"> smallint(5) unsigned  </span>|<span class="string"> NO   </span>|<span class="string"> MUL </span>|<span class="string"> 0       </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string"> title       </span>|<span class="string"> varchar(80)           </span>|<span class="string"> NO   </span>|<span class="string">     </span>|<span class="string">         </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string"> author      </span>|<span class="string"> varchar(255)          </span>|<span class="string"> NO   </span>|<span class="string">     </span>|<span class="string"> NULL    </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string"> source      </span>|<span class="string"> varchar(255)          </span>|<span class="string"> NO   </span>|<span class="string">     </span>|<span class="string"> NULL    </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string"> img_arr     </span>|<span class="string"> varchar(500)          </span>|<span class="string"> NO   </span>|<span class="string">     </span>|<span class="string"> NULL    </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string"> titlepic    </span>|<span class="string"> varchar(500)          </span>|<span class="string"> NO   </span>|<span class="string">     </span>|<span class="string">         </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string"> is_good     </span>|<span class="string"> tinyint(1) unsigned   </span>|<span class="string"> NO   </span>|<span class="string"> MUL </span>|<span class="string"> 0       </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string"> is_first    </span>|<span class="string"> tinyint(1) unsigned   </span>|<span class="string"> NO   </span>|<span class="string"> MUL </span>|<span class="string"> 0       </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string"> is_top      </span>|<span class="string"> tinyint(1) unsigned   </span>|<span class="string"> NO   </span>|<span class="string"> MUL </span>|<span class="string"> 0       </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string"> keywords    </span>|<span class="string"> char(40)              </span>|<span class="string"> NO   </span>|<span class="string">     </span>|<span class="string">         </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string"> smalltext   </span>|<span class="string"> varchar(256)          </span>|<span class="string"> NO   </span>|<span class="string">     </span>|<span class="string"> NULL    </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string"> is_link     </span>|<span class="string"> varchar(255)          </span>|<span class="string"> NO   </span>|<span class="string">     </span>|<span class="string">         </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string"> username    </span>|<span class="string"> char(20)              </span>|<span class="string"> NO   </span>|<span class="string">     </span>|<span class="string">         </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string"> add_time    </span>|<span class="string"> int(10) unsigned      </span>|<span class="string"> NO   </span>|<span class="string"> MUL </span>|<span class="string"> 0       </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string"> update_time </span>|<span class="string"> int(10) unsigned      </span>|<span class="string"> NO   </span>|<span class="string">     </span>|<span class="string"> 0       </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string"> onclick     </span>|<span class="string"> int(10) unsigned      </span>|<span class="string"> NO   </span>|<span class="string"> MUL </span>|<span class="string"> 0       </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string"> comment_num </span>|<span class="string"> int(10)               </span>|<span class="string"> NO   </span>|<span class="string">     </span>|<span class="string"> NULL    </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string"> is_check    </span>|<span class="string"> tinyint(2) unsigned   </span>|<span class="string"> NO   </span>|<span class="string">     </span>|<span class="string"> 1       </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string"> is_push     </span>|<span class="string"> tinyint(1)            </span>|<span class="string"> NO   </span>|<span class="string"> MUL </span>|<span class="string"> 0       </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string"> video_type  </span>|<span class="string"> varchar(20)           </span>|<span class="string"> NO   </span>|<span class="string">     </span>|<span class="string">         </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string"> video_vid   </span>|<span class="string"> varchar(255)          </span>|<span class="string"> NO   </span>|<span class="string">     </span>|<span class="string">         </span>|<span class="string">                </span>|</span><br><span class="line">|<span class="string"> video_url   </span>|<span class="string"> varchar(255)          </span>|<span class="string"> NO   </span>|<span class="string">     </span>|<span class="string">         </span>|<span class="string">                </span>|</span><br><span class="line">+-------------+-----------------------+------+-----+---------+----------------+</span><br></pre></td></tr></table></figure><p></p><p></p><h3>创建实例配置文件<br><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/coreseek/etc/sphinx.conf</span><br><span class="line">source zt<span class="comment">#数据源</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">type</span>                    = mysql<span class="comment">#数据库类型</span></span><br><span class="line">    <span class="attr">sql_host</span>                = <span class="number">127.0</span>.<span class="number">0.1</span><span class="comment">#登陆主机</span></span><br><span class="line">    <span class="attr">sql_user</span>                = root<span class="comment">#登陆用户</span></span><br><span class="line">    <span class="attr">sql_pass</span>                = W@k$!%hz<span class="comment">#登陆密码</span></span><br><span class="line">    <span class="attr">sql_db</span>                  = sphinx<span class="comment">#查询的库</span></span><br><span class="line">    <span class="attr">sql_port</span>                = <span class="number">3306</span><span class="comment">#数据库端口</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">sql_query_pre</span>           = SET NAMES utf8</span><br><span class="line"><span class="attr">sql_query</span>               = SELECT id,moid,is_good,smalltext,video_url,title,video_vid,keywords,update_time FROM jt_news</span><br><span class="line"></span><br><span class="line">    <span class="attr">sql_attr_uint</span>           = id</span><br><span class="line">    <span class="attr">sql_field_string</span>        = moid</span><br><span class="line">    <span class="attr">sql_field_string</span>        = is_good</span><br><span class="line">    <span class="attr">sql_attr_string</span>         = smalltext</span><br><span class="line">    <span class="attr">sql_attr_string</span>         = video_url</span><br><span class="line">    <span class="attr">sql_field_string</span>        = title</span><br><span class="line">    <span class="attr">sql_field_string</span>        = video_vid</span><br><span class="line">    <span class="attr">sql_field_string</span>        = keywords</span><br><span class="line">    <span class="attr">sql_attr_bigint</span>         = update_time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">#命令行展示</span></span><br><span class="line">    <span class="attr">sql_query_info_pre</span>      = SET NAMES utf8                             </span><br><span class="line">    <span class="attr">sql_query_info</span>          = SELECT * FROM jt_news WHERE <span class="attr">id=$id</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#索引源</span></span><br><span class="line">index zt</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">source</span>                  = zt</span><br><span class="line">    <span class="attr">path</span>                    = /usr/local/coreseek/var/data/zt</span><br><span class="line">    <span class="attr">docinfo</span>                 = extern</span><br><span class="line">    <span class="attr">mlock</span>                   = <span class="number">0</span></span><br><span class="line">    <span class="attr">morphology</span>              = none</span><br><span class="line">    <span class="attr">min_word_len</span>            = <span class="number">1</span></span><br><span class="line">    <span class="attr">html_strip</span>              = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">charset_dictpath</span>        = /usr/local/mmseg3/etc/</span><br><span class="line">    <span class="attr">charset_type</span>            = zh_cn.utf-<span class="number">8</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#全局index定义</span></span><br><span class="line">indexer</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">mem_limit</span>         = <span class="number">512</span>M</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#searchd服务定义</span></span><br><span class="line">searchd</span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">listen</span>            = <span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">9312</span></span><br><span class="line">    <span class="attr">read_timeout</span>      = <span class="number">5</span></span><br><span class="line">    <span class="attr">max_children</span>      = <span class="number">30</span></span><br><span class="line">    <span class="attr">max_matches</span>       = <span class="number">1000</span></span><br><span class="line">    <span class="attr">seamless_rotate</span>   = <span class="number">0</span></span><br><span class="line">    <span class="attr">preopen_indexes</span>   = <span class="number">0</span></span><br><span class="line">    <span class="attr">unlink_old</span>        = <span class="number">1</span></span><br><span class="line">    <span class="attr">pid_file</span>          = /usr/local/coreseek/var/log/searchd_mysql.pid </span><br><span class="line">    <span class="attr">log</span>           = /usr/local/coreseek/var/log/searchd_mysql.log        </span><br><span class="line">    <span class="attr">query_log</span>         = /usr/local/coreseek/var/log/query_mysql.log </span><br><span class="line">    <span class="attr">compat_sphinxql_magics</span> = <span class="number">0</span>                              </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p></p><h3>建立索引<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="built_in">local</span>/coreseek/bin/indexer -c /usr/<span class="built_in">local</span>/coreseek/etc/sphinx.conf <span class="comment">--all</span></span><br><span class="line"></span><br><span class="line">information:</span><br><span class="line"></span><br><span class="line">Coreseek Fulltext <span class="number">4.1</span> [ Sphinx <span class="number">2.0</span><span class="number">.2</span>-dev (r2922)]</span><br><span class="line">Copyright (c) <span class="number">2007</span><span class="number">-2011</span>,</span><br><span class="line">Beijing Choice Software Technologies Inc (<span class="keyword">http</span>://www.coreseek.com)</span><br><span class="line"></span><br><span class="line"> <span class="keyword">using</span> config <span class="built_in">file</span> <span class="string">'/usr/local/coreseek/etc/sphinx.conf'</span>...</span><br><span class="line">indexing index <span class="string">'zt'</span>...</span><br><span class="line">WARNING: attribute <span class="string">'id'</span> <span class="keyword">not</span> found - IGNORING</span><br><span class="line">collected <span class="number">142022</span> docs, <span class="number">12.7</span> MB</span><br><span class="line">sorted <span class="number">3.0</span> Mhits, <span class="number">100.0</span>% done</span><br><span class="line">total <span class="number">142022</span> docs, <span class="number">12652631</span> <span class="keyword">bytes</span></span><br><span class="line">total <span class="number">4.540</span> <span class="built_in">sec</span>, <span class="number">2786362</span> <span class="keyword">bytes</span>/<span class="built_in">sec</span>, <span class="number">31276.08</span> docs/<span class="built_in">sec</span></span><br><span class="line">total <span class="number">3</span> reads, <span class="number">0.006</span> <span class="built_in">sec</span>, <span class="number">7813.4</span> kb/call <span class="built_in">avg</span>, <span class="number">2.0</span> msec/call <span class="built_in">avg</span></span><br><span class="line">total <span class="number">372</span> writes, <span class="number">0.111</span> <span class="built_in">sec</span>, <span class="number">348.0</span> kb/call <span class="built_in">avg</span>, <span class="number">0.2</span> msec/call <span class="built_in">avg</span></span><br></pre></td></tr></table></figure><p></p><p></p><h3>搜索<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">打印出前<span class="number">10</span>行：</span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/coreseek/</span>bin<span class="regexp">/search -c /</span>usr<span class="regexp">/local/</span>coreseek<span class="regexp">/etc/</span>sphinx.conf 美国  | head <span class="number">-10</span></span><br><span class="line"></span><br><span class="line">information：</span><br><span class="line">Coreseek Fulltext <span class="number">4.1</span> [ Sphinx <span class="number">2.0</span><span class="number">.2</span>-dev (r2922)]</span><br><span class="line">Copyright (c) <span class="number">2007</span><span class="number">-2011</span>,</span><br><span class="line">Beijing Choice Software Technologies Inc (<span class="string">http:</span><span class="comment">//www.coreseek.com)</span></span><br><span class="line"></span><br><span class="line"> using config file <span class="string">'/usr/local/coreseek/etc/sphinx.conf'</span>...</span><br><span class="line">index <span class="string">'zt'</span>: query <span class="string">'美国 '</span>: returned <span class="number">1000</span> matches of <span class="number">2362</span> total <span class="keyword">in</span> <span class="number">0.000</span> sec</span><br><span class="line"></span><br><span class="line">displaying <span class="string">matches:</span></span><br><span class="line"><span class="number">1.</span> document=<span class="number">998030</span>, weight=<span class="number">2632</span>, moid=<span class="number">0</span>, is_good=<span class="number">0</span>, smalltext=          海外网<span class="number">2</span>月<span class="number">9</span>日电 据美联社报道，美国参议院将在午夜前休会，目前未就短期支出法案进行投票，美国政府将确定停摆。此前据路透社消息，当地时间<span class="number">8</span>日，美国行政管理和预算局（OMB）表示，如果在午夜之间没有通过拨款法案，美国政府恐将再次关门。另据美国《世界日报》早前消息，美国国会参议院<span class="number">7</span>日达成两党预算协议，并将于<span class="number">8</span>日表决。若能通过，不仅联邦政府<span class="number">9</span>日起不会再度关门，未来一年多还不必担心政府债务违约。, video_url=, title=一个月内第二次！美国联邦政府再次陷入停摆, video_vid=, keywords=美国政府,美国国会参议院,美国联邦政府, update_time=<span class="number">0</span></span><br><span class="line">id=<span class="number">998030</span></span><br></pre></td></tr></table></figure><p></p><p></p><h3>添加计划任务<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="regexp">/var/</span>spool<span class="regexp">/cron/</span>root</span><br><span class="line"></span><br><span class="line"><span class="number">00</span> <span class="number">03</span><span class="regexp">/* * * * /u</span>sr<span class="regexp">/local/</span>coreseek<span class="regexp">/bin/i</span>ndexer -c <span class="regexp">/usr/</span>local<span class="regexp">/coreseek/</span>etc<span class="regexp">/sphinx.conf --all –rotate</span></span><br></pre></td></tr></table></figure><p></p></h3></h3></h3></h3></h3></h3></h3></h3></h3></h3></h3></h3></h3></h3></h3></h3></h3></h3></h3>]]></content>
      
      
      <categories>
          
          <category> sphinx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sphinx </tag>
            
            <tag> coreseek </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>docker-command</title>
      <link href="/2018/10/08/docker-command/"/>
      <url>/2018/10/08/docker-command/</url>
      
        <content type="html"><![CDATA[<p>Docker 非常适合开发使用想要环境基本直接拉取即可，快捷方便。<br><a id="more"></a></p><p>我用的是windwos安装的Docker。(DockerToolbox 安装包)</p><p><a href="https://soliton.net.cn/download/windwos/Docker.exe" target="_blank" rel="noopener">docker for windwos 下载</a><br><a href="https://soliton.net.cn/download/windwos/DockerToolbox.exe" target="_blank" rel="noopener">DockerToolbox 下载</a></p><p>windwos toolbox  更换镜像源：<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker-machine ssh default<span class="comment">#进入docker 虚拟机</span></span><br><span class="line">vi /var/<span class="class"><span class="keyword">lib</span>/<span class="title">boot2docker</span>/<span class="title">profile</span><span class="comment">#添加国内源 </span></span></span><br><span class="line">--registry-mirror <span class="symbol">https:</span>/<span class="regexp">/docker.mirrors.ustc.edu.cn    #在--label provider=virtualbox的下一行添加并保存退出</span></span><br><span class="line"><span class="regexp">/etc</span><span class="regexp">/init.d/docker</span> restart<span class="comment">#重启docker 服务</span></span><br><span class="line">docker info<span class="comment">#返回的最后面会显示刚刚添加的国内源</span></span><br></pre></td></tr></table></figure></p><p>docker for windows：<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">设置（settings）<span class="comment">---</span></span><br><span class="line">Daemon<span class="comment">---</span></span><br><span class="line">Registry mirrors：（添加docker源 ）</span><br><span class="line"><span class="keyword">https</span>://docker.mirrors.ustc.edu.cn  </span><br><span class="line"><span class="comment">-- Apply(保存)  等待重启即可</span></span><br></pre></td></tr></table></figure></p><p>查看docekr 信息 ：<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker</span> <span class="literal">info</span></span><br></pre></td></tr></table></figure></p><p>查看docker虚拟机状态/虚拟机：<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker-machine ls</span></span><br></pre></td></tr></table></figure></p><p>登陆docker 虚拟机:</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker-machine ssh <span class="built_in"> default</span>#docker用户的默认密码是   “tcuser”</span><br><span class="line">sudo -i #进入root 用户</span><br></pre></td></tr></table></figure><p>查看docker虚拟机变量：<br><figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">docker</span>-machine env <span class="keyword">default</span></span><br></pre></td></tr></table></figure></p><p>查看docker虚拟机里的镜像:<br><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images/  docker <span class="keyword">image</span> <span class="keyword">ls</span></span><br></pre></td></tr></table></figure></p><p>查看当前有哪些容器：<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker ps -a</span></span><br></pre></td></tr></table></figure></p><p>获取镜像：<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">docker</span> <span class="selector-tag">pull</span> <span class="selector-tag">centos</span> (获取centos 镜像)</span><br><span class="line"><span class="selector-tag">docker</span> <span class="selector-tag">search</span> <span class="selector-tag">centos</span><span class="selector-pseudo">:6.5</span>(搜索centos6.<span class="number">5</span>镜像 )</span><br><span class="line"><span class="selector-tag">docker</span> <span class="selector-tag">pull</span> <span class="selector-attr">[选项]</span> <span class="selector-attr">[Docker Registry 地址[:端口号]</span>/]仓库名<span class="selector-attr">[:标签]</span></span><br></pre></td></tr></table></figure></p><p>查看镜像、容器、数据卷所占用的空间：<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker<span class="built_in"> system </span>df</span><br></pre></td></tr></table></figure></p><p>删除docker本地镜像:<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker image rm [镜像<span class="number">1</span>、镜像<span class="number">2</span>]   镜像可以是长ID 和短ID，镜像名都可以</span><br></pre></td></tr></table></figure></p><p>删除所有仓库名为 centos 的镜像：<br><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">image</span> rm $(docker <span class="keyword">image</span> <span class="keyword">ls</span> -q centos)</span><br></pre></td></tr></table></figure></p><p>删除所有在 mongo:3.2 之前的镜像：<br><figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="keyword">image</span> rm $(docker <span class="keyword">image</span> <span class="keyword">ls</span> -q -f before=mongo:<span class="number">3.2</span>)</span><br></pre></td></tr></table></figure></p><p>启动docker容器<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker   <span class="built_in">run</span> -<span class="keyword">it</span> <span class="comment">--name WebServer  -p 80:80  -p81:81centos /bin/bash</span></span><br><span class="line">给启动的容器起名   映射端口<span class="number">80</span>和<span class="number">81</span>centos 是镜像名解释器</span><br></pre></td></tr></table></figure></p><p>查看容器存储层改动：<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker diff WebServer</span></span><br></pre></td></tr></table></figure></p><p>进入容器：<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -<span class="keyword">it</span> WebServer /bin/bash</span><br></pre></td></tr></table></figure></p><p>利用容器存储层提交并生成新的镜像：<br><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">docker </span> <span class="string">commit </span> <span class="built_in">--author</span> <span class="string">"作者名"</span>  <span class="built_in">--message</span> “修改的内容” <span class="string">WebServer </span>（运行的镜像）  <span class="string">WebServer:v2 </span>（提交后的镜像名）</span><br></pre></td></tr></table></figure></p><p>上传提交OK的镜像到自己的仓库（例如你账号用户名是 dockerimages   那么的你的镜像应该是   dockerimages/xxxxx  不然上传不了）<br><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">docker login<span class="meta">#登陆docker账号</span></span><br><span class="line">username：dockerimages<span class="meta">#输入用户名</span></span><br><span class="line"><span class="symbol">password:</span><span class="meta">#输入密码（不显示也不会有光标移动）</span></span><br><span class="line">Login Succeeded<span class="meta">#返回信息</span></span><br><span class="line"></span><br><span class="line">docker <span class="keyword">push</span> centos<span class="meta">#上传镜像这样的会返回认证</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">errors:</span></span><br><span class="line"><span class="symbol">denied:</span> requested access to the resource is denied</span><br><span class="line"><span class="symbol">unauthorized:</span> authentication required</span><br><span class="line"></span><br><span class="line">docker <span class="keyword">push</span> dockerimages/centos <span class="meta">#这样才行（前面是用户名）</span></span><br><span class="line"></span><br><span class="line">注：在上传过程中失败可以继续上传，上传失败是正常的。</span><br></pre></td></tr></table></figure></p><p>查看镜像的历史纪录:<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">docker</span> history WebServer:<span class="built_in">v2</span></span><br></pre></td></tr></table></figure></p><p>批量删除容器:<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker</span> ps -a | awk <span class="string">'&#123;print <span class="variable">$1</span>&#125;'</span> | xargs docker rm</span><br></pre></td></tr></table></figure></p><p>删除停止的容器:<br><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm $(docker ps --<span class="built_in">all</span> -q -f <span class="keyword">status</span>=exited)</span><br></pre></td></tr></table></figure></p><p>批量启动容器:<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -<span class="keyword">a</span> | awk <span class="string">'&#123;print $1&#125;'</span> | xargs docker <span class="built_in">start</span></span><br></pre></td></tr></table></figure></p><p>批量关闭容器:<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -<span class="keyword">a</span> | awk <span class="string">'&#123;print $1&#125;'</span> | xargs docker <span class="built_in">stop</span></span><br></pre></td></tr></table></figure></p><p>批量删除镜像:<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">docker</span> images | awk <span class="string">'&#123;print <span class="variable">$3</span>&#125;'</span> | xargs docker rm</span><br></pre></td></tr></table></figure></p><p>删除所有未运行 Docker 容器:<br><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rm $<span class="comment">(docker ps -a -q)</span></span><br></pre></td></tr></table></figure></p><p>挂载目录：<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">docker</span> run -<span class="keyword">it </span>-v /e/docker:/<span class="meta">data</span> -p <span class="number">80</span>:<span class="number">80</span> centos <span class="keyword">bash</span></span><br><span class="line"><span class="keyword">-v </span>指定宿主机的共享目录 ，/<span class="meta">data</span> 是启动容器的时候会创建/<span class="meta">data</span> 并挂载宿主机的/e/docker目录。</span><br></pre></td></tr></table></figure></p><p>把文件系统打包tar    :文件系统:test01<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="builtin-name">export</span> test01 &gt; test01.tar</span><br></pre></td></tr></table></figure></p><p>导入文件系统：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">docker</span> <span class="selector-tag">import</span> <span class="selector-tag">test01</span><span class="selector-class">.tar</span> <span class="selector-tag">centos</span><span class="selector-pseudo">:latest</span></span><br></pre></td></tr></table></figure></p><p>导出完整的容器<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">docker</span> <span class="selector-tag">save</span> <span class="selector-tag">mysql</span> &gt; <span class="selector-tag">mysql</span><span class="selector-class">.tar</span></span><br></pre></td></tr></table></figure></p><p>导入完整的容器<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker load -<span class="selector-tag">i</span>  mysql.tar</span><br></pre></td></tr></table></figure></p><h3>以上仅供参考</h3>]]></content>
      
      
      <categories>
          
          <category> Docker-常用命令 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> -Docker </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>zabbix_monitor_Mysql</title>
      <link href="/2018/09/21/zabbix-monitor-Mysql/"/>
      <url>/2018/09/21/zabbix-monitor-Mysql/</url>
      
        <content type="html"><![CDATA[<p>利用Zabbix 监控服务利用Percona 插件监控Mysql 数据库</p><a id="more"></a><p>系统环境<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OS    :Red Hat Enterprise Linux<span class="built_in"> Server </span>release 7.2 (Maipo)</span><br><span class="line">Kernel:3.10.0-327.el7.x86_64</span><br></pre></td></tr></table></figure></p><p>关闭防火墙和SELINUX<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Selinux：</span><br><span class="line">setenforce 0  宽松模式</span><br><span class="line">sed -i <span class="string">"s/enforcing/disabled/g"</span>  /etc/selinux<span class="built_in">/config </span>  永久关闭</span><br><span class="line">Firewalld：</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="builtin-name">disable</span> firewalld</span><br></pre></td></tr></table></figure></p><p>Zabbix 利用Percona插件监控MySQL</p><p><li>被监控部署路径是:/usr/local/Zabbix</li></p><p><li>被监控主机Mysql路径：/usr/local/mysql<br>确保被监控主机没有安装percona 相关软件，有则卸载<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -<span class="keyword">qa</span> | <span class="keyword">grep</span> percona</span><br></pre></td></tr></table></figure></li></p><p>下载rpm插件：<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https:<span class="regexp">//</span>soliton.net.cn<span class="regexp">/download/</span>linux<span class="regexp">/percona-zabbix-templates-1.1.6-1.noarch.rpm</span></span><br></pre></td></tr></table></figure></p><p>安装插件：<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh percona-zabbix-templates-<span class="number">1.1</span>.<span class="number">6</span>-<span class="number">1</span>.noarch.rpm</span><br><span class="line"></span><br><span class="line">Scripts are installed to /var/<span class="class"><span class="keyword">lib</span>/<span class="title">zabbix</span>/<span class="title">percona</span>/<span class="title">scripts</span></span></span><br><span class="line">Templates are installed to /var/<span class="class"><span class="keyword">lib</span>/<span class="title">zabbix</span>/<span class="title">percona</span>/<span class="title">templates</span></span></span><br></pre></td></tr></table></figure></p><p>将percona的两个脚本放到被监控的/usr/local/zabbix目录下<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /var/<span class="class"><span class="keyword">lib</span>/<span class="title">zabbix</span>/<span class="title">percona</span>/<span class="title">scripts</span>/* /<span class="title">usr</span>/<span class="title">local</span>/<span class="title">zabbix</span>/</span></span><br></pre></td></tr></table></figure></p><p>在被监控机器上将userparameter_percona_mysql.conf拷贝到zabbix_agent的对应配置目录下<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp /var/<span class="class"><span class="keyword">lib</span>/<span class="title">zabbix</span>/<span class="title">percona</span>/<span class="title">templates</span>/<span class="title">userparameter_percona_mysql</span>.<span class="title">conf</span> /<span class="title">usr</span>/<span class="title">local</span>/<span class="title">zabbix</span>/<span class="title">etc</span>/<span class="title">zabbix_agentd</span>.<span class="title">conf</span>.<span class="title">d</span>/</span></span><br><span class="line">sed -i <span class="string">'s#/var/lib/zabbix/percona/scripts/#/usr/local/zabbix/#g'</span> /usr/local/zabbix/etc/zabbix_agentd.conf.d/userparameter_percona_mysql.conf</span><br></pre></td></tr></table></figure></p><p>注意修改客户端机器的zabbix_agentd.conf文件,增加Include 把userparameter_percona_mysql.conf 所在的目录增加进去：<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cat</span> /usr/<span class="keyword">local</span>/zabbix/etc/zabbix_agentd.<span class="keyword">conf</span>|grep <span class="keyword">Include</span></span><br><span class="line"><span class="keyword">Include</span>=/usr/<span class="keyword">local</span>/zabbix/etc/zabbix_agentd.<span class="keyword">conf</span>.<span class="keyword">d</span>/</span><br></pre></td></tr></table></figure></p><p>修改mysql执行命令路径（如下脚本，可以监控到mysql的主从同步状态）<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="regexp">/usr/</span>local<span class="regexp">/zabbix/</span>get_mysql_stats_wrapper.sh</span><br><span class="line">RES=`HOME=~zabbix mysql -e <span class="string">'SHOW SLAVE STATUS\G'</span> | egrep <span class="string">'(Slave_IO_Running|Slave_SQL_Running):'</span> | awk -<span class="string">F:</span> <span class="string">'&#123;print $2&#125;'</span> | tr <span class="string">'\n'</span> <span class="string">','</span>`</span><br><span class="line"></span><br><span class="line">换成：</span><br><span class="line">RES=`<span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span>bin/mysql -p123456 -e <span class="string">'SHOW SLAVE STATUS\G'</span> | egrep <span class="string">'(Slave_IO_Running|Slave_SQL_Running):'</span> | awk -<span class="string">F:</span> <span class="string">'&#123;print $2&#125;'</span> | tr <span class="string">'\n'</span> <span class="string">','</span>`</span><br></pre></td></tr></table></figure></p><p>然后修改/usr/local/zabbix/ss_get_mysql_stats.php脚本，这里主要修改用户名密码：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">mysql_user = <span class="string">'mysqlz'</span>;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">mysql_pass = <span class="string">'mysql@12345678'</span>;</span></span><br><span class="line"><span class="meta">$</span><span class="bash">mysql_port = 3306;</span></span><br></pre></td></tr></table></figure></p><p>授权MySQL用户<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GRANT</span> <span class="keyword">SELECT</span>, PROCESS, SUPER, <span class="keyword">REPLICATION</span> <span class="keyword">CLIENT</span> <span class="keyword">ON</span> *.* <span class="keyword">TO</span> <span class="string">'mysqlz'</span>@<span class="string">'localhost'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">"mysql@12345678"</span>;</span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br></pre></td></tr></table></figure></p><p>修改被监控主机的zabbix权限，并重启zabbix_agent服务最后记得重启下zabbix_agent(重启前要保证zabbix的配置文件和监控脚本的权限正确，否则就会采集不到监控数据)<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">chown</span> -R zabbix.zabbix  /usr/<span class="keyword">local</span>/zabbix</span><br><span class="line"><span class="keyword">chmod</span> -R <span class="number">755</span> /usr/<span class="keyword">local</span>/zabbix/get*</span><br><span class="line"><span class="keyword">chmod</span> -R <span class="number">755</span> /usr/<span class="keyword">local</span>/zabbix/ss*</span><br></pre></td></tr></table></figure></p><p>另外，要添加zabbix的sudo权限<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat <span class="meta-keyword">/etc/</span>sudoers</span><br><span class="line">zabbix ALL=(ALL) NOPASSWD: <span class="meta-keyword">/sbin/</span>blockdev</span><br><span class="line"><span class="meta">#Defaults requiretty   <span class="comment">//如果有这个配置项，那么就注释掉这个。没有的话就忽略</span></span></span><br></pre></td></tr></table></figure></p><p>重启服务<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">restart</span> zabbix_agentd</span><br></pre></td></tr></table></figure></p><p>在服务器zabbix-server测试下（127.0.0.1是被服务端主机的ip地址,也可以写客户端的IP）：<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/local/zabbix/bin/zabbix_get -s <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>  -p <span class="number">10050</span> -k <span class="string">"MySQL.Threads-connected"</span></span><br></pre></td></tr></table></figure></p><p>然后再服务端网页上把模板上传&lt;zabbix_agent_template_percona_mysql_server_ht_2.0.9-sver1.1.6.xml&gt;<br><a href="https://soliton.net.cn/download/linux/zabbix_agent_template_percona_mysql_server_ht_2.0.9-sver1.1.6.xml" target="_blank" rel="noopener">下载模板</a><br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget  https://soliton.net.cn/download/linux/zabbix_agent_template_percona_mysql_server_ht_2<span class="meta">.0</span><span class="meta">.9</span>-sver1<span class="meta">.1</span><span class="meta">.6</span>.xml</span><br></pre></td></tr></table></figure></p><p>把被监控主机添加监控MySQL模板</p><h3>利用Percona 插件监控Mysql数据库结束</h3>]]></content>
      
      
      <categories>
          
          <category> ZABBIX </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Monitor </tag>
            
            <tag> Mysql </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>zabbix_wechat_Give an alarm</title>
      <link href="/2018/09/21/zabbix-wechat-Give-an-alarm/"/>
      <url>/2018/09/21/zabbix-wechat-Give-an-alarm/</url>
      
        <content type="html"><![CDATA[<p>zabbix配置微信告警，配置监控模板的触发器进行微信告警<br><a id="more"></a></p><h3><a href="https://www.soliton.wang/2018/09/20/Service-ZABBIX-3-4-8-install/#more">点击我查看zabbix监控服务搭建</a></h3><p>配置微信监控之前需要注册企业微信，注册也不麻烦，几分钟的事情</p><p>微信企业号申请</p><p><ul><a href="https://work.weixin.qq.com/" target="_blank" rel="noopener">微信企业号申请</a></ul><br><code>注</code>:在设置告警的时候我们需要用到 <code>CorpID</code>（企业信息），自己创建的应用（<code>AgentID，Secret</code>），还有设置哪个部门能够接受告警信息的到部门的（<code>ID</code>）号、部门的哪个成员 成员的名称，记住这五个就行了。<br><img src="https://soliton.net.cn/soliton.images/zabbixwx1.png"><br><img src="https://soliton.net.cn/soliton.images/zabbixwx2.jpg"><br><img src="https://soliton.net.cn/soliton.images/zabbixwx3.png"><br><img src="https://soliton.net.cn/soliton.images/zabbixwx4.png"></p><p>确认zabbix存放脚本目录<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grep</span> alertscripts <span class="regexp">/usr/</span>local<span class="regexp">/zabbix/</span>zabbix_server.conf</span><br><span class="line"></span><br><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/zabbix/</span>alertscripts</span><br></pre></td></tr></table></figure></p><p>下载脚本<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd <span class="regexp">/usr/</span>local<span class="regexp">/zabbix/</span>alertscripts</span><br><span class="line">wget https:<span class="regexp">//</span>soliton.net.cn<span class="regexp">/download/</span>linux<span class="regexp">/wechat</span></span><br></pre></td></tr></table></figure></p><p>赋予wechat脚本权限以及更改属主属组<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">chmod</span>   <span class="number">755</span> wechat</span><br><span class="line"><span class="keyword">chown</span>  zabbix:zabbix wechat</span><br></pre></td></tr></table></figure></p><p>执行脚本测试<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">./wechat <span class="attribute">--corpid</span>=企业ID  <span class="attribute">--corpsecret</span>=Secret_ID <span class="attribute">-msg</span>=<span class="string">"发送的内容"</span> <span class="attribute">-user</span>=用户账号  <span class="attribute">-agentid</span>=1000002</span><br><span class="line"></span><br><span class="line">提示 &#123;<span class="string">"errcode"</span>:0,<span class="string">"errmsg"</span>:<span class="string">"ok"</span>,<span class="string">"invaliduser"</span>:<span class="string">""</span>&#125; ，说明成功，手机微信回收告警</span><br><span class="line">--corpid= 我们企业里面的id</span><br><span class="line">--corpsecret= 这里就是我们Secret里面的id</span><br><span class="line">-msg= 内容</span><br><span class="line"><span class="attribute">-user</span>=我们邀请用户的账号</span><br><span class="line">因为脚本是编译过的，无法进行编辑，我们可以使用./wechat -h <span class="keyword">or</span> --help 查看</span><br></pre></td></tr></table></figure></p><p>zabbix网页配置微信告警</p><p><ul>创建报警媒介</ul><br><img src="https://soliton.net.cn/soliton.images/zabbixwxpt1.png"><br><img src="https://soliton.net.cn/soliton.images/zabbixwxpt2.png"><br>创建告警用户<br><img src="https://soliton.net.cn/soliton.images/zabbixwxpt3.png"><br><img src="https://soliton.net.cn/soliton.images/zabbixwxpt4.png"><br><img src="https://soliton.net.cn/soliton.images/zabbixwxpt5.png"><br>创建告警动作<br><img src="https://soliton.net.cn/soliton.images/zabbixwxpt6.png"><br><img src="https://soliton.net.cn/soliton.images/zabbixwxpt7.png"><br><img src="https://soliton.net.cn/soliton.images/zabbixwx8.png"></p><p>测试告警服务</p><p>可以在一台电脑上关闭服务。前提是要监控关闭的服务才可行。</p><p>&lt;微信告警服务配置完成&gt;</p>]]></content>
      
      
      <categories>
          
          <category> ZABBIX </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Monitor </tag>
            
            <tag> WeChat </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>zabbix_agentd_install</title>
      <link href="/2018/09/21/zabbix-agentd-install/"/>
      <url>/2018/09/21/zabbix-agentd-install/</url>
      
        <content type="html"><![CDATA[<p>搭建zabbix客户端，是zabbix服务端能够监控到客户端的资源</p><a id="more"></a><p>系统环境<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OS    :Red Hat Enterprise Linux<span class="built_in"> Server </span>release 7.2 (Maipo)</span><br><span class="line">Kernel:3.10.0-327.el7.x86_64</span><br></pre></td></tr></table></figure></p><p>关闭防火墙和SELINUX<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Selinux：</span><br><span class="line">setenforce 0  宽松模式</span><br><span class="line">sed -i <span class="string">"s/enforcing/disabled/g"</span>  /etc/selinux<span class="built_in">/config </span>  永久关闭</span><br><span class="line">Firewalld：</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="builtin-name">disable</span> firewalld</span><br></pre></td></tr></table></figure></p><p>下载<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https:<span class="regexp">//</span>soliton.net.cn<span class="regexp">/download/</span>linux<span class="regexp">/zabbix-3.4.8.tar.gz</span></span><br></pre></td></tr></table></figure></p><p>创建zabbix用户和组<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">groupadd zabbix</span><br><span class="line">useradd zabbix -s <span class="regexp">/sbin/</span>nologin -M -g zabbix</span><br></pre></td></tr></table></figure></p><p>解压<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">tar</span> <span class="selector-tag">-xf</span> <span class="selector-tag">zabbix-3</span><span class="selector-class">.4</span><span class="selector-class">.8</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br><span class="line"><span class="selector-tag">cd</span> <span class="selector-tag">zabbix-3</span><span class="selector-class">.4</span><span class="selector-class">.8</span></span><br></pre></td></tr></table></figure></p><p>安装编译工具<br><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">yum</span> <span class="literal">-</span><span class="comment">y</span> <span class="comment">install</span> <span class="comment">gcc</span> <span class="comment">gcc</span><span class="literal">-</span><span class="comment">c</span><span class="literal">+</span><span class="literal">+</span> <span class="comment">make</span></span><br></pre></td></tr></table></figure></p><p>编译安装<br><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/usr/<span class="keyword">local</span>/zabbix   --<span class="keyword">enable</span>-agent &amp;&amp; <span class="built_in">make</span> install</span><br></pre></td></tr></table></figure></p><p>修改配置文件指定zabbix服务端的IP和端口<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="meta-keyword">/usr/</span>local<span class="meta-keyword">/zabbix/</span>etc/zabbix_agentd.conf</span><br><span class="line"></span><br><span class="line">Server=<span class="number">10.10</span><span class="number">.1</span><span class="number">.100</span>                  <span class="comment">//91行</span></span><br><span class="line">ServerActive=<span class="number">10.10</span><span class="number">.1</span><span class="number">.100</span>:<span class="number">10051</span>      <span class="comment">//132行</span></span><br></pre></td></tr></table></figure></p><p>复制启动文件到  /etc/init.d/<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp misc<span class="regexp">/init.d/</span>fedora<span class="regexp">/core/</span>zabbix_agentd  <span class="regexp">/etc/i</span>nit.d<span class="regexp">/</span></span><br></pre></td></tr></table></figure></p><p>赋予启动文件权限并修改zabbix安装目录路径<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">chmod +x <span class="meta-keyword">/etc/</span>init.d/zabbix_agentd</span><br><span class="line"></span><br><span class="line">vim <span class="meta-keyword">/etc/</span>init.d/zabbix_agentd</span><br><span class="line"></span><br><span class="line">BASEDIR=<span class="meta-keyword">/usr/</span>local/zabbix       <span class="comment">//22行</span></span><br></pre></td></tr></table></figure></p><p>将 zabbix_agentd 添加到系统服务管理<br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig --<span class="keyword">add</span><span class="bash"> zabbix_agentd</span></span><br></pre></td></tr></table></figure></p><p>启动服务,查看服务状态和端口<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="keyword">start</span> zabbix_agentd</span><br><span class="line">systemctl <span class="keyword">status</span> zabbix_agentd</span><br><span class="line">netstat -antpu | grep zabbix_agentd</span><br></pre></td></tr></table></figure></p><h3>zabbix_agentd客户端配置完成</h3>]]></content>
      
      
      <categories>
          
          <category> ZABBIX </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Monitor </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>zabbix_monitor_Oracle</title>
      <link href="/2018/09/21/zabbix-monitor-Oracle/"/>
      <url>/2018/09/21/zabbix-monitor-Oracle/</url>
      
        <content type="html"><![CDATA[<p>利用orabbix插件 监控oracle数据库<br><a id="more"></a><br>系统环境<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OS    :Red Hat Enterprise Linux<span class="built_in"> Server </span>release 7.2 (Maipo)</span><br><span class="line">Kernel:3.10.0-327.el7.x86_64</span><br></pre></td></tr></table></figure></p><p>关闭防火墙和SELINUX<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Selinux：</span><br><span class="line">setenforce 0  宽松模式</span><br><span class="line">sed -i <span class="string">"s/enforcing/disabled/g"</span>  /etc/selinux<span class="built_in">/config </span>  永久关闭</span><br><span class="line">Firewalld：</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="builtin-name">disable</span> firewalld</span><br></pre></td></tr></table></figure></p><p>安装orabbix插件</p><p><li>下载orabbix插件</li></p><p><li>安装java</li><br><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir <span class="string">/ora</span></span><br><span class="line"><span class="keyword">cd</span> <span class="string">/ora</span></span><br><span class="line">wget https:<span class="string">//soliton.net.cn/download/linux/orabbix-1.2.3.zip</span></span><br><span class="line">yum -y install java</span><br></pre></td></tr></table></figure></p><p>解压orabbix文件包完就可以删除掉<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">unzip</span> <span class="selector-tag">orabbix-1</span><span class="selector-class">.2</span><span class="selector-class">.3</span><span class="selector-class">.zip</span></span><br><span class="line"><span class="selector-tag">rm</span> <span class="selector-tag">-rf</span> <span class="selector-tag">orabbix-1</span><span class="selector-class">.2</span><span class="selector-class">.3</span><span class="selector-class">.zip</span></span><br></pre></td></tr></table></figure></p><p>复制/ora/conf/config.props.sample 到当前目录改成/ora/conf/config.props<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp  <span class="regexp">/ora/</span>conf<span class="regexp">/config.props.sample /</span>ora<span class="regexp">/conf/</span>config.props</span><br></pre></td></tr></table></figure></p><p>修改配置文件：DatabaseList=oracledb  （这里和数据库服务一样）</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">vim /ora/conf/config.props</span><br><span class="line"></span><br><span class="line"><span class="attr">ZabbixServerList=ZabbixServer1</span></span><br><span class="line">ZabbixServer1.<span class="attr">Address=10.10.1.100</span>     zabbix服务端<span class="number">1</span>的IP</span><br><span class="line">ZabbixServer1.<span class="attr">Port=10051</span>              zabbix服务端<span class="number">1</span>的端口</span><br><span class="line">OrabbixDaemon.<span class="attr">PidFile=./logs/orabbix.pid</span></span><br><span class="line">OrabbixDaemon.<span class="attr">Sleep=300</span></span><br><span class="line">OrabbixDaemon.<span class="attr">MaxThreadNumber=100</span></span><br><span class="line"><span class="attr">DatabaseList=oracledb</span>                     // 这里可以随意改，但下面的oracledb也要改成和这个一样的</span><br><span class="line">DatabaseList.<span class="attr">MaxActive=10</span></span><br><span class="line">DatabaseList.<span class="attr">MaxWait=100</span></span><br><span class="line">DatabaseList.<span class="attr">MaxIdle=1</span></span><br><span class="line">oracledb.<span class="attr">Url=jdbc:oracle:thin:@10.10.1.100:1521:orcl</span>        oracle服务IP和端口实例</span><br><span class="line">oracledb.<span class="attr">User=zabbix</span>                                        监控授权用户</span><br><span class="line">oracledb.<span class="attr">Password=123456</span>                                    监控授权密码</span><br><span class="line">oracledb.<span class="attr">MaxActive=10</span></span><br><span class="line">oracledb.<span class="attr">MaxWait=100</span></span><br><span class="line">oracledb.<span class="attr">MaxIdle=1</span></span><br><span class="line">oracledb.<span class="attr">QueryListFile=./conf/query.props</span></span><br></pre></td></tr></table></figure><p>登录oracle创建并授权<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">su - oracle</span><br><span class="line">sqlplus / as sysdba</span><br><span class="line">CREATE<span class="built_in"> USER </span> zabbix IDENTIFIED BY 123456<span class="built_in"> DEFAULT </span>TABLESPACE<span class="built_in"> SYSTEM </span>TEMPORARY TABLESPACE TEMP<span class="built_in"> PROFILE DEFAULT </span>ACCOUNT UNLOCK;</span><br><span class="line">GRANT CONNECT <span class="keyword">TO</span> zabbix;</span><br><span class="line">GRANT<span class="built_in"> RESOURCE </span><span class="keyword">TO</span>  zabbix;</span><br><span class="line">ALTER<span class="built_in"> USER </span> zabbix<span class="built_in"> DEFAULT </span>ROLE ALL;</span><br><span class="line">GRANT SELECT ANY TABLE <span class="keyword">TO</span> zabbix;</span><br><span class="line">GRANT CREATE SESSION <span class="keyword">TO</span>  zabbix;</span><br><span class="line">GRANT SELECT ANY DICTIONARY <span class="keyword">TO</span>  zabbix;</span><br><span class="line">GRANT UNLIMITED TABLESPACE <span class="keyword">TO</span>  zabbix;</span><br><span class="line">GRANT SELECT ANY DICTIONARY <span class="keyword">TO</span>  zabbix;</span><br><span class="line">GRANT SELECT ON V_<span class="variable">$SESSION</span> <span class="keyword">TO</span> zabbix;</span><br><span class="line">GRANT SELECT ON V_<span class="variable">$SYSTEM_EVENT</span> <span class="keyword">TO</span>  zabbix;</span><br><span class="line">GRANT SELECT ON V_<span class="variable">$EVENT_NAME</span> <span class="keyword">TO</span>  zabbix;</span><br><span class="line">GRANT SELECT ON V_<span class="variable">$RECOVERY_FILE_DEST</span> <span class="keyword">TO</span>  zabbix;</span><br></pre></td></tr></table></figure></p><p>将启动orabbix脚本拷贝到/etc/init.d/目录下，并赋予执行权限<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp <span class="regexp">/ora/i</span>nit.d<span class="regexp">/orabbix  /</span>etc<span class="regexp">/init.d/</span></span><br><span class="line">chmod +x <span class="regexp">/etc/i</span>nit.d<span class="regexp">/orabbix /</span>ora<span class="regexp">/run.sh</span></span><br></pre></td></tr></table></figure></p><p>修改启动文件路径<br><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim <span class="string">/etc/init.d/orabbix</span></span><br><span class="line"></span><br><span class="line">orabbix=<span class="string">/ora</span>          <span class="string">//</span> orabbix解压目录</span><br></pre></td></tr></table></figure></p><p>将orabbix添加系统服务器管理<br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig  --<span class="keyword">add</span><span class="bash"> orabbix</span></span><br></pre></td></tr></table></figure></p><p>启动orabbix服务，查看服务状态，另起终端并观察orabbix日志。<br><figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">systemctl start orabbix</span><br><span class="line"></span><br><span class="line">启动时出现如下警告：</span><br><span class="line">Warning: orabbix.service changed on disk. Run <span class="string">'systemctl daemon-reload'</span> <span class="keyword">to</span> <span class="built_in">reload</span> <span class="built_in">units</span>.</span><br><span class="line"></span><br><span class="line">执行：</span><br><span class="line">systemctl daemon-<span class="built_in">reload</span></span><br><span class="line"></span><br><span class="line">重新执行启动即可</span><br><span class="line"></span><br><span class="line">另起终端观察orabbix日志</span><br><span class="line">tail -f /ora/logs/orabbix.<span class="built_in">log</span>     <span class="comment">//实时</span></span><br></pre></td></tr></table></figure></p><p>登录zabbix 网页 导入模板</p><p><li>如果直接导入肯定会报错  首先要把Templates 这个群组名改掉,随意改</li><br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">orabbix的模板位置：/ora/<span class="keyword">template</span>/Orabbix_export_full.xml</span><br></pre></td></tr></table></figure></p><p>接着：点击 配置—模板—-导入—选择—Orabbix_export_full.xml–导入<br>然后在oracle 主机<br><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">点击配置</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="comment">主机</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="comment">创建主机</span><span class="literal">-</span><span class="literal">-</span><span class="comment">名称都写</span>  <span class="comment">（oracledb）</span></span><br><span class="line"><span class="comment"></span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="comment">IP地址：10</span><span class="string">.</span><span class="comment">10</span><span class="string">.</span><span class="comment">1</span><span class="string">.</span><span class="comment">100</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="comment">点击添加</span> <span class="comment">OK</span></span><br><span class="line"><span class="comment">再把oracle</span> <span class="comment">主机添加orabbix模板链接，然后等时间刷新就OK</span></span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> ZABBIX  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Monitor </tag>
            
            <tag> Oracle_Orabbix </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Oracle_11g_install_Graphing</title>
      <link href="/2018/09/20/Oracle-11g-install-Graphing/"/>
      <url>/2018/09/20/Oracle-11g-install-Graphing/</url>
      
        <content type="html"><![CDATA[<p>Red Hat  7.2  静默安装oracle 11g<br><a id="more"></a><br>下载需要工具：<a href="https://soliton.net.cn/download/windwos/Xmanager5.zip" target="_blank" rel="noopener">Xmanager5</a><br>xmanager5序列号：101210-450789-147200</p><p>系统环境<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OS    :Red Hat Enterprise Linux<span class="built_in"> Server </span>release 7.2 (Maipo)</span><br><span class="line">Kernel:3.10.0-327.el7.x86_64</span><br></pre></td></tr></table></figure></p><p>Oracle 安装包<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">linux<span class="selector-class">.x64_11gR2_database_1of2</span><span class="selector-class">.zip</span></span><br><span class="line">linux<span class="selector-class">.x64_11gR2_database_2of2</span><span class="selector-class">.zip</span></span><br></pre></td></tr></table></figure></p><p>硬件需求<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">物理内存：至少<span class="number">1</span>G</span><br><span class="line">虚拟内存：物理内存的<span class="number">2</span>倍&lt;swap&gt;</span><br><span class="line">硬盘空间：全部安装需要<span class="number">5.1</span>G</span><br><span class="line">显示器是配色：<span class="number">256</span>色</span><br><span class="line">处理器：主频最少<span class="number">550</span>MHZ</span><br></pre></td></tr></table></figure></p><p>修改主机名<br><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">hostname </span> <span class="string">oracledb </span>   （临时修改主机名，重启无效）</span><br><span class="line"><span class="string">hostnamectl </span><span class="built_in">set-hostname</span> <span class="string">oracledb</span>（永久修改）</span><br></pre></td></tr></table></figure></p><p>添加主机名和IP对应<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/hosts</span><br><span class="line"></span><br><span class="line"><span class="number">172.16</span><span class="number">.1</span><span class="number">.230</span>   oracledb</span><br></pre></td></tr></table></figure></p><p>安装Oracle前环境</p><p><li>创建用户和组</li><br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">groupadd -g <span class="number">200</span> oinstall</span><br><span class="line">groupadd -g <span class="number">201</span> dba</span><br><span class="line">useradd -u <span class="number">440</span> -g oinstall -G dba oracle</span><br><span class="line">echo <span class="number">123456</span> | passwd --stdin oracle</span><br></pre></td></tr></table></figure></p><p>修改内核参数<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vi/etc/sysctl<span class="selector-class">.conf</span>    #末尾添加如下</span><br><span class="line"></span><br><span class="line">net<span class="selector-class">.ipv4</span><span class="selector-class">.ip_local_port_range</span>= <span class="number">9000</span> <span class="number">65500</span></span><br><span class="line">fs<span class="selector-class">.file-max</span> = <span class="number">6815744</span></span><br><span class="line">kernel<span class="selector-class">.shmall</span> = <span class="number">10523004</span></span><br><span class="line">kernel<span class="selector-class">.shmmax</span> = <span class="number">6465333657</span></span><br><span class="line">kernel<span class="selector-class">.shmmni</span> = <span class="number">4096</span></span><br><span class="line">kernel<span class="selector-class">.sem</span> = <span class="number">250</span> <span class="number">32000</span> <span class="number">100128</span></span><br><span class="line">net<span class="selector-class">.core</span><span class="selector-class">.rmem_default</span>=<span class="number">262144</span></span><br><span class="line">net<span class="selector-class">.core</span><span class="selector-class">.wmem_default</span>=<span class="number">262144</span></span><br><span class="line">net<span class="selector-class">.core</span><span class="selector-class">.rmem_max</span>=<span class="number">4194304</span></span><br><span class="line">net<span class="selector-class">.core</span><span class="selector-class">.wmem_max</span>=<span class="number">1048576</span></span><br><span class="line">fs<span class="selector-class">.aio-max-nr</span> = <span class="number">1048576</span></span><br><span class="line"></span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure></p><p>修改系统资源限制<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/security/limits.conf</span><br><span class="line"></span><br><span class="line">oracle  soft  nproc  <span class="number">2047</span></span><br><span class="line">oracle  hard  nproc  <span class="number">16384</span></span><br><span class="line">oracle  soft  nofile  <span class="number">1024</span></span><br><span class="line">oracle  hard  nofile  <span class="number">65536</span></span><br></pre></td></tr></table></figure></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/pam.d/login</span><br><span class="line"></span><br><span class="line">Sessionrequiredpam_namespace<span class="selector-class">.so</span>  #下面添加一条pam_limits.so</span><br><span class="line">sessionrequiredpam_limits.so</span><br></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">vi/etc/profile</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ <span class="variable">$USER</span> =<span class="string">"oracle"</span> ]; then</span><br><span class="line">      <span class="keyword">if</span> [ <span class="variable">$SHELL</span> = <span class="string">"/bin/ksh"</span> ];then</span><br><span class="line">          ulimit -p 16384</span><br><span class="line">          ulimit -n 65536</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">          ulimit -u 16384 -n 65536</span><br><span class="line">      fi</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p>创建安装目录及设置权限<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p  <span class="meta-keyword">/opt/</span>oracle<span class="meta-keyword">/app/</span></span><br><span class="line">mkdir <span class="meta-keyword">/opt/</span>oracle<span class="meta-keyword">/oradata/</span></span><br><span class="line">chmod <span class="number">755</span> <span class="meta-keyword">/opt/</span>oracle/</span><br><span class="line">chmod <span class="number">775</span> <span class="meta-keyword">/opt/</span>oracle<span class="meta-keyword">/app/</span></span><br><span class="line">chown oracle.oinstall -R <span class="meta-keyword">/opt/</span>oracle/</span><br></pre></td></tr></table></figure></p><p>设置oracle 用户的环境变量<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">su - root</span><br><span class="line"></span><br><span class="line">vim .bash_profile （最后添加）</span><br><span class="line"></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">ORACLE_BASE</span>=/opt/oracle/app</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">ORACLE_HOME</span>=<span class="variable">$ORACLE_BASE</span>/product/11.2.0/dbhome_1</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="variable">$PATH</span>:$ORACLE_HOME/bin</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">ORACLE_SID</span>=orcl</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">ORACLE_PID</span>=orcl</span><br><span class="line"></span><br><span class="line">source .bash_profile （立即生效）</span><br></pre></td></tr></table></figure></p><h3>上传 oracle 11G_R2 两个zip文件</h3><p>解压两个文件<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">unzip /opt/linux<span class="selector-class">.x64_11gR2_database_1of2</span><span class="selector-class">.zip</span></span><br><span class="line">unzip /opt/linux<span class="selector-class">.x64_11gR2_database_2of2</span><span class="selector-class">.zip</span></span><br><span class="line">mv database  /opt/</span><br></pre></td></tr></table></figure></p><p>使所有用户都能访问图形桌面<br><figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@oracledb</span>~]<span class="meta">#xhost +</span></span><br></pre></td></tr></table></figure></p><p>切换到oracle用户安装<br><figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@oracledb~]<span class="comment">#su - oracle</span></span><br><span class="line">[oracle@oracledb~]$ cd <span class="regexp">/opt/database/</span></span><br></pre></td></tr></table></figure></p><p>如果安装界面出现乱码则执行(没有乱码这一步跳过)<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="builtin-name">export</span> <span class="attribute">LANG</span>=en_US</span><br></pre></td></tr></table></figure></p><p>不用输入Email地址，直接next<br><img src="https://soliton.net.cn/soliton.images/oracle1.png"><br>选择安装数据库软件并创建数据，也可以选择第二项仅安装数据库软件，然后next<br><img src="https://soliton.net.cn/soliton.images/oracle2.png"><br>选择服务器版本，如图，点击next<br><img src="https://soliton.net.cn/soliton.images/oracle3.png"><br>单例数据库安装，如图，点击Next<br><img src="https://soliton.net.cn/soliton.images/oracle4.png"><br>高级模式安装，如图，点击next<br><img src="https://soliton.net.cn/soliton.images/oracle5.png"><br>添加支持的语言，如图，点击next<br><img src="https://soliton.net.cn/soliton.images/oracle6.png"><br>选择要安装企业版，如图，点击next<br><img src="https://soliton.net.cn/soliton.images/oracle7png.png"><br>安装数据库目录，如图，点击next<br><img src="https://soliton.net.cn/soliton.images/oracle8.png"><br>创建详细目录，如图，点击next<br><img src="https://soliton.net.cn/soliton.images/oracle9.png"><br>选择配置类型<br><img src="https://soliton.net.cn/soliton.images/oracle10.png"><br>数据库与服务名<br><img src="https://soliton.net.cn/soliton.images/oracle11.png"><br>开启自动内存管理（如果512m太大，会出现提示，减少一些就可以），然后先不要点击next，而是点击Memory旁边的Charactor sets选项<br><img src="https://soliton.net.cn/soliton.images/oracle12.png"><br>设置默认编码为UTF8<br><img src="https://soliton.net.cn/soliton.images/oracle13.png"><br>启用oracle企业管理控制台OEM<br><img src="https://soliton.net.cn/soliton.images/oracle14.png"><br>选择数据库文件目录<br><img src="https://soliton.net.cn/soliton.images/oracle15.png"><br>自动备份设置<br><img src="https://soliton.net.cn/soliton.images/oracle16.png"><br>设置数据库用户名和密码，他是有一个密码建议的，否则会提示错误，密码建议是包含大写和小写字母，总长度不能低于8位。(1qQ.1qQ.)<br><img src="https://soliton.net.cn/soliton.images/oracle17.png"><br>授权的组<br><img src="https://soliton.net.cn/soliton.images/oracle18.png"><br>检查oracle一些安装要求，包都已经安装，直接忽略(没有可以装一下)<br><img src="https://soliton.net.cn/soliton.images/oracle19.png"><br>开始安装<br><img src="https://soliton.net.cn/soliton.images/oracle20.png"><br>安装中<br><img src="https://soliton.net.cn/soliton.images/oracle21.png"><br>数据库安装信息，点击OK<br><img src="https://soliton.net.cn/soliton.images/oracle22.png"></p><p>点击OK之后，弹出一个窗口，不要点击新出来窗口的OK，用oracle 用户执行那两条命令<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/opt/</span>oracle<span class="regexp">/oraInventory/</span>orainstRoot.sh</span><br><span class="line"><span class="regexp">/opt/</span>oracle<span class="regexp">/app/</span>product<span class="regexp">/11/</span><span class="number">2</span><span class="regexp">/0/</span>dbhome_1<span class="regexp">/root.sh</span></span><br></pre></td></tr></table></figure></p><p><code>注</code>:如果在输入命令开启数据库的时候，提示bash:XXX command not found的时候很有可能是你没有在oracle用户下输入命令行，这时候用su oracle试一下，<br>如果还是不行可以到/opt/oracle/app/product/11.2.0/dbhome_1/bin目录下，确认一下此命令是否存在！！！<br>如果开启过程出现ERROR:ORA-12162:TNS:net service name is incorrectly specified这种语句的时候，很有可能是环境变量没有配置好<br>建议到oracle用户中的.bash_profile文件里查看一下，如何找到.bash_profile</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">su - oracle</span><br><span class="line">lsnrctl start</span><br><span class="line">sqlplus  /  as  sysdba</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">SQL&gt;</span><span class="bash"> startup</span></span><br><span class="line"><span class="meta">SQL&gt;</span><span class="bash"> shutdown immediate  关闭数据库实例</span></span><br><span class="line"><span class="meta">SQL&gt;</span><span class="bash">select * from tab;   <span class="comment">#查看所有表</span></span></span><br><span class="line"><span class="meta">SQL&gt;</span><span class="bash">select name from v<span class="variable">$datafile</span> <span class="comment">#查看数据库存放目录</span></span></span><br><span class="line"><span class="meta">SQL&gt;</span><span class="bash"> show parameter service   <span class="comment">#查看服务名</span></span></span><br><span class="line"><span class="meta">SQL&gt;</span><span class="bash"> select * from v<span class="variable">$instance</span>;<span class="comment">#查看实例名</span></span></span><br><span class="line"><span class="meta">SQL&gt;</span><span class="bash"> select name from v<span class="variable">$database</span>;<span class="comment">#查看数据库名</span></span></span><br><span class="line"><span class="meta">SQL&gt;</span><span class="bash"> select * fromdba_users;<span class="comment">#查看所有用户信息</span></span></span><br><span class="line"><span class="meta">SQL&gt;</span><span class="bash"> select username,password from dba_users; <span class="comment">#只查询用户和密码</span></span></span><br><span class="line"><span class="meta">SQL&gt;</span><span class="bash"> select * fromv<span class="variable">$pwfile_users</span>; <span class="comment">#查看具有sysdba权限的用户</span></span></span><br><span class="line"><span class="meta">SQL&gt;</span><span class="bash"> select * fromdba_ustats; <span class="comment">#查看当前用户信息</span></span></span><br><span class="line"><span class="meta">SQL&gt;</span><span class="bash"> select * fromuser_sys_privs <span class="comment">#查看当前用户系统权限</span></span></span><br><span class="line"><span class="meta">SQL&gt;</span><span class="bash"> select * fromuser_role_privs <span class="comment">#查看当前用户角色</span></span></span><br><span class="line"><span class="meta">SQL&gt;</span><span class="bash"> select * fromdba_sys_privs <span class="comment">#查看指定用户所具有的系统权限</span></span></span><br><span class="line"><span class="meta">SQL&gt;</span><span class="bash"> select * fromv<span class="variable">$version</span> <span class="comment">#查看oracle版本</span></span></span><br><span class="line"><span class="meta">SQL&gt;</span><span class="bash"> select * fromuser_views <span class="comment">#查看视图信息</span></span></span><br></pre></td></tr></table></figure><h3>RHEL7 图形化安装oracle结束</h3>]]></content>
      
      
      <categories>
          
          <category> Oracle </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
            <tag> Xmanager5下载 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>zabbix_monitor_huawei server</title>
      <link href="/2018/09/20/zabbix-monitor-huawei-server/"/>
      <url>/2018/09/20/zabbix-monitor-huawei-server/</url>
      
        <content type="html"><![CDATA[<p>zabbix监控华为服务器的硬件是通过iBMC，iBMC系统默认支持V3版本的SNMP服务，SNMP V1和SNMP V2C由于自身机制存在安全隐患，<br>默认是不开启的。如果使用SNMP V1和SNMP V2C需要配置团体名，而用V3只需知道用户名密码及加密算法即可。<br><a id="more"></a><br>系统环境<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OS    :Red Hat Enterprise Linux<span class="built_in"> Server </span>release 7.2 (Maipo)</span><br><span class="line">Kernel:3.10.0-327.el7.x86_64</span><br></pre></td></tr></table></figure></p><p>关闭防火墙和SELINUX<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Selinux：</span><br><span class="line">setenforce 0  宽松模式</span><br><span class="line">sed -i <span class="string">"s/enforcing/disabled/g"</span>  /etc/selinux<span class="built_in">/config </span>  永久关闭</span><br><span class="line">Firewalld：</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="builtin-name">disable</span> firewalld</span><br></pre></td></tr></table></figure></p><p>我们可以现在zabbix server上安装snmpwalk，然后进行如下测试：<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">snmpwalk -v <span class="number">3</span> -u root -a sha -A 'Huawei12#$' -x AES -X 'Huawei12#$'  -l authPriv  <span class="number">172.16</span><span class="number">.1</span><span class="number">.34</span> system</span><br><span class="line"></span><br><span class="line">上面一条执行不行的话执行下一条</span><br><span class="line"></span><br><span class="line">snmpwalk -v <span class="number">3</span> -c root <span class="number">172.16</span><span class="number">.1</span><span class="number">.34</span> system</span><br></pre></td></tr></table></figure></p><p>返回值：<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SNMPv2-<span class="keyword">SMI</span>::enterprises<span class="meta">.2011</span><span class="meta">.2</span><span class="meta">.235</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.1</span><span class="meta">.0</span> = INTEGER: <span class="number">1</span></span><br><span class="line">…………</span><br></pre></td></tr></table></figure></p><p>PS：snmpwalk会遍历OID下面的所有的值，所以会很多，我这里只是测试下可以连上服务器并能获取到值</p><p>在zabbix上添加要监控的主机，可以从网上下载相应的模板，进行添加。然后根据不同设备情况对item和trigger进行适度调整。</p><p>配置zabbix</p><p><ul>下载模板<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http<span class="variable">s:</span>//soliton.net.<span class="keyword">cn</span>/download/linux/huawei-<span class="keyword">pc</span>-server</span><br></pre></td></tr></table></figure></ul></p><p>导入模板</p><p><ul> 在 模板-导入，按顺序先导入valuemaps.xml、再导入templates.xml<br><img src="https://soliton.net.cn/soliton.images/zabbixhwmb1.png"><br>我们可以模板中的各监控项中根据实际情况修改SNMP OID、验证口令及私钥。<br>由于我们使用的是SNMP V3,因此我们保证验证口令及私钥正确即可；触发器及自动发现规则也是按此方式修改<br><img src="https://soliton.net.cn/soliton.images/zabbixhwmb2.png"><br>创建主机,在 模板 中，添加  Template_Huawei_PCServer  模板链接即可。<br><img src="https://soliton.net.cn/soliton.images/zabbixhwmb3.png"><br>监控最新数据<br><img src="https://soliton.net.cn/soliton.images/zabbixhwmb4.png"></ul></p><p></p><h3>监控华为服务器硬件状态结束<p></p></h3>]]></content>
      
      
      <categories>
          
          <category> ZABBIX </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Monitor </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>remotely_install_system</title>
      <link href="/2018/09/20/remotely-install-system/"/>
      <url>/2018/09/20/remotely-install-system/</url>
      
        <content type="html"><![CDATA[<p>HP远程安装操作系统<br><a id="more"></a><br>当初写的时候转换成PDF:<br><div class="row">    <embed src="https://soliton.net.cn/soliton.images/远程.pdf" width="100%" height="550" type="application/pdf"></div></p>]]></content>
      
      
      <categories>
          
          <category> HP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HP </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>zabbix_monitor_agentd</title>
      <link href="/2018/09/20/zabbix-monitor-agentd/"/>
      <url>/2018/09/20/zabbix-monitor-agentd/</url>
      
        <content type="html"><![CDATA[<p>利用Zabbix 监控服务监控zabbix_agentd客户端</p><a id="more"></a><p>系统环境<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OS    :Red Hat Enterprise Linux<span class="built_in"> Server </span>release 7.2 (Maipo)</span><br><span class="line">Kernel:3.10.0-327.el7.x86_64</span><br></pre></td></tr></table></figure></p><p>关闭防火墙和SELINUX<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Selinux：</span><br><span class="line">setenforce 0  宽松模式</span><br><span class="line">sed -i <span class="string">"s/enforcing/disabled/g"</span>  /etc/selinux<span class="built_in">/config </span>  永久关闭</span><br><span class="line">Firewalld：</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="builtin-name">disable</span> firewalld</span><br></pre></td></tr></table></figure></p><p>之前写过编译安装，编译安装也加了 –with-agentd参数在这里就不重新编译了<br><a href="https://www.soliton.wang/2018/09/20/Service-ZABBIX-3-4-8-install/#more">查看zabbix服务编译</a><br>复制zabbix_agentd 启动文件到/etc/init.d/<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp misc<span class="regexp">/init.d/</span>fedora<span class="regexp">/core/</span>zabbix_agentd  <span class="regexp">/etc/i</span>nit.d<span class="regexp">/</span></span><br></pre></td></tr></table></figure></p><p>赋予权限并修改zabbix编译安装路径<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chmod +x <span class="meta-keyword">/etc/</span>init.d/zabbix_agentd</span><br><span class="line">vim <span class="meta-keyword">/etc/</span>init.d/zabbix_agentd</span><br><span class="line"></span><br><span class="line">BASEDIR=<span class="meta-keyword">/usr/</span>local/zabbix       <span class="comment">//22行</span></span><br></pre></td></tr></table></figure></p><p>修改zabbix_agentd.conf 配置文件<br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/zabbix/etc/zabbix_agentd.conf</span><br><span class="line"></span><br><span class="line">Server=127.0.0.1             // 如果不是本机就写zabbix_server 的IP</span><br><span class="line">ServerActive=127.0.0.1:10051</span><br><span class="line">Hostname=Zabbix server</span><br></pre></td></tr></table></figure></p><p>将zabbix_agentd添加系统管理服务并启动服务<br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chkconfig --<span class="keyword">add</span><span class="bash"> zabbix_agentd</span></span><br><span class="line"><span class="bash">systemctl start zabbix_agentd</span></span><br></pre></td></tr></table></figure></p><p>查看zabbix_agentd端口和服务状态<br><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">netstat</span> <span class="selector-tag">-antpu</span> | <span class="selector-tag">grep</span> <span class="selector-tag">zabbix_agentd</span></span><br><span class="line"><span class="selector-tag">tcp</span>        <span class="selector-tag">0</span>      <span class="selector-tag">0</span> <span class="selector-tag">0</span><span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-pseudo">:10050</span>           <span class="selector-tag">0</span><span class="selector-class">.0</span><span class="selector-class">.0</span><span class="selector-class">.0</span>:*               <span class="selector-tag">LISTEN</span>      <span class="selector-tag">7833</span>/<span class="selector-tag">zabbix_agentd</span></span><br><span class="line"></span><br><span class="line"><span class="selector-tag">systemctl</span> <span class="selector-tag">status</span>  <span class="selector-tag">zabbix_agentd</span></span><br><span class="line">状态  ：  <span class="selector-tag">active</span>(running)  启动成功</span><br><span class="line"></span><br><span class="line">状态有共有三种：</span><br><span class="line"><span class="selector-tag">1</span>.  <span class="selector-tag">active</span>(running)   运行正常</span><br><span class="line"><span class="selector-tag">2</span>.  <span class="selector-tag">active</span>(exited)    运行退出</span><br><span class="line"><span class="selector-tag">3</span>.  <span class="selector-tag">inactive</span> (dead)   停止服务</span><br></pre></td></tr></table></figure></p><p>登录zabbix网页管理平台</p><p><ul>点击  配置—-主机—-将zabbix server前面的方框 √ —-点击启用按钮<br><img src="https://soliton.net.cn/soliton.images/zabbixpt1.png"></ul></p><p>选择监控模板</p><p><ul>    Template App HTTP Service</ul></p><p><ul>    Template App SSH Service</ul></p><p><ul>    Template App Zabbix Server<br><img src="https://soliton.net.cn/soliton.images/zabbixpt2.png"><br><img src="https://soliton.net.cn/soliton.images/zabbixpt3.png"><br>找到上面的三个模板 √ —–翻到最下面点击选择<br><img src="https://soliton.net.cn/soliton.images/zabbixpt4.png"><br>点击  替换—更新<br><img src="https://soliton.net.cn/soliton.images/zabbixpt5.png"><br>查看监控的最新数据<br><img src="https://soliton.net.cn/soliton.images/zabbixpt6.png"><br>选择监控群组—点击选择<br><img src="https://soliton.net.cn/soliton.images/zabbixpt7.png"><br>点击应用即可查看最新数据<br><img src="https://soliton.net.cn/soliton.images/zabbixpt8.png"></ul></p><p></p><h3>zabbix服务监控客户端结束<p></p></h3>]]></content>
      
      
      <categories>
          
          <category> ZABBIX </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Monitor </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Service_ZABBIX_3.4.8_install</title>
      <link href="/2018/09/20/Service-ZABBIX-3-4-8-install/"/>
      <url>/2018/09/20/Service-ZABBIX-3-4-8-install/</url>
      
        <content type="html"><![CDATA[<p>利用ZABBIX监控服务监控系统服务的状态，硬件状态等多种监控方式…………</p><a id="more"></a><p>系统环境<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OS    :Red Hat Enterprise Linux<span class="built_in"> Server </span>release 7.2 (Maipo)</span><br><span class="line">Kernel:3.10.0-327.el7.x86_64</span><br></pre></td></tr></table></figure></p><p>关闭防火墙和SELINUX<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Selinux：</span><br><span class="line">setenforce 0  宽松模式</span><br><span class="line">sed -i <span class="string">"s/enforcing/disabled/g"</span>  /etc/selinux<span class="built_in">/config </span>  永久关闭</span><br><span class="line">Firewalld：</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="builtin-name">disable</span> firewalld</span><br></pre></td></tr></table></figure></p><p>软件环境</p><p><li>nginx/1.12.2：<a href="https://www.soliton.wang/2018/09/03/Service-Nginx-1-12-2-install/#more">nginx 1.12.2编译安装</a></li></p><p><li>Mysql/5.7.20：<a href="https://www.soliton.wang/2018/09/19/mysql-5-7-20-install/#more">Mysql 5.7.20编译</a></li></p><p><li>PHP/5.6.32：<a href="https://www.soliton.wang/2018/09/18/PHP-7-2-1-install/#more">PHP 7.2.1编译安装</a></li><li><br>下载zabbix压缩包<br><a href="https://soliton.net.cn/download/linux/zabbix-3.4.8.tar.gz" target="_blank" rel="noopener">zabbix-3.4.8.tar.gz</a><br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https:<span class="regexp">//</span>soliton.net.cn<span class="regexp">/download/</span>linux<span class="regexp">/zabbix-3.4.8.tar.gz</span></span><br></pre></td></tr></table></figure></li></p><p>解压缩<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">tar</span> <span class="selector-tag">-zxvf</span> <span class="selector-tag">zabbix-3</span><span class="selector-class">.4</span><span class="selector-class">.8</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br><span class="line"><span class="selector-tag">cd</span> <span class="selector-tag">zabbix-3</span><span class="selector-class">.4</span><span class="selector-class">.8</span></span><br></pre></td></tr></table></figure></p><p>安装zabbix参数依赖<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">yum -y install net-snmp net-snmp-devel</span><br><span class="line">下载libevent-<span class="number">2.0</span>.<span class="number">10</span>-stable<span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br><span class="line">wget http:<span class="comment">//www.monkey.org/~provos/libevent-2.0.10-stable.tar.gz</span></span><br><span class="line">tar zxvf libevent-<span class="number">2.0</span>.<span class="number">10</span>-stable<span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br><span class="line">cd libevent-<span class="number">2.0</span>.<span class="number">10</span>-stable</span><br><span class="line">./configure -prefix=/usr &amp;&amp; make -j <span class="number">4</span> &amp;&amp; make install</span><br></pre></td></tr></table></figure></p><p>编译zabbix,编译安装<br><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> <span class="string">..</span></span><br><span class="line"><span class="string">./configure</span> <span class="params">--prefix=/usr/local/zabbix/</span> <span class="params">--enable-server</span> <span class="params">--enable-agent</span> <span class="params">--with-mysql</span> <span class="params">--with-net-snmp</span> <span class="params">--with-libcurl</span> <span class="params">--with-libxml2</span></span><br><span class="line">make install</span><br></pre></td></tr></table></figure></p><p>创建zabbix用户和组<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">groupadd zabbix</span><br><span class="line">useradd zabbix -s <span class="regexp">/sbin/</span>nologin -M -g zabbix</span><br></pre></td></tr></table></figure></p><p>登录mysql 创建和库以及zabbix用户授权,测试zabbix用户是否可以登录<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> zabbixdb;</span><br><span class="line"><span class="keyword">grant</span> all <span class="keyword">privileges</span> <span class="keyword">on</span> zabbixdb.* <span class="keyword">to</span> zabbix@<span class="string">"%"</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">"123456"</span>;</span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br><span class="line"></span><br><span class="line">mysql -uroot -hlocalhost -p123456</span><br></pre></td></tr></table></figure></p><p>将zabbix的苦导入到zabbixdb 库里<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">pwd</span></span><br><span class="line">/data/zabbix-3.4.8</span><br><span class="line"><span class="built_in">cd</span> database/mysql/</span><br><span class="line">mysql -uzabbix -hlocahost -p123456</span><br><span class="line">use zabbixdb;</span><br><span class="line"><span class="built_in">source</span> schema.sql</span><br><span class="line"><span class="built_in">source</span>  images.sql</span><br><span class="line"><span class="built_in">source</span>  data.sql</span><br></pre></td></tr></table></figure></p><p>创建web项目目录,和zabbix web配置文件:<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mkdir</span> /zabbix</span><br><span class="line">vim /usr/local/nginx/conf/vhost/zabbix.conf</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line"><span class="attribute">listen</span> <span class="number">168</span>;</span><br><span class="line"><span class="attribute">server_name</span> localhost <span class="number">10.10.1.100</span>;</span><br><span class="line"><span class="attribute">index</span> index.html index.php index.html;</span><br><span class="line"><span class="attribute">root</span> /zabbix;</span><br><span class="line"><span class="attribute">location</span> /&#123;</span><br><span class="line">       <span class="attribute">try_files</span> <span class="variable">$uri</span> <span class="variable">$uri</span>/ /index.php?<span class="variable">$args</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="attribute">location</span> <span class="regexp">~ ^(.+.php)(.*)$</span> &#123;</span><br><span class="line"></span><br><span class="line">       <span class="attribute">fastcgi_split_path_info</span><span class="regexp"> ^(.+.php)(.*)$</span>;</span><br><span class="line">       <span class="attribute">include</span> fastcgi.conf;</span><br><span class="line">       <span class="attribute">fastcgi_pass</span> <span class="number">127.0.0.1:9000</span>;</span><br><span class="line">       <span class="attribute">fastcgi_index</span> index.php;</span><br><span class="line">       <span class="attribute">fastcgi_param</span> PATH_INFO <span class="variable">$fastcgi_path_info</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><a href="https://soliton.net.cn/2018/09/01/nginx-conf/" target="_blank" rel="noopener">查看nginx.conf</a></p><p>编辑zabbix_server.conf文件<br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/zabbix/etc/zabbix_server.conf</span><br><span class="line"></span><br><span class="line">LogFile=/tmp/zabbix_server.log</span><br><span class="line">PidFile=/tmp/zabbix_server.pid</span><br><span class="line">DBHost=localhost</span><br><span class="line">DBName=zabbixdb</span><br><span class="line">DBUser=zabbix</span><br><span class="line">DBPassword=123456</span><br></pre></td></tr></table></figure></p><p>复制启动配置文件到  /etc/init.d/<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp misc<span class="regexp">/init.d/</span>fedora<span class="regexp">/core/</span>zabbix_server <span class="regexp">/etc/i</span>nit.d<span class="regexp">/</span></span><br></pre></td></tr></table></figure></p><p>赋予启动文件权限并修改启动文件<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chmod +x <span class="meta-keyword">/etc/</span>init.d/zabbix_server</span><br><span class="line">vim <span class="meta-keyword">/etc/</span>init.d/zabbix_server</span><br><span class="line"></span><br><span class="line">BASEDIR=<span class="meta-keyword">/usr/</span>local/zabbix       <span class="comment">//22行</span></span><br></pre></td></tr></table></figure></p><p>启动服务  nginx 、 php-fpm 、mysql 、zabbix<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">start</span> nginx</span><br><span class="line">systemctl <span class="built_in">start</span> php-fpm</span><br><span class="line">systemctl <span class="built_in">start</span> mysqld</span><br><span class="line"></span><br><span class="line">将zabbix_server添加到系统管理访问并启动</span><br><span class="line"></span><br><span class="line">chkconfig <span class="comment">--add zabbix_server</span></span><br><span class="line">systemctl <span class="built_in">start</span> zabbix_server</span><br></pre></td></tr></table></figure></p><p>启动报错<br><img src="https://soliton.net.cn/soliton.images/zabbixbc.png"><br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">解决办法：</span><br><span class="line"> ln -s /usr/local/mysql/<span class="class"><span class="keyword">lib</span>/<span class="title">libmysqlclient</span>.<span class="title">so</span>.18 /<span class="title">usr</span>/<span class="title">lib64</span>/</span></span><br><span class="line"></span><br><span class="line">重启zabbix_server服务</span><br><span class="line">systemctl restart zabbix_server</span><br></pre></td></tr></table></figure></p><p>重启报错<br><img src="https://soliton.net.cn/soliton.images/zabbixbc1.png"><br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/<span class="class"><span class="keyword">lib</span>/<span class="title">libevent</span>-2.0.<span class="title">so</span>.5  /<span class="title">usr</span>/<span class="title">lib64</span>/</span></span><br></pre></td></tr></table></figure></p><p>重启服务正常</p><p>查看服务端口<br><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">netstat -antpu <span class="string">| grep nginx</span></span><br><span class="line">netstat -antpu <span class="string">| grep php-fpm</span></span><br><span class="line">netstat -antpu <span class="string">| grep mysqld</span></span><br><span class="line">netstat -antpu <span class="string">| grep zabbix_server</span></span><br></pre></td></tr></table></figure></p><p>网页配置</p><p><li>访问网页— 10.10.1.100:168 — Next<br><img src="https://soliton.net.cn/soliton.images/zabbixwy1.png"></li></p><p><li>PHP选项报错,根据报错修改php.ini配置文件<br><img src="https://soliton.net.cn/soliton.images/zabbixwy2.png"><br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/php/etc/php.ini</span><br><span class="line"></span><br><span class="line">post_max_size = 16M</span><br><span class="line">max_execution_time = 300</span><br><span class="line">max_input_time = 300</span><br><span class="line">date.timezone = Asia/ShangHai</span><br><span class="line">always_popliate_raw_post_data = -1</span><br></pre></td></tr></table></figure></li></p><p>重启php-fpm服务<br><img src="https://soliton.net.cn/soliton.images/zabbixwy3.png"><br>配置数据库连接</p><p><li>注：如果连接不上把localhost 改成127.0.0.1<br><img src="https://soliton.net.cn/soliton.images/zabbixwy4.png"><br>填写zabbix server details<br><img src="https://soliton.net.cn/soliton.images/zabbixwy5.png"><br>确认填写信息<br><img src="https://soliton.net.cn/soliton.images/zabbixwy6.png"><br>安装<br><img src="https://soliton.net.cn/soliton.images/zabbixwy7.png"><br>报错不能创建文件，有两钟解决办法</li></p><p>解决办法一：<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chmod <span class="number">777</span> <span class="regexp">/zabbix/</span>conf</span><br><span class="line"></span><br><span class="line">刷新网页即可</span><br></pre></td></tr></table></figure></p><p>解决办法二：<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Download the configuration  file   点击下载</span><br><span class="line"></span><br><span class="line">find 查找  zabbix<span class="selector-class">.conf</span><span class="selector-class">.php</span>  然后移动到 zabbix web目录下   例如在root目录下</span><br><span class="line">mv /root/zabbix<span class="selector-class">.conf</span><span class="selector-class">.php</span>   /zabbix/conf/</span><br></pre></td></tr></table></figure></p><p>点击Finish 登录进入zabbix 管理控制台<br><img src="https://soliton.net.cn/soliton.images/zabbixwy8.png"><br>默认Username：admin ，Password：zabbix<br><img src="https://soliton.net.cn/soliton.images/zabbixwy9.png"><br>修改网页编码为中文<br><img src="https://soliton.net.cn/soliton.images/zabbixwy10.png"><br>选择Language—-Chinese(zh_CN)—点击Update更新<br><img src="https://soliton.net.cn/soliton.images/zabbixwy11.png"></p>]]></content>
      
      
      <categories>
          
          <category> ZABBIX </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Monitor </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Mysql-5.7.20_install</title>
      <link href="/2018/09/19/Service_Mysql-5-7-20_install/"/>
      <url>/2018/09/19/Service_Mysql-5-7-20_install/</url>
      
        <content type="html"><![CDATA[<p>Mysql 5.7.20编译安装教程<br><a id="more"></a><br>系统环境<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OS    :Red Hat Enterprise Linux<span class="built_in"> Server </span>release 7.2 (Maipo)</span><br><span class="line">Kernel:3.10.0-327.el7.x86_64</span><br></pre></td></tr></table></figure></p><p>关闭防火墙和SELINUX<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Selinux：</span><br><span class="line">setenforce 0  宽松模式</span><br><span class="line">sed -i <span class="string">"s/enforcing/disabled/g"</span>  /etc/selinux<span class="built_in">/config </span>  #永久关闭</span><br><span class="line"></span><br><span class="line">Firewalld：</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="builtin-name">disable</span> firewalld</span><br></pre></td></tr></table></figure></p><h3>下载安装包：</h3><br><li>下载1：<a href="https://soliton.net.cn/download/linux/mysql-5.7.20.tar.gz" target="_blank" rel="noopener">Mysql-5.7.20.tar.gz</a><br></li><li>下载2：<a href="https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.20.tar.gz" target="_blank" rel="noopener">Mysql-5.7.20.tar.gz</a><br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">下载<span class="number">1</span>：wget http<span class="variable">s:</span>//soliton.net.<span class="keyword">cn</span>/download/linux/mysql-<span class="number">5.7</span>.<span class="number">20</span>.tar.gz</span><br><span class="line">下载<span class="number">2</span>：wget http<span class="variable">s:</span>//dev.mysql.<span class="keyword">com</span>/<span class="built_in">get</span>/Downloads/MySQL-<span class="number">5.7</span>/mysql-<span class="number">5.7</span>.<span class="number">20</span>.tar.gz</span><br></pre></td></tr></table></figure><br><br>这个版本的MySQL最低要求boost的版本是1.59<br></li><li>下载1：<a href="https://nchc.dl.sourceforge.net/project/boost/boost/1.59.0/boost_1_59_0.tar.gz" target="_blank" rel="noopener">Boost-1.59</a><br></li><li>下载2：<a href="https://soliton.net.cn/download/linux/boost_1_59_0.tar.gz" target="_blank" rel="noopener">Boost-1.59</a><br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">下载<span class="number">1</span>：wget <span class="symbol">https:</span>/<span class="regexp">/nchc.dl.sourceforge.net/project</span><span class="regexp">/boost/boost</span><span class="regexp">/1.59.0/boost</span>_1_59_0.tar.gz</span><br><span class="line">下载<span class="number">2</span>：wget <span class="symbol">https:</span>/<span class="regexp">/soliton.net.cn/download</span><span class="regexp">/linux/boost</span>_1_59_0.tar.gz</span><br></pre></td></tr></table></figure><br><br>安装Mysql编译安装必要依赖<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install </span>-y cmake <span class="keyword">bison </span><span class="keyword">bison-devel </span>libaio-devel gcc gcc-c++ git ncurses-devel</span><br></pre></td></tr></table></figure><br><br>解压Mysql源文件<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf mysql-<span class="number">5.7</span>.<span class="number">20</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br><span class="line"></span><br><span class="line">将boost的压缩包移动至解压后的源文件目录内:</span><br><span class="line">mv boost_1_59_0<span class="selector-class">.tar</span><span class="selector-class">.gz</span> mysql-<span class="number">5.7</span>.<span class="number">20</span>/</span><br></pre></td></tr></table></figure><br><br>进入MySQL源文件目录，新建configure做为编译目录，并进入该目录:<br><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> mysql-<span class="number">5</span>.<span class="number">7</span>.<span class="number">20</span></span><br><span class="line"><span class="built_in">mkdir</span> configure</span><br><span class="line"><span class="built_in">cd</span> configure</span><br></pre></td></tr></table></figure><br><br>使用cmake进行生成编译环境：<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">cmake .. -DBUILD_CONFIG=mysql_release \</span><br><span class="line">-<span class="ruby">DINSTALL_LAYOUT=STANDALONE \</span></span><br><span class="line"><span class="ruby">-DCMAKE_BUILD_TYPE=RelWithDebInfo \</span></span><br><span class="line"><span class="ruby">-DENABLE_DTRACE=OFF \</span></span><br><span class="line"><span class="ruby">-DWITH_EMBEDDED_SERVER=OFF \</span></span><br><span class="line"><span class="ruby">-DWITH_INNODB_MEMCACHED=ON \</span></span><br><span class="line"><span class="ruby">-DWITH_SSL=bundled \</span></span><br><span class="line"><span class="ruby">-DWITH_ZLIB=system \</span></span><br><span class="line"><span class="ruby">-DWITH_PAM=ON \</span></span><br><span class="line"><span class="ruby">-DCMAKE_INSTALL_PREFIX=<span class="regexp">/usr/local</span><span class="regexp">/mysql \</span></span></span><br><span class="line"><span class="ruby">-DMYSQL_DATADIR=<span class="regexp">/usr/local</span><span class="regexp">/mysql/data</span> \</span></span><br><span class="line"><span class="ruby">-DMYSQL_UNIX_ADDR=<span class="regexp">/usr/local</span><span class="regexp">/mysql/tmp</span><span class="regexp">/mysql.sock \</span></span></span><br><span class="line"><span class="ruby">-DDEFAULT_CHARSET=utf8 \</span></span><br><span class="line"><span class="ruby">-DDEFAULT_COLLATION=utf8_general_ci \</span></span><br><span class="line"><span class="ruby">-DWITH_EDITLINE=bundled \</span></span><br><span class="line"><span class="ruby">-DFEATURE_SET=community \</span></span><br><span class="line"><span class="ruby">-DCOMPILATION_COMMENT=<span class="string">"MySQL Server (GPL)"</span> \</span></span><br><span class="line"><span class="ruby">-DWITH_DEBUG=OFF \</span></span><br><span class="line"><span class="ruby">-DWITH_BOOST=..</span></span><br></pre></td></tr></table></figure><br><br>如果编译出现错误，请先删除CMakeCache.txt后，再重新编译：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">rm</span> <span class="selector-tag">-rf</span> <span class="selector-tag">CMakeCache</span><span class="selector-class">.txt</span></span><br></pre></td></tr></table></figure><br><br>如果出现下面的提示就表示成功生成了编译环境：<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">- Configuring done</span></span><br><span class="line"><span class="ruby">-- Generating done</span></span><br></pre></td></tr></table></figure><br><br>编译安装Mysql：<br><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">make</span> &amp;&amp; <span class="built_in">make</span> install</span><br></pre></td></tr></table></figure><br><br>创建mysql用户<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">useradd -s <span class="regexp">/sbin/</span>nologin mysql</span><br></pre></td></tr></table></figure><br><br>新建数据库文件夹及日志文件夹，并更改用户为mysql:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkdir <span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span>data</span><br><span class="line">mkdir <span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span>tmp</span><br><span class="line">mkdir -p <span class="regexp">/var/</span>mysql/log</span><br><span class="line">chown -R <span class="string">mysql:</span>mysql <span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span>data</span><br><span class="line">chown -R <span class="string">mysql:</span>mysql <span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span>tmp</span><br><span class="line">chown -R <span class="string">mysql:</span>mysql <span class="regexp">/var/</span>mysql/log</span><br></pre></td></tr></table></figure><br><br>修改配置文件:<br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/my.cnf</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">port=3306</span><br><span class="line">datadir=/usr/local/mysql/data</span><br><span class="line">socket=/usr/local/mysql/tmp/mysql.sock</span><br><span class="line">log_error=/var/mysql/log/error.log</span><br><span class="line">basedir=/usr/local/mysql</span><br></pre></td></tr></table></figure><br><br>初始化数据库:<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span>bin<span class="regexp">/mysqld --initialize --basedir=/u</span>sr<span class="regexp">/local/my</span>sql<span class="regexp">/ --datadir=/u</span>sr<span class="regexp">/local/my</span>sql<span class="regexp">/data --user=mysql</span></span><br></pre></td></tr></table></figure><br><br>查看数据文件是否生成:<br><figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ll /usr/local/mysql/data/</span><br><span class="line"></span><br><span class="line">总用量 110628</span><br><span class="line">-rw-r-----.<span class="number"> 1 </span>mysql mysql<span class="number"> 56 </span>8月<span class="number"> 14 </span>16:09 auto.cnf</span><br><span class="line">-rw-r-----.<span class="number"> 1 </span>mysql mysql<span class="number"> 419 </span>8月<span class="number"> 14 </span>16:09 ib_buffer_pool</span><br><span class="line">-rw-r-----.<span class="number"> 1 </span>mysql mysql<span class="number"> 12582912 </span>8月<span class="number"> 14 </span>16:09 ibdata1</span><br><span class="line">-rw-r-----.<span class="number"> 1 </span>mysql mysql<span class="number"> 50331648 </span>8月<span class="number"> 14 </span>16:09 ib_logfile0</span><br><span class="line">-rw-r-----.<span class="number"> 1 </span>mysql mysql<span class="number"> 50331648 </span>8月<span class="number"> 14 </span>16:09 ib_logfile1</span><br><span class="line">drwxr-x---.<span class="number"> 2 </span>mysql mysql<span class="number"> 4096 </span>8月<span class="number"> 14 </span>16:09 mysql</span><br><span class="line">drwxr-x---.<span class="number"> 2 </span>mysql mysql<span class="number"> 8192 </span>8月<span class="number"> 14 </span>16:09 performance_schema</span><br><span class="line">drwxr-x---.<span class="number"> 2 </span>mysql mysql<span class="number"> 8192 </span>8月<span class="number"> 14 </span>16:09 sys</span><br><span class="line"></span><br><span class="line">查看日志文件是否生成：</span><br><span class="line"></span><br><span class="line">ll /var/mysql/log/</span><br><span class="line"></span><br><span class="line">总用量 4</span><br><span class="line">-rw-r-----.<span class="number"> 1 </span>mysql mysql<span class="number"> 802 </span>8月<span class="number"> 14 </span>16:09 error.log</span><br></pre></td></tr></table></figure><br><br>配置启动文件及环境变更并启动:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">从模板文件中复制启动文件：</span><br><span class="line"></span><br><span class="line">cp <span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span>support-files<span class="regexp">/mysql.server /</span>etc<span class="regexp">/init.d/</span>mysqld</span><br><span class="line"></span><br><span class="line">修改启动文件：</span><br><span class="line">vim <span class="regexp">/etc/</span>init.d/mysqld</span><br><span class="line">找到如下二行：</span><br><span class="line"></span><br><span class="line">basedir=</span><br><span class="line">datadir=</span><br><span class="line">修改为：</span><br><span class="line">basedir=<span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span></span><br><span class="line">datadir=<span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span>data/</span><br></pre></td></tr></table></figure><br><br>给安装的mysql目录修改属主、属组<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown -R <span class="string">mysql:</span>mysql <span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span></span><br></pre></td></tr></table></figure><br><br>启动mysql:<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/etc/i</span>nit.d<span class="regexp">/mysqld start</span></span><br></pre></td></tr></table></figure><br><br>配置MySQL环境变量：<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="string">'PATH=/usr/local/mysql/bin/:$PATH'</span> &gt;&gt;/etc/<span class="keyword">profile</span></span><br><span class="line"><span class="keyword">source</span> /etc/<span class="keyword">profile</span></span><br></pre></td></tr></table></figure><br><br>修改root的初始密码:<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">查看root的初始密码</span><br><span class="line">MySQL从5.7开始不支持安装后使用空密码进行登录，因此在这里需要先查询程序生成的临时密码：</span><br><span class="line"><span class="keyword">cat</span> /<span class="keyword">var</span>/mysql/<span class="keyword">log</span>/<span class="keyword">error</span>.<span class="keyword">log</span> |grep 'A temporary password'</span><br><span class="line"></span><br><span class="line">2018-09-19T07:57:04.818931Z 1 [<span class="keyword">Note</span>] A temporary password is generated <span class="keyword">for</span> root@localhost: u3rh5T1=<span class="keyword">iR</span>+b</span><br><span class="line">初始密码：u3rh5T1=<span class="keyword">iR</span>+b</span><br></pre></td></tr></table></figure><br><br>登录MySQL并修改初始密码：<br>使用初始密码登录MySQL:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">user</span> <span class="string">'root'</span>@<span class="string">'localhost'</span> idall <span class="keyword">privileges</span> <span class="keyword">on</span> *.* <span class="keyword">to</span> root@<span class="string">"%"</span> <span class="keyword">identified</span> <span class="keyword">by</span> <span class="string">'123456'</span> <span class="keyword">with</span> <span class="keyword">grant</span> <span class="keyword">option</span>;     //赋予root所有权限</span><br><span class="line"></span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br></pre></td></tr></table></figure><br><br><code>如果登录进来不管执行什么都是报错那就执行以下命令</code><br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">PASSWORD</span> = <span class="keyword">PASSWORD</span>(<span class="string">'your new password'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">USER</span> <span class="string">'root'</span>@<span class="string">'localhost'</span> <span class="keyword">PASSWORD</span> <span class="keyword">EXPIRE</span> <span class="keyword">NEVER</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">flush</span> <span class="keyword">privileges</span>;</span><br><span class="line"></span><br><span class="line">完成以上三步退出再登，使用新设置的密码就行了，以上除了红色的自己修改成新密码外，其他原样输入即可</span><br></pre></td></tr></table></figure><br><br><h3>Mysql-5.7.20编译安装教程结束</h3></li>]]></content>
      
      
      <categories>
          
          <category> Mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Service_Mysql </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Oracle_11g_Silence_install</title>
      <link href="/2018/09/19/Oracle-11g-Silence-install/"/>
      <url>/2018/09/19/Oracle-11g-Silence-install/</url>
      
        <content type="html"><![CDATA[<p>Red Hat  7.2  静默安装oracle 11g<br><a id="more"></a><br>下载需要工具：<a href="https://soliton.net.cn/download/windwos/Xmanager5.zip" target="_blank" rel="noopener">Xmanager5</a><br>xmanager5序列号：101210-450789-147200</p><p>系统环境<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OS    :Red Hat Enterprise Linux<span class="built_in"> Server </span>release 7.2 (Maipo)</span><br><span class="line">Kernel:3.10.0-327.el7.x86_64</span><br></pre></td></tr></table></figure></p><p>Oracle 安装包<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">linux<span class="selector-class">.x64_11gR2_database_1of2</span><span class="selector-class">.zip</span></span><br><span class="line">linux<span class="selector-class">.x64_11gR2_database_2of2</span><span class="selector-class">.zip</span></span><br></pre></td></tr></table></figure></p><p>硬件需求<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">物理内存：至少<span class="number">1</span>G</span><br><span class="line">虚拟内存：物理内存的<span class="number">2</span>倍&lt;swap&gt;</span><br><span class="line">硬盘空间：全部安装需要<span class="number">5.1</span>G</span><br><span class="line">显示器是配色：<span class="number">256</span>色</span><br><span class="line">处理器：主频最少<span class="number">550</span>MHZ</span><br></pre></td></tr></table></figure></p><p>关闭防火墙和SELINUX<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Selinux：</span><br><span class="line">setenforce 0  宽松模式</span><br><span class="line">sed -i <span class="string">"s/enforcing/disabled/g"</span>  /etc/selinux<span class="built_in">/config </span>  永久关闭</span><br><span class="line">Firewalld：</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="builtin-name">disable</span> firewalld</span><br></pre></td></tr></table></figure></p><p>安装依赖包<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install binutils compat-libstdc++-<span class="number">33</span> compat-libstdc++-<span class="number">33</span><span class="selector-class">.i686</span> elfutils-libelf elfutils-libelf-devel gcc gcc-c++ glibc glibc<span class="selector-class">.i686</span> glibc-common glibc-devel glibc-devel<span class="selector-class">.i686</span> glibc-headers ksh libaio libaio<span class="selector-class">.i686</span> libaio-devel libaio-devel<span class="selector-class">.i686libgcc</span> libgcc<span class="selector-class">.i686</span> libstdc++ libstdc++<span class="selector-class">.i686</span> libstdc++-devel make sysstat unixODBC unixODBC-devel</span><br></pre></td></tr></table></figure></p><p>设定SWAP分区<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">在<span class="regexp">/home/</span>下生成swap文件 设定大小<span class="number">2</span>GB</span><br><span class="line"></span><br><span class="line">dd <span class="keyword">if</span>=<span class="regexp">/dev/</span>zero of=<span class="regexp">/home/</span>swapfile bs=<span class="number">1</span>M <span class="keyword">count</span>=<span class="number">2048</span></span><br><span class="line"></span><br><span class="line">设定使用<span class="regexp">/home/</span>swapfile交换文件</span><br><span class="line"></span><br><span class="line">mkswap <span class="regexp">/home/</span>swapfile</span><br><span class="line"></span><br><span class="line">启用交换分区</span><br><span class="line"></span><br><span class="line">swapon <span class="regexp">/home/</span>swapfile</span><br><span class="line"></span><br><span class="line">编辑文件<span class="regexp">/ect/</span>fstab</span><br><span class="line">vi <span class="regexp">/etc/</span>fstab</span><br><span class="line"></span><br><span class="line">以便引导系统时启用交换文件，文件最下方插入</span><br><span class="line"></span><br><span class="line"><span class="regexp">/home/</span>swapfile swap swap defaults <span class="number">0</span> <span class="number">0</span></span><br></pre></td></tr></table></figure></p><p>添加Oracle 用户<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">创建oinstall、dba组 将<span class="keyword">oracle用户加入组 </span>修改并设定<span class="keyword">oracle用户密码</span></span><br><span class="line"><span class="keyword"></span></span><br><span class="line"><span class="keyword">groupadd </span>oinstall</span><br><span class="line">groupadd dba</span><br><span class="line">useradd -g oinstall -G dba <span class="keyword">oracle</span></span><br><span class="line"><span class="keyword">echo </span><span class="number">123456</span> <span class="title">| passwd --stdin oracle</span></span><br></pre></td></tr></table></figure></p><p>修改内核参数<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">编辑文件/etc/sysctl<span class="selector-class">.conf</span>　　</span><br><span class="line"></span><br><span class="line">vi /etc/sysctl.conf</span><br><span class="line"></span><br><span class="line">配置文件内加入 修改以下参数。如果没有可以自己添加，如果默认值比参考值大，则不需要修改。</span><br><span class="line"></span><br><span class="line">fs<span class="selector-class">.aio-max-nr</span> = <span class="number">1048576</span></span><br><span class="line">fs<span class="selector-class">.file-max</span> = <span class="number">6815744</span></span><br><span class="line">kernel<span class="selector-class">.shmall</span> = <span class="number">2097152</span></span><br><span class="line">kernel<span class="selector-class">.shmmax</span> = <span class="number">536870912</span></span><br><span class="line">kernel<span class="selector-class">.shmmni</span> = <span class="number">4096</span></span><br><span class="line">kernel<span class="selector-class">.sem</span> = <span class="number">250</span> <span class="number">32000</span> <span class="number">100</span> <span class="number">128</span></span><br><span class="line">net<span class="selector-class">.ipv4</span><span class="selector-class">.ip_local_port_range</span> = <span class="number">9000</span> <span class="number">65500</span></span><br><span class="line">net<span class="selector-class">.core</span><span class="selector-class">.rmem_default</span> = <span class="number">262144</span></span><br><span class="line">net<span class="selector-class">.core</span><span class="selector-class">.rmem_max</span> = <span class="number">4194304</span></span><br><span class="line">net<span class="selector-class">.core</span><span class="selector-class">.wmem_default</span> = <span class="number">262144</span></span><br><span class="line">net<span class="selector-class">.core</span><span class="selector-class">.wmem_max</span> = <span class="number">1048586</span></span><br><span class="line"></span><br><span class="line">执行命令sysctl使其自检并生效</span><br><span class="line"></span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure></p><p>修改用户资源限制<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">修改/etc/security/limits.conf配置文件</span><br><span class="line">vi /etc/security/limits.conf</span><br><span class="line"></span><br><span class="line">配置文件下方加入</span><br><span class="line"></span><br><span class="line">oracle              soft    nproc  <span class="number">2047</span></span><br><span class="line">oracle              hard    nproc  <span class="number">16384</span></span><br><span class="line">oracle              soft    nofile  <span class="number">1024</span></span><br><span class="line">oracle              hard    nofile  <span class="number">65536</span></span><br><span class="line">oracle              soft    stack   <span class="number">10240</span></span><br><span class="line"></span><br><span class="line">修改/etc/pam.d/login配置文件</span><br><span class="line">vi /etc/pam.d/login</span><br><span class="line"></span><br><span class="line">配置文件内加入</span><br><span class="line"></span><br><span class="line">session required /<span class="class"><span class="keyword">lib</span>/<span class="title">security</span>/<span class="title">pam_limits</span>.<span class="title">so</span></span></span><br><span class="line">session required pam_limits.so</span><br></pre></td></tr></table></figure></p><p>创建安装目录<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">创建安装目录  <span class="regexp">/usr/</span>local<span class="regexp">/oracle     /</span>usr<span class="regexp">/local/</span>oraInventory     <span class="regexp">/usr/</span>local/oradata  并赋予组用户及权限</span><br><span class="line"></span><br><span class="line">mkdir -p <span class="regexp">/usr/</span>local<span class="regexp">/oracle /</span>usr<span class="regexp">/local/</span>oraInventory <span class="regexp">/usr/</span>local<span class="regexp">/oradata/</span></span><br><span class="line">chown -R <span class="string">oracle:</span>oinstall <span class="regexp">/usr/</span>local<span class="regexp">/oracle /</span>usr<span class="regexp">/local/</span>oraInventory <span class="regexp">/usr/</span>local<span class="regexp">/oradata/</span></span><br><span class="line">chmod -R <span class="number">775</span> <span class="regexp">/usr/</span>local<span class="regexp">/oracle /</span>usr<span class="regexp">/local/</span>oraInventory <span class="regexp">/usr/</span>local<span class="regexp">/oradata/</span></span><br></pre></td></tr></table></figure></p><p>创建oraInst.loc文件<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">创建<span class="regexp">/etc/</span>oraInst.loc文件</span><br><span class="line"></span><br><span class="line">vi <span class="regexp">/etc/</span>oraInst.loc</span><br><span class="line"></span><br><span class="line">文件内加入以下内容</span><br><span class="line"></span><br><span class="line">inventory_loc=<span class="regexp">/usr/</span>local/oraInventory</span><br><span class="line">inst_group=oinstall</span><br><span class="line"></span><br><span class="line">保存退出后执行以下命令。设定该文件的用户组及权限。</span><br><span class="line"></span><br><span class="line">chown <span class="string">oracle:</span>oinstall <span class="regexp">/etc/</span>oraInst.loc</span><br><span class="line">chmod <span class="number">664</span> <span class="regexp">/etc/</span>oraInst.loc</span><br></pre></td></tr></table></figure></p><p>上传oracle 11g的zip文件并解压<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ls /data</span><br><span class="line">输出：linux<span class="selector-class">.x64_11gR2_database_1of2</span><span class="selector-class">.zip</span>  linux<span class="selector-class">.x64_11gR2_database_2of2</span><span class="selector-class">.zip</span></span><br><span class="line">解压：</span><br><span class="line">cd /data</span><br><span class="line">yum -y install unzip</span><br><span class="line">unzip linux<span class="selector-class">.x64_11gR2_database_1of2</span><span class="selector-class">.zip</span></span><br><span class="line">unzip linux<span class="selector-class">.x64_11gR2_database_2of2</span><span class="selector-class">.zip</span></span><br><span class="line">待解压完毕后会生成文件夹/data/database 修改其用户组及权限此处直接使用<span class="number">777</span></span><br><span class="line">chmod <span class="number">777</span> /data/database</span><br><span class="line">chown -R oracle<span class="selector-class">.oinstall</span> /data/database</span><br></pre></td></tr></table></figure></p><p>准备oracle安装应答模板文件db_install.rsp文件</p><p><ul>该文件默认存放在解压后的安装包内，也就是本例中/data/database/response下，将oracle静默安装所需应答文件全部拷贝至 /usr/local/oracle文件夹下<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">将oracle静默安装所需应答文件全部拷贝至 <span class="regexp">/usr/</span>local/oracle文件夹下</span><br><span class="line"></span><br><span class="line">cp <span class="regexp">/data/</span>database<span class="regexp">/response/</span>* <span class="regexp">/usr/</span>local<span class="regexp">/oracle/</span></span><br><span class="line"></span><br><span class="line">修改安装所需的所有应答文件的所属组及权限</span><br><span class="line"></span><br><span class="line">chown  <span class="string">oracle:</span>oinstall <span class="regexp">/usr/</span>local<span class="regexp">/oracle/</span>*.rsp</span><br><span class="line">chmod <span class="number">755</span> <span class="regexp">/usr/</span>local<span class="regexp">/oracle/</span>*.rsp</span><br><span class="line"></span><br><span class="line">配置db_install.rsp文件</span><br><span class="line">vi <span class="regexp">/usr/</span>local<span class="regexp">/oracle/</span>db_install.rsp</span><br><span class="line"></span><br><span class="line">文件内修改相应的参数配置如下：</span><br><span class="line">oracle.install.option=INSTALL_DB_SWONLY     　　　　　　　　<span class="comment">//安装类型,只装数据库软件</span></span><br><span class="line">ORACLE_HOSTNAME=db             　　　　　　　　　　　　　　　 <span class="comment">//主机名称（命令hostname查询）</span></span><br><span class="line">UNIX_GROUP_NAME=oinstall       　　　　　　　　　　　　　　　 <span class="comment">// 安装组</span></span><br><span class="line">INVENTORY_LOCATION=<span class="regexp">/usr/</span>local<span class="regexp">/oraInventory  　　　　　　　　/</span>/INVENTORY目录（**不填就是默认值,本例此处需修改,因个人创建安装目录而定）</span><br><span class="line">SELECTED_LANGUAGES=en,zh_CN            　　　　　　　　 　　<span class="comment">// 选择语言</span></span><br><span class="line">ORACLE_HOME=<span class="regexp">/usr/</span>local<span class="regexp">/oracle/</span>product<span class="regexp">/11.2.0/</span>db_1  　　　　<span class="comment">// oracle_home *路径根据目录情况注意修改 本例安装路径/usr/local/oracle</span></span><br><span class="line">ORACLE_BASE=<span class="regexp">/usr/</span>local<span class="regexp">/oracle                       　　　 /</span>/ oracle_base *注意修改</span><br><span class="line">oracle.install.db.InstallEdition=EE          　　　　　　　 <span class="comment">// oracle版本</span></span><br><span class="line">oracle.install.db.isCustomInstall=<span class="literal">false</span>      　　　　　　　 <span class="comment">//自定义安装，否，使用默认组件</span></span><br><span class="line">oracle.install.db.DBA_GROUP=dba              　　　　　　　 <span class="comment">//dba用户组</span></span><br><span class="line">oracle.install.db.OPER_GROUP=oinstall        　　　　　　　 <span class="comment">//oper用户组</span></span><br><span class="line">oracle.install.db.config.starterdb.type=GENERAL_PURPOSE   <span class="comment">//数据库类型</span></span><br><span class="line">oracle.install.db.config.starterdb.globalDBName=orcl      <span class="comment">//globalDBName</span></span><br><span class="line">oracle.install.db.config.starterdb.SID=orcl  　　　　　　　 <span class="comment">//SID（**此处注意与环境变量内配置SID一致）</span></span><br><span class="line">oracle.install.db.config.starterdb.memoryLimit=<span class="number">81920</span>      <span class="comment">//自动管理内存的内存(M)</span></span><br><span class="line">oracle.install.db.config.starterdb.password.ALL=oracle    <span class="comment">//设定所有数据库用户使用同一个密码</span></span><br><span class="line">SECURITY_UPDATES_VIA_MYORACLESUPPORT=<span class="literal">false</span>       　　　　　 <span class="comment">//（手动写了false）</span></span><br><span class="line">DECLINE_SECURITY_UPDATES=<span class="literal">true</span>　　　　　　　　　　　　　　　　　<span class="comment">// **注意此参数 设定一定要为true</span></span><br></pre></td></tr></table></figure></ul></p><p>设置oracle用户环境<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">由root切换至创建好的oracle用户</span><br><span class="line">su - oracle</span><br><span class="line"></span><br><span class="line">修改该用户的用户配置文件</span><br><span class="line">vi .bash_profile</span><br><span class="line"></span><br><span class="line">文件内加入并修改至以下内容</span><br><span class="line"></span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">ORACLE_BASE</span>=/usr/local/oracle</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">ORACLE_HOME</span>=<span class="variable">$ORACLE_BASE</span>/product/11.2.0/db_1</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">ORACLE_SID</span>=orcl</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">ORACLE_OWNER</span>=oracle</span><br><span class="line"><span class="builtin-name">export</span> <span class="attribute">PATH</span>=<span class="variable">$PATH</span>:$ORACLE_HOME/bin:$HOME/bin</span><br><span class="line"></span><br><span class="line">保存退出后执行source命令立即生效。</span><br><span class="line">source .bash_profile</span><br></pre></td></tr></table></figure></p><p>在oracle用户下开始安装<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">执行命令。</span><br><span class="line"></span><br><span class="line"><span class="comment">/data/database/./runInstaller -silent -force -ignorePrereq -responseFile /usr/local/oracle/db_install.rsp</span></span><br><span class="line"></span><br><span class="line">参数说明</span><br><span class="line"><span class="comment">　　/data/database是安装包解压后的路径，此处根据安装包解压所在位置做修改，因人而异。</span></span><br><span class="line">　　runInstaller 是主要安装脚本</span><br><span class="line">　　-<span class="ruby">silent 静默模式</span></span><br><span class="line"><span class="ruby">　　-force 强制安装</span></span><br><span class="line"><span class="ruby">　　-ignorePrereq忽略warning直接安装。</span></span><br><span class="line"><span class="ruby">　　-responseFile读取安装应答文件。</span></span><br></pre></td></tr></table></figure></p><p>xshell另起窗口并以root登陆<br><figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">watch -d -n <span class="number">2</span> <span class="symbol">'du</span> -sh /usr/<span class="keyword">local</span>/oracle'    监测oracle安装目录是否变化。或者直接tail -f命令监测安装log日志,不赘述。</span><br></pre></td></tr></table></figure></p><p>等待安装编译直至出现以下内容，在新创建的root窗口内执行以下提示内的脚本，<br>既/usr/oracle/oraInventory/orainstRoot.sh  /usr/local/oracle/product/11.2.0/db_1/root.sh<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">/usr/oracle/oraInventory/orainstRoot.<span class="keyword">sh</span>     <span class="comment">//我的没有出现这个所以没执行</span></span><br><span class="line">/usr/<span class="keyword">local</span>/oracle/product/11.2.0/db_1/root.<span class="keyword">sh</span></span><br><span class="line"></span><br><span class="line">　　To execute the configuration scripts:</span><br><span class="line"></span><br><span class="line">　　1. <span class="keyword">Open</span> a terminal <span class="keyword">window</span></span><br><span class="line"></span><br><span class="line">　　2. <span class="keyword">Log</span> <span class="keyword">in</span> <span class="keyword">as</span> <span class="string">"root"</span></span><br><span class="line"></span><br><span class="line">　　3. <span class="keyword">Run</span> the scripts</span><br><span class="line"></span><br><span class="line">　　4. <span class="keyword">Return</span> to this <span class="keyword">window</span> and hit<span class="string">"Enter"</span> key to <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line"> 　　Successfully Setup Software.</span><br><span class="line"></span><br><span class="line">#-------------------------------------------------------------------</span><br></pre></td></tr></table></figure></p><p>sqlpuls登录<br><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sqlplus / <span class="keyword">as</span> sysdba</span><br><span class="line"></span><br><span class="line">SQL*Plus: Release <span class="number">11.2</span><span class="number">.0</span><span class="number">.1</span><span class="number">.0</span> Production <span class="keyword">on</span> <span class="title">Wed</span> <span class="title">Sep</span> <span class="title">19</span> <span class="title">11</span>:<span class="title">07</span>:<span class="title">23</span> <span class="title">2018</span></span><br><span class="line"></span><br><span class="line">Copyright (c) <span class="number">1982</span>, <span class="number">2009</span>, Oracle.  All rights reserved.</span><br><span class="line"></span><br><span class="line">Connected <span class="built_in">to</span> <span class="keyword">an</span> idle instance.</span><br><span class="line"></span><br><span class="line">SQL&gt;</span><br></pre></td></tr></table></figure></p><p>授权用户<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grant</span> <span class="keyword">connect</span>,<span class="keyword">resource</span>,dba <span class="keyword">to</span> username</span><br></pre></td></tr></table></figure></p><p>创建用户并指定表空间<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">create<span class="built_in"> user </span>username identified by password</span><br><span class="line">default tablespace user_data</span><br><span class="line">temporary tablespace user_temp;</span><br></pre></td></tr></table></figure></p><p>退出<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">exit</span></span><br></pre></td></tr></table></figure></p><h3>Oracle 11g 静默安装教程结束…………</h3>]]></content>
      
      
      <categories>
          
          <category> Oracle </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Oracle </tag>
            
            <tag> Xmanager5下载 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>PHP-7.2.1_install</title>
      <link href="/2018/09/18/Service_PHP-7-2-1_install/"/>
      <url>/2018/09/18/Service_PHP-7-2-1_install/</url>
      
        <content type="html"><![CDATA[<p>PHP7编译安装<br><a id="more"></a></p><p>部署环境<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">OS</span>    : <span class="selector-tag">CentOS</span> <span class="selector-tag">Linux</span> <span class="selector-tag">release</span> 7<span class="selector-class">.5</span><span class="selector-class">.1804</span> (<span class="selector-tag">Core</span>)</span><br><span class="line"><span class="selector-tag">Kernel</span>: 3<span class="selector-class">.10</span><span class="selector-class">.0-514</span><span class="selector-class">.26</span><span class="selector-class">.2</span><span class="selector-class">.el7</span><span class="selector-class">.x86_64</span></span><br></pre></td></tr></table></figure></p><p>安装php依赖组件（包含Nginx依赖）<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install wget vim pcre pcre-devel openssl openssl-devel libicu-devel gcc gcc-c++ autoconf libjpeg libjpeg-devel libpng libpng-devel freetype freetype-devel libxml2 libxml2-devel zlib zlib-devel glibc glibc-devel glib2 glib2-devel ncurses ncurses-devel curl curl-devel krb5-devel libidn libidn-devel openldap openldap-devel nss_ldap jemalloc-devel cmake boost-devel bison automake libevent libevent-devel <span class="built_in">gd</span> <span class="built_in">gd</span>-devel libtool* libmcrypt libmcrypt-devel mcrypt mhash libxslt libxslt-devel <span class="built_in">readline</span> <span class="built_in">readline</span>-devel gmp gmp-devel libcurl libcurl-devel openjpeg-devel</span><br></pre></td></tr></table></figure></p><p>创建用户和组，并下载安装包解压<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">groupadd www</span><br><span class="line">useradd -g www www</span><br><span class="line">wget http:<span class="comment">//am1.php.net/distributions/php-7.2.1.tar.gz</span></span><br><span class="line">tar xvf php-<span class="number">7.2</span>.<span class="number">1</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br><span class="line">cd php-<span class="number">7.2</span>.<span class="number">1</span></span><br></pre></td></tr></table></figure></p><p>设置变量并开始源码编译<br><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cp -frp <span class="string">/usr/lib64/libldap</span>* <span class="string">/usr/lib/</span></span><br><span class="line"><span class="string">./configure</span> <span class="params">--prefix=/usr/local/php</span> <span class="params">--with-config-file-path=/usr/local/php/etc</span> <span class="params">--enable-fpm</span> <span class="params">--with-fpm-user=www</span> <span class="params">--with-fpm-group=www</span> <span class="params">--enable-mysqlnd</span> <span class="params">--with-mysqli=mysqlnd</span> <span class="params">--with-pdo-mysql=mysqlnd</span> <span class="params">--enable-mysqlnd-compression-support</span> <span class="params">--with-iconv-dir</span> <span class="params">--with-freetype-dir</span> <span class="params">--with-jpeg-dir</span> <span class="params">--with-png-dir</span> <span class="params">--with-zlib</span> <span class="params">--with-libxml-dir</span> <span class="params">--enable-xml</span> <span class="params">--disable-rpath</span> <span class="params">--enable-bcmath</span> <span class="params">--enable-shmop</span> <span class="params">--enable-sysvsem</span> <span class="params">--enable-inline-optimization</span> <span class="params">--with-curl</span> <span class="params">--enable-mbregex</span> <span class="params">--enable-mbstring</span> <span class="params">--enable-intl</span> <span class="params">--with-mcrypt</span> <span class="params">--with-libmbfl</span> <span class="params">--enable-ftp</span> <span class="params">--with-gd</span> <span class="params">--enable-gd-jis-conv</span> <span class="params">--enable-gd-native-ttf</span> <span class="params">--with-openssl</span> <span class="params">--with-mhash</span> <span class="params">--enable-pcntl</span> <span class="params">--enable-sockets</span> <span class="params">--with-xmlrpc</span> <span class="params">--enable-zip</span> <span class="params">--enable-soap</span> <span class="params">--with-gettext</span> <span class="params">--disable-fileinfo</span> <span class="params">--enable-opcache</span> <span class="params">--with-pear</span> <span class="params">--enable-maintainer-zts</span> <span class="params">--with-ldap=shared</span> <span class="params">--without-gdbm</span></span><br></pre></td></tr></table></figure></p><p>注：若无报错执行下一步安装，如果编译过程中出现错误，根据报错安装依赖包，通常不会出现这种问题。<br>注：–enable-gd-jis-conv  此参数会导致Zabbix中文字符乱码，建议取消。<br>开始安装<br><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">make</span> -j <span class="number">4</span> &amp;&amp; <span class="built_in">make</span> install</span><br></pre></td></tr></table></figure></p><p>完成安装后配置PHP.ini文件<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cp php.ini-development <span class="regexp">/usr/</span>local<span class="regexp">/php/</span>etc/php.ini</span><br><span class="line">cp <span class="regexp">/usr/</span>local<span class="regexp">/php/</span>etc<span class="regexp">/php-fpm.conf.default /</span>usr<span class="regexp">/local/</span>php<span class="regexp">/etc/</span>php-fpm.conf</span><br><span class="line">cp <span class="regexp">/usr/</span>local<span class="regexp">/php/</span>etc<span class="regexp">/php-fpm.d/</span>www.conf.<span class="keyword">default</span> <span class="regexp">/usr/</span>local<span class="regexp">/php/</span>etc<span class="regexp">/php-fpm.d/</span>www.conf</span><br></pre></td></tr></table></figure></p><p>修改配置文件<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/<span class="keyword">local</span>/php/etc/php-fpm.<span class="keyword">conf</span></span><br><span class="line">找到PID，将前面的分号注释去掉,如下：</span><br><span class="line">pid = <span class="keyword">run</span>/php-fpm.pid</span><br></pre></td></tr></table></figure></p><p>启动php-fpm<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/usr/</span>local<span class="regexp">/php/</span>sbin<span class="regexp">/php-fpm</span></span><br></pre></td></tr></table></figure></p><p>查看php扩展<br><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cd</span> <span class="string">/usr/local/php/bin/</span></span><br><span class="line"><span class="string">./php</span> -m</span><br></pre></td></tr></table></figure></p><p>php软链接创建<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ln -s <span class="regexp">/usr/</span>local<span class="regexp">/php/</span>bin<span class="regexp">/php /u</span>sr<span class="regexp">/bin/</span></span><br><span class="line">ln -s <span class="regexp">/usr/</span>local<span class="regexp">/php/</span>bin<span class="regexp">/phar /u</span>sr<span class="regexp">/bin/</span></span><br><span class="line">ln -s <span class="regexp">/usr/</span>local<span class="regexp">/php/</span>bin<span class="regexp">/phar.phar /u</span>sr<span class="regexp">/bin/</span></span><br><span class="line">ln -s <span class="regexp">/usr/</span>local<span class="regexp">/php/</span>bin<span class="regexp">/php-cgi /u</span>sr<span class="regexp">/bin/</span></span><br><span class="line">ln -s <span class="regexp">/usr/</span>local<span class="regexp">/php/</span>bin<span class="regexp">/php-config  /u</span>sr<span class="regexp">/bin/</span></span><br><span class="line">ln -s <span class="regexp">/usr/</span>local<span class="regexp">/php/</span>bin<span class="regexp">/phpize  /u</span>sr<span class="regexp">/bin/</span></span><br></pre></td></tr></table></figure></p><p>查看php编译时的参数<br><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -i <span class="string">| grep configure</span></span><br></pre></td></tr></table></figure></p><p></p><h1></h1><br>修改php.ini配置文件相关参数<br><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/php/etc/php.ini</span><br><span class="line">expose_php = Off</span><br><span class="line">short_open_tag = ON</span><br><span class="line">max_execution_time = 300</span><br><span class="line">max_input_time = 300</span><br><span class="line">memory_limit = 128M</span><br><span class="line">post_max_size = 32M</span><br><span class="line">date.timezone = Asia/Shanghai</span><br><span class="line">mbstring.func_overload=2</span><br><span class="line">extension = <span class="string">"/usr/local/php/lib/php/extensions/no-debug-zts-20170718/ldap.so"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#OPcache 缓存</span></span><br><span class="line">[opcache]</span><br><span class="line">zend_extension=/usr/local/php/lib/php/extensions/no-debug-zts-20170718/opcache.so</span><br><span class="line">opcache.memory_consumption=128</span><br><span class="line">opcache.interned_strings_buffer=8</span><br><span class="line">opcache.max_accelerated_files=4000</span><br><span class="line">opcache.revalidate_freq=60</span><br><span class="line">opcache.fast_shutdown=1</span><br><span class="line">opcache.enable_cli=1</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置php安全函数</span></span><br><span class="line">disable_functions = passthru,exec,system,chroot,chgrp,chown,shell_exec,proc_open,proc_get_status,popen,ini_alter,ini_restore,dl,openlog,syslog,readlink,symlink,popepassthru</span><br></pre></td></tr></table></figure><p></p><p>修改<a href="http://www.conf" target="_blank" rel="noopener">www.conf</a> 配置文件相关参数<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">vim  /usr/local/php/etc/php-fpm.d/www.conf</span><br><span class="line"></span><br><span class="line">listen = /var/run/www/php-cgi.sock</span><br><span class="line">listen<span class="selector-class">.owner</span> = www</span><br><span class="line">listen<span class="selector-class">.group</span> = www</span><br><span class="line">listen<span class="selector-class">.mode</span> = <span class="number">0660</span></span><br><span class="line">listen<span class="selector-class">.allowed_clients</span> = <span class="number">127.0</span>.<span class="number">0.1</span></span><br><span class="line">pm = dynamic</span><br><span class="line">listen<span class="selector-class">.backlog</span> = -<span class="number">1</span></span><br><span class="line">pm<span class="selector-class">.max_children</span> = <span class="number">180</span></span><br><span class="line">pm<span class="selector-class">.start_servers</span> = <span class="number">50</span></span><br><span class="line">pm<span class="selector-class">.min_spare_servers</span> = <span class="number">50</span></span><br><span class="line">pm<span class="selector-class">.max_spare_servers</span> = <span class="number">180</span></span><br><span class="line">request_terminate_timeout = <span class="number">120</span></span><br><span class="line">request_slowlog_timeout = <span class="number">50</span></span><br><span class="line">slowlog = var/log/slow.log</span><br></pre></td></tr></table></figure></p><p>创建php-cgi.sock存放目录<br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir /var/<span class="keyword">run</span><span class="bash">/www/</span></span><br><span class="line"><span class="bash">chown -R www:www /var/run/www</span></span><br></pre></td></tr></table></figure></p><p>创建system系统单元文件php-fpm启动脚本：<br><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[Unit]</span></span><br><span class="line"><span class="attr">Description</span>=The PHP FastCGI Process Manager</span><br><span class="line"><span class="attr">After</span>=syslog.target network.target</span><br><span class="line"></span><br><span class="line"><span class="section">[Service]</span></span><br><span class="line"><span class="attr">Type</span>=simple</span><br><span class="line"><span class="attr">PIDFile</span>=/usr/local/php/var/run/php-fpm.pid</span><br><span class="line"><span class="attr">ExecStart</span>=/usr/local/php/sbin/php-fpm --nodaemonize --fpm-config /usr/local/php/etc/php-fpm.conf</span><br><span class="line"><span class="attr">ExecReload</span>=/bin/kill -USR2 <span class="variable">$MAINPID</span></span><br><span class="line"></span><br><span class="line"><span class="section">[Install]</span></span><br><span class="line"><span class="attr">WantedBy</span>=multi-user.target</span><br></pre></td></tr></table></figure></p><p>启动 php-fpm 服务并加入开机启动<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">systemctl</span> <span class="selector-tag">enable</span> <span class="selector-tag">php-fpm</span><span class="selector-class">.service</span></span><br><span class="line"><span class="selector-tag">systemctl</span> <span class="selector-tag">restart</span> <span class="selector-tag">php-fpm</span><span class="selector-class">.service</span></span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Service_PHP </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>PXE_install_system</title>
      <link href="/2018/09/17/PXE-install-system/"/>
      <url>/2018/09/17/PXE-install-system/</url>
      
        <content type="html"><![CDATA[<p>PXE一键安装操作系统及配置<br><a id="more"></a><br>部署环境<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">Red</span> <span class="selector-tag">Hat</span> ： 7<span class="selector-class">.2</span></span><br><span class="line"><span class="selector-tag">Kernel</span>  ：3<span class="selector-class">.10</span><span class="selector-class">.0-327</span><span class="selector-class">.el7</span><span class="selector-class">.x86_64</span></span><br></pre></td></tr></table></figure></p><p>关闭防火墙及Selinux<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Selinux：</span><br><span class="line">setenforce 0  宽松模式</span><br><span class="line">sed -i <span class="string">"s/enforcing/disabled/g"</span>  /etc/selinux<span class="built_in">/config </span>  永久关闭</span><br><span class="line">Firewalld：</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="builtin-name">disable</span> firewalld</span><br></pre></td></tr></table></figure></p><p>安装软件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">httpd、rhel7源、DHCP、TFTP、</span><br></pre></td></tr></table></figure></p><p>IP地址<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">本机IP：<span class="number">10.10</span><span class="number">.1</span><span class="number">.2</span>/<span class="number">24</span>  <span class="number">10.10</span><span class="number">.1</span><span class="number">.254</span>    虚拟NAT</span><br><span class="line">        <span class="number">192.168</span><span class="number">.179</span><span class="number">.2</span>/<span class="number">24</span>            虚拟仅主机</span><br><span class="line">虚拟NAT网段：<span class="number">10.10</span><span class="number">.1</span><span class="number">.0</span>/<span class="number">24</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.254</span></span><br></pre></td></tr></table></figure></p><p>一、要求为进行PXE服务器构建提供RHEL7软件仓库，完成下列任务</p><p><ul>1.安装httpd服务并启动</ul></p><p><ul>2.挂载rhel7镜像并能够访问</ul></p><p><ul>3.测试pxe镜像源<br><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">yum -y install httpd</span><br><span class="line">systemctl start httpd</span><br><span class="line">systemctl enable httpd</span><br><span class="line">mkdir <span class="meta-keyword">/var/</span>www<span class="meta-keyword">/html/</span>pxe</span><br><span class="line">mount <span class="meta-keyword">/dev/</span>sr0  <span class="meta-keyword">/var/</span>www<span class="meta-keyword">/html/</span>pxe</span><br><span class="line">echo <span class="string">"mount /dev/sr0  /var/www/html/pxe &amp;&gt;/dev/null"</span> &gt;&gt;~/.bashrc    写入开机文件，写在<span class="meta-keyword">/etc/</span>fstab文件也可行</span><br><span class="line"><span class="meta"># vim /etc/fstab</span></span><br><span class="line"><span class="meta"># /ISO/rhel-server-7.2-x86_64-dvd.iso  /var/www/html/rh7dvd  iso9660  loop,ro  0  0</span></span><br><span class="line">浏览器访问地址：</span><br><span class="line"><span class="symbol">http:</span><span class="comment">//192.168.179.2/pxe</span></span><br></pre></td></tr></table></figure></ul></p><p>安装DHCP服务并配置验证</p><p><ul>1.DHCP服务器地址范围:192.168.179.3-253 10.10.1.3-253</ul></p><p><ul>2.PXE引导文件 pxelinux.0</ul></p><p><ul>3.测试DHCP服务<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">yum -y install dhcp</span><br><span class="line"></span><br><span class="line">vim /etc/dhcp/dhcpd.conf</span><br><span class="line"></span><br><span class="line">subnet <span class="number">192.168</span><span class="number">.179</span><span class="number">.0</span> netmask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> &#123;</span><br><span class="line">range  <span class="number">192.168</span><span class="number">.179</span><span class="number">.3</span> <span class="number">192.168</span><span class="number">.179</span><span class="number">.253</span>;</span><br><span class="line">next-server  <span class="number">192.168</span><span class="number">.179</span><span class="number">.2</span>;</span><br><span class="line">filename  <span class="string">"pxelinux.0"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">subnet <span class="number">10.10</span><span class="number">.1</span><span class="number">.0</span> netmask <span class="number">255.255</span><span class="number">.255</span><span class="number">.0</span> &#123;</span><br><span class="line">range  <span class="number">10.10</span><span class="number">.1</span><span class="number">.3</span> <span class="number">10.10</span><span class="number">.1</span><span class="number">.253</span>;</span><br><span class="line">next-server  <span class="number">10.10</span><span class="number">.1</span><span class="number">.2</span>;</span><br><span class="line">filename  <span class="string">"pxelinux.0"</span>;</span><br><span class="line">&#125;</span><br><span class="line">保存并退出</span><br><span class="line"></span><br><span class="line">systemctl start dhcpd</span><br><span class="line">systemctl enable dhcpd</span><br><span class="line">netstat -antpu | grep dhcpd</span><br><span class="line"></span><br><span class="line">测试：</span><br><span class="line">dhclient -d eno16777736</span><br></pre></td></tr></table></figure></ul></p><p>安装TFTP服务端<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">yum -y <span class="keyword">install</span> tftp-<span class="keyword">server</span></span><br><span class="line">systemctl <span class="keyword">start</span> tftp</span><br><span class="line">systemctl <span class="keyword">enable</span> tftp</span><br></pre></td></tr></table></figure></p><p>配置PXE引导</p><p><ul>启用TFTP服务器，部署引导文件（内核vmlinuz、初始文件initrd.img、网卡启动程序pxelinux.0）</ul></p><p><ul>创建pxelinux.cfg/配置目录，在此目录下建立默认引导文件default</ul></p><p><li>网卡启动程序pxelinux.0由软件包syslinux提供</li></p><p><li>PXE安装用的内核及初始化文件可从RHEL7的光盘目录/images/pxeboot/下提取</li></p><p><li>PXE启动配置相关资料可参考RHEL7的光盘目录/isolinux/，其中包括图形支持模块vesamenu.c32、背景图片spash.png、菜单配置文件isolinux.cfg（使用时改名为default)<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum  -y  install  syslinux</span><br><span class="line">rpm  -ql  syslinux  |  grep pxelinux.<span class="number">0</span></span><br><span class="line">cp  /usr/share/syslinux/pxelinux.<span class="number">0</span>  /var/<span class="class"><span class="keyword">lib</span>/<span class="title">tftpboot</span>/</span></span><br><span class="line">ls /var/<span class="class"><span class="keyword">lib</span>/<span class="title">tftpboot</span>/</span></span><br></pre></td></tr></table></figure></li></p><p><li>拷贝引导装机的内核、初始镜像，部署到TFTP目录当文件较多时，可以在TFTP目录下创建子目录<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir  /var/<span class="class"><span class="keyword">lib</span>/<span class="title">tftpboot</span>/<span class="title">rhel7</span></span></span><br><span class="line">cd  /var/<span class="class"><span class="keyword">lib</span>/<span class="title">tftpboot</span>/<span class="title">rhel7</span>/</span></span><br><span class="line">wget  <span class="symbol">http:</span>/<span class="regexp">/192.168.179.2/pxe</span><span class="regexp">/isolinux/vmlinuz</span></span><br><span class="line">wget  <span class="symbol">http:</span>/<span class="regexp">/192.168.179.2/pxe</span><span class="regexp">/isolinux/initrd</span>.img</span><br></pre></td></tr></table></figure></li></p><p>配置启动菜单</p><p><li>创建配置目录<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkdir  /var/<span class="class"><span class="keyword">lib</span>/<span class="title">tftpboot</span>/<span class="title">pxelinux</span>.<span class="title">cfg</span></span></span><br><span class="line">cd  /var/<span class="class"><span class="keyword">lib</span>/<span class="title">tftpboot</span>/</span></span><br><span class="line">wget  <span class="symbol">http:</span>/<span class="regexp">/192.168.179.2/pxe</span><span class="regexp">/isolinux/vesamenu</span>.c32        /<span class="regexp">/提供图形支持</span></span><br><span class="line"><span class="regexp">wget  http:/</span><span class="regexp">/192.168.179.2/pxe</span><span class="regexp">/isolinux/splash</span>.png         /<span class="regexp">/背景图片</span></span><br><span class="line"><span class="regexp">wget  -O  pxelinux.cfg/default</span>  <span class="symbol">http:</span>/<span class="regexp">/192.168.179.2/pxe</span><span class="regexp">/isolinux/isolinux</span>.cfg  /<span class="regexp">/引导菜单</span></span><br><span class="line"><span class="regexp">ls  -R  /var</span><span class="regexp">/lib/tftpboot</span><span class="regexp">/</span></span><br></pre></td></tr></table></figure></li></p><p><li>调整启动参数<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vim  /var/lib/tftpboot/pxelinux.cfg/default</span><br><span class="line"></span><br><span class="line">default vesamenu<span class="selector-class">.c32</span>                              <span class="comment">//默认交给图形模块处理</span></span><br><span class="line">timeout <span class="number">600</span>                                      <span class="comment">//选择限时为60秒（单位1/10秒）</span></span><br><span class="line"><span class="selector-tag">menu</span> title  PXE  Installation  Server             <span class="comment">//启动菜单标题信息</span></span><br><span class="line"><span class="selector-tag">label</span>  linux                                  <span class="comment">//菜单项标签</span></span><br><span class="line"><span class="selector-tag">menu</span>  <span class="selector-tag">label</span>  ^Install Red Hat Enterprise Linux <span class="number">7.2</span></span><br><span class="line">kernel  rhel7/vmlinuz                      <span class="comment">//内核的位置</span></span><br><span class="line">append  initrd=rhel7/initrd<span class="selector-class">.img</span>  inst.stage2=http:<span class="comment">//192.168.179.2/pxe   //初始镜像、安装源地址</span></span><br></pre></td></tr></table></figure></li></p><p>测试TFTP服务是否可用</p><p><li>安装tftp客户端</li></p><p><li>测试get</li></p><p><li>查看get结果<br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">yum  -y  install  tftp</span><br><span class="line">cd /root</span><br><span class="line">tftp  <span class="number">192.168</span><span class="number">.179</span><span class="number">.2</span>  -c  get pxelinux<span class="number">.0</span>     <span class="comment">//get pxelinux.0到当前目录</span></span><br><span class="line">ll -h pxelinux<span class="number">.0</span></span><br></pre></td></tr></table></figure></li></p><p>部署自动应答文件<br><a href="https://soliton.net.cn/download/linux/txh.cfg" target="_blank" rel="noopener">图形化下载</a><br><a href="https://soliton.net.cn/download/linux/zxh.cfg" target="_blank" rel="noopener">最小化下载</a><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">将生成好的应答文件放入http的可访问目录下 格式（.cfg）：</span><br><span class="line"></span><br><span class="line">mv zxh.cfg  <span class="regexp">/var/</span>www<span class="regexp">/html/</span></span><br><span class="line">mv txh.cfg  <span class="regexp">/var/</span>www<span class="regexp">/html/</span></span><br><span class="line"></span><br><span class="line">测试是否可以下载：</span><br><span class="line">wget <span class="string">http:</span><span class="comment">//192.168.179.2/txh.cfg         //图形化自动应答</span></span><br><span class="line">wget <span class="string">http:</span><span class="comment">//192.168.179.2.zxh.cfg         //最小化自动应答</span></span><br></pre></td></tr></table></figure></p><p>修改PXE服务 default 引导配置文件，调用自动应答文件<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim  /var/lib/tftpboot/pxelinux.cfg/default</span><br><span class="line">修改如下：只改这行</span><br><span class="line">append <span class="attribute">initrd</span>=rhel7/initrd.img <span class="attribute">ks</span>=http://192.168.179.2/zxh.cfg</span><br><span class="line"></span><br><span class="line">append <span class="attribute">initrd</span>=rhel7/initrd.img <span class="attribute">ks</span>=http://192.168.179.2/txh.cfg</span><br></pre></td></tr></table></figure></p><p>重启服务<br><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl <span class="built_in">restart</span> dhcpd</span><br><span class="line">systemctl <span class="built_in">restart</span> tftp.service</span><br><span class="line">systemctl <span class="built_in">restart</span> httpd</span><br></pre></td></tr></table></figure></p><p>接着就可以去测试了</p>]]></content>
      
      
      <categories>
          
          <category> PXE </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PXE </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Selenium+Chrome+Chromedriver</title>
      <link href="/2018/09/11/Selenium-Chrome-Chromedriver/"/>
      <url>/2018/09/11/Selenium-Chrome-Chromedriver/</url>
      
        <content type="html"><![CDATA[<p>自动化测试，嗯、很不错，在网上找文档都没解决，后来自己留心了下才解决的问题，花了很久才弄好的，感觉教程都有毒。</p><a id="more"></a><h3>开始正题</h3><p>在centos7上安装Selenium + Chromedriver，并且使用facebook/webdriver测试<br>系统环境：<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">CentOS</span> <span class="selector-tag">Linux</span> <span class="selector-tag">release</span> 7<span class="selector-class">.5</span><span class="selector-class">.1804</span> (<span class="selector-tag">Core</span>)</span><br><span class="line">4<span class="selector-class">.9</span><span class="selector-class">.93-boot2docker</span></span><br><span class="line"><span class="selector-tag">Architecture</span>: <span class="selector-tag">X86-64</span></span><br></pre></td></tr></table></figure></p><p>安装php 7.2：使用yum 安装，也可编译安装   下面是安装php各种扩展，随意<br><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rpm -Uvh https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm </span><br><span class="line">rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm</span><br><span class="line">yum -y install php72w php72w-cli php72w-common php72w-devel php72w-embedded php72w-fpm php72w-gd php72w-mbstring php72w-mysqlnd php72w-opcache php72-pdo php72w-xml</span><br></pre></td></tr></table></figure></p><p>安装Chrome 浏览器<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install http<span class="variable">s:</span>//<span class="keyword">dl</span>.google.<span class="keyword">com</span>/linux/direct/google-chrome-stable_current_x86_64.rpm &amp;&amp; yum -<span class="keyword">y</span> install GConf2 wget</span><br></pre></td></tr></table></figure></p><p>安装JAVA 1.8.0版本，因为Selenium3版本的需要java1.8.0支持<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">yum</span> <span class="selector-tag">-y</span> <span class="selector-tag">install</span> <span class="selector-tag">java-1</span><span class="selector-class">.8</span><span class="selector-class">.0</span></span><br></pre></td></tr></table></figure></p><p>安装Selenium-server，下载Selenium-server 用java 直接执行即可<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http:<span class="regexp">//</span>selenium-release.storage.googleapis.com<span class="regexp">/3.14/</span>selenium-server-standalone-<span class="number">3.14</span>.<span class="number">0</span>.jar</span><br></pre></td></tr></table></figure></p><p>Selenium服务初始化并输出日志放在后台执行<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohub java -jar selenium-server-standalone-<span class="number">3.14</span>.<span class="number">0</span><span class="selector-class">.jar</span> &amp;&gt;&gt;/tmp/selenium-server<span class="selector-class">.log</span> &amp;</span><br></pre></td></tr></table></figure></p><p>安装chromedriver （谷歌驱动）<a href="https://sites.google.com/a/chromium.org/chromedriver/downloads" target="_blank" rel="noopener">最新版下载</a><br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wget <span class="symbol">https:</span>/<span class="regexp">/soliton.net.cn/download</span><span class="regexp">/linux/chromedriver</span><span class="comment">#谷歌驱动</span></span><br><span class="line">wget <span class="symbol">https:</span>/<span class="regexp">/soliton.net.cn/download</span><span class="regexp">/linux/geckodriver</span><span class="comment">#火狐驱动</span></span><br><span class="line">chmod +x chromedriver<span class="comment">#赋予执行权限</span></span><br><span class="line">mv chromedriver /usr/bin<span class="comment">#移动到系统默认路径为了更方便的调用</span></span><br></pre></td></tr></table></figure></p><p>安装Xvfb（相当于虚拟的图形化）<br><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y isntall Xvfb xorg-xll-<span class="built_in">fonts</span>* -y</span><br></pre></td></tr></table></figure></p><p>用xvfb 启动chrome，新建一个脚本<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/bin/xvfb-chrome</span><br><span class="line"><span class="comment">#!/bin/bash  </span></span><br><span class="line">  </span><br><span class="line"><span class="function"><span class="title">_kill_procs</span></span>() &#123;  </span><br><span class="line"><span class="built_in">kill</span> -TERM <span class="variable">$chrome</span>  </span><br><span class="line"><span class="built_in">wait</span> <span class="variable">$chrome</span>  </span><br><span class="line"><span class="built_in">kill</span> -TERM <span class="variable">$xvfb</span>  </span><br><span class="line">&#125;    </span><br><span class="line"><span class="comment"># Setup a trap to catch SIGTERM and relay it to child processes  </span></span><br><span class="line"></span><br><span class="line"><span class="built_in">trap</span> _kill_procs SIGTERM    </span><br><span class="line"></span><br><span class="line">XVFB_WHD=<span class="variable">$&#123;XVFB_WHD:-1280x720x16&#125;</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment"># Start Xvfb  </span></span><br><span class="line">Xvfb :99 -ac -screen 0 <span class="variable">$XVFB_WHD</span> -nolisten tcp &amp;  </span><br><span class="line">xvfb=$!  </span><br><span class="line"><span class="built_in">export</span> DISPLAY=:99    </span><br><span class="line">chrome --no-sandbox --<span class="built_in">disable</span>-gpu<span class="variable">$@</span> &amp;  </span><br><span class="line">chrome=$!  </span><br><span class="line"><span class="built_in">wait</span> <span class="variable">$chrome</span>  </span><br><span class="line"><span class="built_in">wait</span> <span class="variable">$xvfb</span></span><br></pre></td></tr></table></figure></p><p>给脚本赋予执行权限<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x  <span class="regexp">/usr/</span>bin<span class="regexp">/xvfb-chrome</span></span><br></pre></td></tr></table></figure></p><p>更改chrome启动的软链接<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ln -s <span class="regexp">/etc/</span>alternatives<span class="regexp">/google-chrome /</span>usr<span class="regexp">/bin/</span>chrome</span><br><span class="line">rm -rf <span class="regexp">/usr/</span>bin/google-chrome</span><br><span class="line">ln -s <span class="regexp">/usr/</span>bin<span class="regexp">/xvfb-chrome /</span>usr<span class="regexp">/bin/</span>google-chrome</span><br></pre></td></tr></table></figure></p><p>启动Chrome并创建日志文件并放在后台运行<br><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup google-chrome &amp;<span class="meta">&gt;&gt;</span>/tmp/chrome.log &amp;</span><br></pre></td></tr></table></figure></p><p>安装  facebook/webdriver<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -sS https:<span class="comment">//getcomposer.org/installer  | php</span></span><br><span class="line"></span><br><span class="line">php composer<span class="selector-class">.phar</span> require facebook/webdriver</span><br></pre></td></tr></table></figure></p><p>使用facebook的php-webdriver测试<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">vim test.php</span><br><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="comment">// An example of using php-webdriver.</span></span></span><br><span class="line"><span class="php"><span class="comment">// Do not forget to run composer install before and also have Selenium server started and listening on port 4444.</span></span></span><br><span class="line"><span class="php"><span class="keyword">namespace</span> <span class="title">Facebook</span>\<span class="title">WebDriver</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">use</span> <span class="title">Facebook</span>\<span class="title">WebDriver</span>\<span class="title">Remote</span>\<span class="title">DesiredCapabilities</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">use</span> <span class="title">Facebook</span>\<span class="title">WebDriver</span>\<span class="title">Remote</span>\<span class="title">RemoteWebDriver</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">require_once</span>(<span class="string">'vendor/autoload.php'</span>);</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="comment">// start Chrome with 5 second timeout</span></span></span><br><span class="line"><span class="php">$host = <span class="string">'http://localhost:4444/wd/hub'</span>; <span class="comment">// this is the default</span></span></span><br><span class="line"><span class="php">$capabilities = DesiredCapabilities::chrome();</span></span><br><span class="line"><span class="php">$driver = RemoteWebDriver::create($host, $capabilities, <span class="number">5000</span>);</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="comment">// navigate to 'http://www.baidu.com/'</span></span></span><br><span class="line"><span class="php">$driver-&gt;get(<span class="string">'https://www.baidu.com/'</span>);</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="comment">// wait until the page is loaded</span></span></span><br><span class="line"><span class="php"><span class="comment">// $driver-&gt;wait()-&gt;until(</span></span></span><br><span class="line"><span class="php"><span class="comment">//     WebDriverExpectedCondition::titleContains('潙¾度')  </span></span></span><br><span class="line"><span class="php"><span class="comment">// );</span></span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="comment">// print the title of the current page</span></span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"The title is '"</span> . $driver-&gt;getTitle() . <span class="string">"'\n"</span>;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="comment">// print the URI of the current page</span></span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> <span class="string">"The current URI is '"</span> . $driver-&gt;getCurrentURL() . <span class="string">"'\n"</span>;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="comment">// print the pagesource of the current page</span></span></span><br><span class="line"><span class="php">$html_selenium = $driver-&gt;getPageSource();</span></span><br><span class="line"><span class="php"><span class="keyword">echo</span> $html_selenium;</span></span><br><span class="line"><span class="php"></span></span><br><span class="line"><span class="php"><span class="comment">// close the browser</span></span></span><br><span class="line"><span class="php">$driver-&gt;quit();</span></span><br></pre></td></tr></table></figure></p><p>执行测试文件<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">php</span> <span class="selector-tag">test</span><span class="selector-class">.php</span></span><br></pre></td></tr></table></figure></p><p>命令行返回：（网页代码太多只看前十行）<br><img src="https://soliton.net.cn/soliton.images/webdriver.png"></p><p></p><h4>教程到此结束…………<p></p><p>注：如果是docker，你可以直接拉取我上传的镜像，启动时只要映射4444端口即可<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="symbol">docker</span> pull wangxinqiu/<span class="keyword">selenium-chrome-centos</span></span><br><span class="line"><span class="keyword">docker </span>run -<span class="keyword">it </span> --name <span class="keyword">selenium-chrome </span>-p <span class="number">4444</span>:<span class="number">4444</span>  wangxinqiu/<span class="keyword">selenium-chrome-centos </span>/<span class="keyword">bin/bash</span></span><br><span class="line"><span class="keyword">/sh/selenium-chrome.sh</span>启动<span class="keyword">Selenium-server </span>和chrome</span><br><span class="line">提示 ： 启动脚本后等一会儿再执行测试，不然会出启动chrome 的报错</span><br><span class="line"><span class="symbol">php</span> /<span class="meta">data</span>/test.phpfacebook测试</span><br></pre></td></tr></table></figure></p><p></p><h3>以上仅提供参考<p></p></h3></h4>]]></content>
      
      
      <categories>
          
          <category> Selenium+Chrome+Chromedriver </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Chrome </tag>
            
            <tag> Selenium </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>mysql-5.6.25_install</title>
      <link href="/2018/09/04/Service_Mysql-5-6-25_install/"/>
      <url>/2018/09/04/Service_Mysql-5-6-25_install/</url>
      
        <content type="html"><![CDATA[<p>Mysql数据库编译安装教程<br><a id="more"></a></p><p>注：我使用的 yum 是 本地yum + 阿里yum，本地 yum 没有 有很多包都没有，所以我的教程是这样的</p><p>安装 Mysql 依赖包<br><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y <span class="keyword">install </span>make gcc gcc-c++ cmake <span class="keyword">bison </span><span class="keyword">bison-devel </span>  ncurses-devel perl</span><br></pre></td></tr></table></figure></p><p>创建 mysql 用户和组<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">groupadd mysql</span><br><span class="line">useradd mysql -g mysql -M -s <span class="regexp">/sbin/</span>nologin</span><br></pre></td></tr></table></figure></p><p>下载 mysql-5.6.25<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget  --<span class="keyword">no</span>-check-certificate -<span class="keyword">c</span> http<span class="variable">s:</span>//downloads.mysql.<span class="keyword">com</span>/archives/<span class="built_in">get</span>/<span class="keyword">file</span>/mysql-<span class="number">5.6</span>.<span class="number">25</span>.tar.gz</span><br></pre></td></tr></table></figure></p><p>解压 mysql-5.6.25<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">tar</span> <span class="selector-tag">-zxf</span> <span class="selector-tag">mysql-5</span><span class="selector-class">.6</span><span class="selector-class">.25</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br><span class="line"><span class="selector-tag">cd</span> <span class="selector-tag">mysql-5</span><span class="selector-class">.6</span><span class="selector-class">.25</span></span><br></pre></td></tr></table></figure></p><p>安装Mysql，编译，编译安装<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cmake <span class="attribute">-DCMAKE_INSTALL_PREFIX</span>=/usr/local/mysql <span class="attribute">-DMYSQL_DATADIR</span>=/usr/local/mysql/data <span class="attribute">-DSYSCONFDIR</span>=/etc <span class="attribute">-DWITH_MYISAM_STORAGE_ENGINE</span>=1 <span class="attribute">-DWITH_INNOBASE_STORAGE_ENGINE</span>=1\</span><br><span class="line"></span><br><span class="line"><span class="attribute">-DWITH_MEMORY_STORAGE_ENGINE</span>=1 <span class="attribute">-DWITH_READLINE</span>=1 <span class="attribute">-DMYSQL_UNIX_ADDR</span>=/tmp/mysqld.sock <span class="attribute">-DMYSQL_TCP_PORT</span>=3306 <span class="attribute">-DENABLED_LOCAL_INFILE</span>=1 <span class="attribute">-DWITH_PARTITION_STORAGE_ENGINE</span>=1\</span><br><span class="line"></span><br><span class="line"><span class="attribute">-DEXTRA_CHARSETS</span>=all <span class="attribute">-DDEFAULT_CHARSET</span>=utf8 <span class="attribute">-DDEFAULT_COLLATION</span>=utf8_general_ci</span><br><span class="line"></span><br><span class="line">make </span><br><span class="line">make install</span><br></pre></td></tr></table></figure></p><p>授权 Mysql 用户目录<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chown <span class="string">mysql:</span>mysql <span class="regexp">/usr/</span>local/mysql</span><br></pre></td></tr></table></figure></p><p>Mysql 数据库初始化<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd <span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span></span><br><span class="line">.<span class="regexp">/scripts/my</span>sql_install_db --user=mysql --datadir=<span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span>data</span><br></pre></td></tr></table></figure></p><p>拷贝配置文件<br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cp support-files/my-default<span class="selector-class">.cnf</span>  /etc/my<span class="selector-class">.cnf</span> &lt;&lt; E</span><br><span class="line">y</span><br><span class="line">E</span><br></pre></td></tr></table></figure></p><p>修改 my.cnf 配置<br><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> <span class="comment">"datadir=/usr/local/mysql/data</span></span><br><span class="line">default-storage-engine=InnoDB</span><br><span class="line">lower_case_table_names=<span class="number">1</span><span class="comment">" &gt;&gt;/etc/my.cnf</span></span><br><span class="line"></span><br><span class="line">注： <span class="keyword">echo</span> 输出这三行 追加到/etc/my.<span class="keyword">cnf</span>配置文件里</span><br></pre></td></tr></table></figure></p><p>添加变量，刷新变量<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"PATH=<span class="variable">$PATH</span>:<span class="variable">$HOME</span>/bin:/usr/local/mysql/bin:/usr/local/mysql/lib"</span> &gt;&gt;  ~/.bash_profile</span><br><span class="line"><span class="built_in">source</span> ~/.bash_profile</span><br></pre></td></tr></table></figure></p><p>传统方式启动mysql<br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/<span class="keyword">local</span>/mysql/bin/mysqld_safe <span class="comment">--user=mysql</span></span><br></pre></td></tr></table></figure></p><p>查看MySQL端口<br><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -tnl <span class="string">| grep 3306</span></span><br></pre></td></tr></table></figure></p><p>制作成服务启动<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp support-files<span class="regexp">/mysql.server /</span>etc<span class="regexp">/init.d/my</span>sqld</span><br></pre></td></tr></table></figure></p><p>添加到开机启动项<br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig --<span class="keyword">add</span><span class="bash"> mysqld</span></span><br></pre></td></tr></table></figure></p><p>创建 Mysql 软连接<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -s <span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span>bin<span class="regexp">/mysql /u</span>sr<span class="regexp">/bin/</span></span><br><span class="line">ln -s <span class="regexp">/usr/</span>local<span class="regexp">/mysql/</span>bin<span class="regexp">/mysqladmin /u</span>sr<span class="regexp">/bin/</span></span><br></pre></td></tr></table></figure></p><p>修改 mysql 登陆   用户：root 密码：123456<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mysqladmin</span> -uroot -hlocalhost  password <span class="string">"123456"</span></span><br></pre></td></tr></table></figure></p><p>用 root登录 Mysql<br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">mysql</span> -uroot -hlocalhost -p123456</span><br></pre></td></tr></table></figure></p><p>Mysql 编译安装教程结束</p><p>小提示：如果root密码忘记了怎么办？？？<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">进入配置 my.cnf 文件 </span><br><span class="line">vim /etc/my.cnf</span><br><span class="line"></span><br><span class="line">添加以下内容并保存</span><br><span class="line">skip-grant-tables </span><br><span class="line"></span><br><span class="line">重启Mysql服务</span><br><span class="line">service mysqld restart</span><br><span class="line"></span><br><span class="line">直接不用密码登录</span><br><span class="line">mysql -uroot -hlocalhost -p#连续回车即可</span><br><span class="line"></span><br><span class="line">修改root 密码为123456</span><br><span class="line">update<span class="built_in"> user </span><span class="builtin-name">set</span> <span class="attribute">password</span>=password('123456') where <span class="attribute">user</span>=<span class="string">'root'</span>;</span><br><span class="line"></span><br><span class="line">更新用户表</span><br><span class="line">flush privileges;</span><br><span class="line"></span><br><span class="line">接着退出重启服务即可。</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> Mysql </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Service_Mysql </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>PHP_install_Parameter dependence</title>
      <link href="/2018/09/04/PHP-install-Parameter-dependence/"/>
      <url>/2018/09/04/PHP-install-Parameter-dependence/</url>
      
        <content type="html"><![CDATA[<p>PHP编译参数是需要安装的依赖。</p><a id="more"></a><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">configure: <span class="keyword">error</span>: jpeglib.h <span class="keyword">not</span> found.</span><br><span class="line">yum -y install libjpeg-devel</span><br></pre></td></tr></table></figure><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">configure: <span class="keyword">error</span>: png.h <span class="keyword">not</span> found.</span><br><span class="line">yum -y install libpng libpng-devel</span><br></pre></td></tr></table></figure><figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">configure</span>: error: free<span class="keyword">type</span>-config not found.</span><br><span class="line"><span class="title">yum</span> -y install free<span class="keyword">type</span>-devel</span><br></pre></td></tr></table></figure><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">configure:</span> <span class="string">error:</span> Cannot find ldap.h</span><br><span class="line">yum -y install openldap-devel openldap-servers openldap-clients</span><br></pre></td></tr></table></figure><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">configure:</span> <span class="string">error:</span> Please reinstall the mysql distribution</span><br><span class="line">yum -y install mysql mysql-server mysql-devel</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">configure:</span> <span class="attr">error:</span> <span class="literal">No</span> <span class="string">curses/termcap</span> <span class="string">library</span> <span class="string">found</span></span><br><span class="line"><span class="string">yum</span> <span class="bullet">-y</span> <span class="string">install</span> <span class="string">ncurses-devel</span></span><br></pre></td></tr></table></figure><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">configure: error: xml2-config<span class="built_in"> not </span>found. Please<span class="built_in"> check </span>your libxml2 installation.</span><br><span class="line">yum -y install libxml2 libxml2-devel</span><br></pre></td></tr></table></figure><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">configure:</span> <span class="string">error:</span> Cannot find OpenSSL’s</span><br><span class="line">yum -y install openssl-devel</span><br></pre></td></tr></table></figure><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">configure: <span class="built_in">error</span>: libjpeg.(a|so) <span class="keyword">not</span> found</span><br><span class="line">yum -y install <span class="built_in">gd</span> <span class="built_in">gd</span>-devel</span><br></pre></td></tr></table></figure><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">configure: <span class="built_in">error</span>: cannot <span class="built_in">find</span> <span class="built_in">output</span> from lex; giving up</span><br><span class="line">yum -y install flex</span><br></pre></td></tr></table></figure><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">configure:</span> error: mod_deflate has <span class="keyword">been </span>requested <span class="keyword">but </span>can not <span class="keyword">be </span><span class="keyword">built </span>due to prerequisite failures</span><br><span class="line">yum -y <span class="keyword">install </span>zlib-devel openssl-devel</span><br></pre></td></tr></table></figure><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">configure:</span> <span class="string">error:</span> …No recognized SSL/TLS toolkit detected</span><br><span class="line">yum -y install libssl-dev</span><br></pre></td></tr></table></figure><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">Configure:</span> error: Please reinstall the <span class="keyword">BZip2 </span><span class="keyword">distribution</span></span><br><span class="line"><span class="keyword">yum </span>-y <span class="keyword">install </span><span class="keyword">bzip2 </span><span class="keyword">bzip2-devel</span></span><br></pre></td></tr></table></figure><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">Configure:</span> <span class="string">error:</span> Please reinstall the libcurl distribution – easy.h should be <span class="keyword">in</span> <span class="regexp">/include/</span>curl/</span><br><span class="line">yum -y install curl curl-devel</span><br></pre></td></tr></table></figure><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Configure: <span class="keyword">error</span>: Unable <span class="keyword">to</span> locate gmp.h</span><br><span class="line">yum -y install gmp-devel</span><br></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Configure: error: Cannot <span class="builtin-name">find</span> MySQL header files under /usr.<span class="built_in"> Note </span>that the MySQL<span class="built_in"> client </span>library is <span class="keyword">not</span> bundled anymore!</span><br><span class="line">yum -y install mysql-devel</span><br></pre></td></tr></table></figure><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">configure:</span> <span class="string">error:</span> Please reinstall the ncurses distribution</span><br><span class="line">yum -y install ncurses ncurses-devel</span><br></pre></td></tr></table></figure><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Checking <span class="keyword">for</span> unixODBC support… configure: <span class="keyword">error</span>: <span class="keyword">ODBC</span> header <span class="keyword">file</span> ‘/usr/<span class="keyword">include</span>/sqlext.<span class="keyword">h</span>’ not found!</span><br><span class="line">yum -y install unixODBC-devel</span><br></pre></td></tr></table></figure><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">Configure:</span> <span class="string">error:</span> Cannot find pspell</span><br><span class="line">yum -y install pspell-devel</span><br></pre></td></tr></table></figure><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">configure: <span class="keyword">error</span>: mcrypt.h <span class="keyword">not</span> found. Please reinstall libmcrypt.</span><br><span class="line">yum -y install libmcrypt libmcrypt-devel</span><br></pre></td></tr></table></figure><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Configure: error: snmp.h <span class="keyword">not</span> found. Check your<span class="built_in"> SNMP </span>installation.</span><br><span class="line">yum -y install net-snmp net-snmp-devel</span><br></pre></td></tr></table></figure><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">开启LDAP服务还需要</span><br><span class="line">yum -y <span class="keyword">install</span> openldap-devel openldap-servers openldap-clients</span><br></pre></td></tr></table></figure><h3>以上均作参考,不是很全,如果你没找到的麻烦把你的报错用邮件发给我,我会及时处理并添加,谢谢</h3>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Service_PHP </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>PHP-install_Parameter description</title>
      <link href="/2018/09/04/PHP-install-Parameter-description/"/>
      <url>/2018/09/04/PHP-install-Parameter-description/</url>
      
        <content type="html"><![CDATA[<p>PHP 编译安装参数说明<br><a id="more"></a><br><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">./configure</span><br><span class="line">-<span class="ruby">-prefix=<span class="regexp">/usr/local</span><span class="regexp">/phpphp 安装目录 </span></span></span><br><span class="line"><span class="ruby">--with-apxs2=<span class="regexp">/usr/local</span><span class="regexp">/apache/bin</span><span class="regexp">/apxs    表示使用apache2.0以上版本，apxs表示使用的apache1.0版本</span></span></span><br><span class="line"><span class="ruby">--with-config-file-path=<span class="regexp">/usr/local</span><span class="regexp">/php/etc</span>               指定php.ini位置</span></span><br><span class="line"><span class="ruby">--with-MySQL=<span class="regexp">/usr/local</span><span class="regexp">/mysql                        mysql安装目录，对mysql的支持</span></span></span><br><span class="line"><span class="ruby">--with-MySQLi=<span class="regexp">/usr/local</span><span class="regexp">/mysql/bin</span><span class="regexp">/mysql_config            mysqli文件目录,优化支持</span></span></span><br><span class="line"><span class="ruby">--enable-safe-mode                                          打开安全模式</span></span><br><span class="line"><span class="ruby">--enable-ftp                                打开ftp的支持</span></span><br><span class="line"><span class="ruby">--enable-zip                               打开对zip的支持</span></span><br><span class="line"><span class="ruby">--with-bz2                                   打开对bz2文件的支持                       </span></span><br><span class="line"><span class="ruby">--with-jpeg-dir                                打开对jpeg图片的支持</span></span><br><span class="line"><span class="ruby">--with-png-dir                                 打开对png图片的支持</span></span><br><span class="line"><span class="ruby">--with-freetype-dir                              打开对freetype字体库的支持</span></span><br><span class="line"><span class="ruby">--without-iconv                                关闭iconv函数，种字符集间的转换</span></span><br><span class="line"><span class="ruby">--with-libXML-dir                                 打开libxml2库的支持</span></span><br><span class="line"><span class="ruby">--with-XMLrpc                                 打开xml-rpc的c语言</span></span><br><span class="line"><span class="ruby">--with-zlib-dir                                 打开zlib库的支持</span></span><br><span class="line"><span class="ruby">--with-gd                                    打开gd库的支持</span></span><br><span class="line"><span class="ruby">--enable-gd-native-ttf                           支持TrueType字符串函数库</span></span><br><span class="line"><span class="ruby">--with-curl                                   打开curl浏览工具的支持</span></span><br><span class="line"><span class="ruby">--with-curlwrappers                              运用curl工具打开url流</span></span><br><span class="line"><span class="ruby">--with-ttf                                    打开freetype1.*的支持，可以不加了</span></span><br><span class="line"><span class="ruby">--with-xsl 打开XSLT 文件支持，扩展了libXML2库 ，需要libxslt软件</span></span><br><span class="line"><span class="ruby">--with-gettext                                打开gnu 的gettext 支持，编码库用到</span></span><br><span class="line"><span class="ruby">--with-pear                      打开pear命令的支持，PHP扩展用的</span></span><br><span class="line"><span class="ruby">--enable-calendar                  打开日历扩展功能</span></span><br><span class="line"><span class="ruby">--enable-mbstring                  多字节，字符串的支持</span></span><br><span class="line"><span class="ruby">--enable-bcmath                  打开图片大小调整,用到zabbix监控的时候用到了这个模块</span></span><br><span class="line"><span class="ruby">--enable-sockets                  打开 sockets 支持</span></span><br><span class="line"><span class="ruby">--enable-exif                      图片的元数据支持</span></span><br><span class="line"><span class="ruby">--enable-magic-quotes               魔术引用的支持</span></span><br><span class="line"><span class="ruby">--disable-rpath                     关闭额外的运行库文件</span></span><br><span class="line"><span class="ruby">--disable-debug                  关闭调试模式</span></span><br><span class="line"><span class="ruby">--with-mime-magic=<span class="regexp">/usr/share</span><span class="regexp">/file/magic</span>.mime      魔术头文件位置</span></span><br></pre></td></tr></table></figure></p><p>CGI方式安装才用的参数<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">-enable-fpm                     打上PHP-fpm 补丁后才有这个参数，CGI方式安装的启动程序</span></span><br><span class="line"><span class="ruby">--enable-fastCGI                 支持fastcgi方式启动PHP</span></span><br><span class="line"><span class="ruby">--enable-force-CGI-redirect             同上 ,帮助里没有解释</span></span><br><span class="line"><span class="ruby">--with-ncurses                     支持ncurses 屏幕绘制以及基于文本终端的图形互动功能的动态库</span></span><br><span class="line"><span class="ruby">--enable-pcntl                     freeTDS需要用到的，可能是链接mssql 才用到</span></span><br></pre></td></tr></table></figure></p><p>mhash和mcrypt算法的扩展<br><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">-with-mcrypt                     算法</span></span><br><span class="line"><span class="ruby">--with-mhash                     算法</span></span><br></pre></td></tr></table></figure></p><figure class="highlight haml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-<span class="ruby">-with-gmp</span></span><br><span class="line"><span class="ruby">--enable-inline-optimization</span></span><br><span class="line"><span class="ruby">--with-openssl                     openssl的支持，加密传输时用到的</span></span><br><span class="line"><span class="ruby">--enable-dbase</span></span><br><span class="line"><span class="ruby">--with-pcre-dir=<span class="regexp">/usr/local</span><span class="regexp">/bin/pcre</span>-config      perl的正则库案安装位置</span></span><br><span class="line"><span class="ruby">--disable-dmalloc</span></span><br><span class="line"><span class="ruby">--with-gdbm                     dba的gdbm支持</span></span><br><span class="line"><span class="ruby">--enable-sigchild</span></span><br><span class="line"><span class="ruby">--enable-sysvsem</span></span><br><span class="line"><span class="ruby">--enable-sysvshm</span></span><br><span class="line"><span class="ruby">--enable-zend-multibyte               支持zend的多字节</span></span><br><span class="line"><span class="ruby">--enable-mbregex</span></span><br><span class="line"><span class="ruby">--enable-wddx</span></span><br><span class="line"><span class="ruby">--enable-shmop</span></span><br><span class="line"><span class="ruby">--enable-soap</span></span><br></pre></td></tr></table></figure><p>较全的PHP扩展实例:<br><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">./configure</span> <span class="params">--prefix=/usr/local/php</span> <span class="params">--with-config-file-path=/usr/local/php/etc</span> <span class="params">--with-mysql=/usr/local/mysql</span> <span class="params">--with-mysqli=/usr/bin/mysql_config</span> \</span><br><span class="line"><span class="params">--with-iconv-dir=/usr/local</span> <span class="params">--with-freetype-dir</span> <span class="params">--with-jpeg-dir</span> <span class="params">--with-png-dir</span> <span class="params">--with-zlib</span> <span class="params">--with-libxml-dir=/usr</span> <span class="params">--enable-xml</span> \</span><br><span class="line"><span class="params">--disable-rpath</span> <span class="params">--enable-discard-path</span> <span class="params">--enable-safe-mode</span> <span class="params">--enable-bcmath</span> <span class="params">--enable-shmop</span> <span class="params">--enable-sysvsem</span> <span class="params">--enable-inline-optimization</span> \</span><br><span class="line"><span class="params">--with-curl</span> <span class="params">--with-curlwrappers</span> <span class="params">--enable-mbregex</span> <span class="params">--enable-fastcgi</span> <span class="params">--enable-fpm</span> <span class="params">--enable-force-cgi-redirect</span> <span class="params">--enable-mbstring</span> <span class="params">--with-mcrypt</span> \</span><br><span class="line"><span class="params">--with-gd</span> <span class="params">--enable-gd-native-ttf</span> <span class="params">--with-openssl</span> <span class="params">--with-mhash</span> <span class="params">--enable-pcntl</span> <span class="params">--enable-sockets</span> <span class="params">--with-ldap</span> <span class="params">--with-ldap-sasl</span> <span class="params">--with-xmlrpc</span> \</span><br><span class="line"><span class="params">--enable-zip</span> <span class="params">--enable-soap</span> <span class="params">--without-pear</span> <span class="params">--with-zlib</span> <span class="params">--enable-pdo</span> <span class="params">--with-pdo-mysql</span> <span class="params">--with-mysql</span></span><br></pre></td></tr></table></figure></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#mysqli扩展技术不仅可以调用MySQL的存储过程、处理MySQL事务，而且还可以使访问数据库工作变得更加稳定。 </span></span><br><span class="line"><span class="attribute">make</span> ZEND_EXTRA_LIBS=<span class="string">'-liconv'</span></span><br></pre></td></tr></table></figure><p>我自己编译安装时用的是如下:<br><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">./configure</span> <span class="params">--prefix=/usr/local/php</span> <span class="params">--with-config-file-path=/usr/local/php/etc</span> <span class="params">--with-mysql=/usr/local/mysql</span> <span class="params">--with-mysqli=/usr/bin/mysql_config</span> \</span><br><span class="line"><span class="params">--with-iconv-dir=/usr/local</span> <span class="params">--with-freetype-dir</span> <span class="params">--with-jpeg-dir</span> <span class="params">--with-png-dir</span> <span class="params">--with-zlib</span> <span class="params">--with-libxml-dir</span> =<span class="string">/usr</span> <span class="params">--enable-xml</span> <span class="params">--disable</span> -rpath \</span><br><span class="line"><span class="params">--enable-bcmath</span> <span class="params">--enable-shmop</span> <span class="params">--enable-sysvsem</span> <span class="params">--enable-inline-optimization</span> <span class="params">--with-curl</span> <span class="params">--enable-mbregex</span> <span class="params">--enable-fpm</span> <span class="params">--enable-mbstring</span> \</span><br><span class="line"><span class="params">--with-mcrypt</span> <span class="params">--with-gd</span> <span class="params">--enable</span> -gd-native-ttf <span class="params">--with-openssl</span> <span class="params">--with-mhash</span> <span class="params">--enable-pcntl</span> <span class="params">--enable-sockets</span> <span class="params">--with-ldap</span> - -with-ldap-sasl \</span><br><span class="line"><span class="params">--with-xmlrpc</span> <span class="params">--enable-zip</span> <span class="params">--enable-soap</span> <span class="params">--without-pear</span> <span class="params">--with-zlib</span> <span class="params">--enable-pdo</span> <span class="params">--with-pdo-mysql</span> <span class="params">--with-mysql</span></span><br></pre></td></tr></table></figure></p><h3>以上参数均提供参考</h3>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Service_PHP </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>PHP-5.6.37_install</title>
      <link href="/2018/09/04/Service_PHP-5-6-37_install/"/>
      <url>/2018/09/04/Service_PHP-5-6-37_install/</url>
      
        <content type="html"><![CDATA[<p>PHP编译安装,方便扩展，优点较多。</p><a id="more"></a><p>下载PHP5.6.37,也可以去网站找到你需要安装的版本。这里安装的是5.6版本<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://<span class="number">101.110</span><span class="meta">.118</span><span class="meta">.22</span>/cn2.php.net/distributions/php-<span class="number">5.6</span><span class="meta">.37</span>.tar.gz</span><br></pre></td></tr></table></figure></p><p><li>安装PHP插件依赖</li></p><p><li>添加epel源</li><br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -Uvh http:<span class="regexp">//</span>dl.fedoraproject.org<span class="regexp">/pub/</span>epel<span class="regexp">/6/</span>x86_64<span class="regexp">/epel-release-6-8 .noarch.rpm</span></span><br></pre></td></tr></table></figure></p><p><li>安装PHP参数需要的依赖包</li><br><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">yum -y install libjpeg-devel <span class="string">\</span> </span><br><span class="line">libpng libpng-devel <span class="string">\</span> </span><br><span class="line">libfreetype-devel freetype-devel <span class="string">\</span> </span><br><span class="line">openldap-devel openldap-servers openldap-clients <span class="string">\</span> </span><br><span class="line">mysql mysql-server mysql-devel</span><br></pre></td></tr></table></figure></p><p>解压tar包<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">tar</span> <span class="selector-tag">-zxvf</span> <span class="selector-tag">php-5</span><span class="selector-class">.6</span><span class="selector-class">.37</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span>  #解压<span class="selector-tag">tar</span>包</span><br><span class="line"><span class="selector-tag">cd</span> <span class="selector-tag">php-5</span><span class="selector-class">.6</span><span class="selector-class">.37</span></span><br></pre></td></tr></table></figure></p><p>安装，编译，编译安装<br><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">./configure</span> <span class="params">--prefix=/usr/local/php</span> <span class="params">--with-config-file-path=/usr/local/php/etc</span> <span class="params">--with-mysql=/usr/local/mysql</span> <span class="params">--with-mysqli=/usr/bin/mysql_config</span> \</span><br><span class="line"><span class="params">--with-iconv-dir=/usr/local</span> <span class="params">--with-freetype-dir</span> <span class="params">--with-jpeg-dir</span> <span class="params">--with-png-dir</span> <span class="params">--with-zlib</span> <span class="params">--with-libxml-dir=/usr</span> <span class="params">--enable-xml</span> <span class="params">--disable</span> -rpath \</span><br><span class="line"><span class="params">--enable-bcmath</span> <span class="params">--enable-shmop</span> <span class="params">--enable-sysvsem</span> <span class="params">--enable-inline-optimization</span> <span class="params">--with-curl</span> <span class="params">--enable-mbregex</span> <span class="params">--enable-fpm</span> <span class="params">--enable-mbstring</span> \</span><br><span class="line"><span class="params">--with-mcrypt</span> <span class="params">--with-gd</span> <span class="params">--enable</span> -gd-native-ttf <span class="params">--with-openssl</span> <span class="params">--with-mhash</span> <span class="params">--enable-pcntl</span> <span class="params">--enable-sockets</span> <span class="params">--with-ldap</span> <span class="params">--with-ldap-sasl</span> \</span><br><span class="line"><span class="params">--with-xmlrpc</span> <span class="params">--enable-zip</span> <span class="params">--enable-soap</span> <span class="params">--without-pear</span> <span class="params">--with-zlib</span> <span class="params">--enable-pdo</span> <span class="params">--with-pdo-mysql</span> <span class="params">--with-mysql</span></span><br><span class="line"></span><br><span class="line">make </span><br><span class="line">make install</span><br></pre></td></tr></table></figure></p><p>创建PHP软连接<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s <span class="regexp">/usr/</span>local<span class="regexp">/php/</span>bin<span class="regexp">/php  /u</span>sr<span class="regexp">/bin/</span></span><br></pre></td></tr></table></figure></p><p>查看编译安装时的参数<br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">php -i</span></span><br></pre></td></tr></table></figure></p><p>配置php-fpm管理php</p><p><li>编辑<code>php-fpm.conf</code>文件</li><br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">将; pid = <span class="keyword">run</span><span class="bash">/php-fpm.pid前面的分号去掉</span></span><br></pre></td></tr></table></figure></p><p><li>进入php解压目录也可查找<code>find / -name init.d.php-fpm</code> </li><br><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd php<span class="number">-5.6</span><span class="number">.37</span>/sapi/fpm</span><br></pre></td></tr></table></figure></p><p><li>拷贝系统启动文件</li><br><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp init<span class="selector-class">.d</span><span class="selector-class">.php-fpm</span> /etc/init.d/php-fpm</span><br></pre></td></tr></table></figure></p><p><li>给启动文件赋予执行权限</li><br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod +x <span class="regexp">/etc/i</span>nit.d<span class="regexp">/php-fpm</span></span><br></pre></td></tr></table></figure></p><p><li>启动服务</li><br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">php-fpm</span></span><br></pre></td></tr></table></figure></p><p><li>关闭服务</li><br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php-fpm <span class="built_in">stop</span></span><br></pre></td></tr></table></figure></p><p><li>重启服务</li><br><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">php-fpm restart</span></span><br></pre></td></tr></table></figure></p><p><li>添加到开机启动列表</li><br><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig --<span class="keyword">add</span><span class="bash"> php-fpm</span></span><br></pre></td></tr></table></figure></p><p><li>设置开机自启</li><br><figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chkconfig php-fpm <span class="keyword">on</span></span><br></pre></td></tr></table></figure></p><p><li>设置开机不自启</li><br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">chkconfig</span> php-fpm <span class="literal">off</span></span><br></pre></td></tr></table></figure></p><p></p><h3>以上是PHP编译安装及PHP-FPM管理步骤</h3>]]></content>
      
      
      <categories>
          
          <category> PHP </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Service_PHP </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Service_Nginx_1.12.2_install</title>
      <link href="/2018/09/03/Service-Nginx-1-12-2-install/"/>
      <url>/2018/09/03/Service-Nginx-1-12-2-install/</url>
      
        <content type="html"><![CDATA[<p>Nginx 1.12.2编译安装<br><a id="more"></a><br>系统环境<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">OS    :Red Hat Enterprise Linux<span class="built_in"> Server </span>release 7.2 (Maipo)</span><br><span class="line">Kernel:3.10.0-327.el7.x86_64</span><br></pre></td></tr></table></figure></p><p>关闭防火墙和SELINUX<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Selinux：</span><br><span class="line">setenforce 0  宽松模式</span><br><span class="line">sed -i <span class="string">"s/enforcing/disabled/g"</span>  /etc/selinux<span class="built_in">/config </span>  永久关闭</span><br><span class="line">Firewalld：</span><br><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl <span class="builtin-name">disable</span> firewalld</span><br></pre></td></tr></table></figure></p><p>下载Nginx 1.12.2源码包<br><a href="https://soliton.net.cn/download/linux/nginx-1.12.2.tar.gz" target="_blank" rel="noopener">Nginx1.12.2</a><br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https:<span class="regexp">//</span>soliton.net.cn<span class="regexp">/download/</span>linux<span class="regexp">/nginx-1.12.2.tar.gz</span></span><br></pre></td></tr></table></figure></p><p>安装nginx 依赖<br><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y pcre pcre-devel openssl openssl-devel <span class="literal">zlib</span> <span class="literal">zlib</span>-devel</span><br></pre></td></tr></table></figure></p><p>创建用户<br><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">useradd</span> -s /<span class="keyword">bin/nologin </span>-M nginx</span><br></pre></td></tr></table></figure></p><p>Nginx源码解包<br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">tar</span> <span class="selector-tag">zxvf</span> <span class="selector-tag">nginx-1</span><span class="selector-class">.12</span><span class="selector-class">.2</span><span class="selector-class">.tar</span><span class="selector-class">.gz</span></span><br></pre></td></tr></table></figure></p><p>安装<br><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">./configure</span>  <span class="params">--prefix=/usr/local/nginx</span> <span class="params">--pid-path=/usr/local/nginx/run/nginx</span>.pid <span class="params">--with-http_ssl_module</span> <span class="params">--user=nginx</span> <span class="params">--group=nginx</span> <span class="params">--with-pcre</span> <span class="params">--without-mail_pop3_module</span> <span class="params">--without-mail_imap_module</span> <span class="params">--without-mail_smtp_module</span> <span class="params">--with-http_realip_module</span></span><br></pre></td></tr></table></figure></p><p>编译并编译安装<br><figure class="highlight gauss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">make</span> -j <span class="number">4</span> &amp;&amp; <span class="built_in">make</span> install</span><br></pre></td></tr></table></figure></p><p>创建nginx软连接<br><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s <span class="regexp">/usr/</span>local<span class="regexp">/nginx/</span>sbin<span class="regexp">/nginx /u</span>sr<span class="regexp">/bin/</span></span><br></pre></td></tr></table></figure></p><p>复制nginx.conf<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mv /usr/<span class="keyword">local</span>/nginx/<span class="keyword">conf</span>/nginx.<span class="keyword">conf</span>   /usr/<span class="keyword">local</span>/nginx/<span class="keyword">conf</span>/nginx.<span class="keyword">conf</span>,bak</span><br></pre></td></tr></table></figure></p><p>创建nginx.conf<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/<span class="keyword">local</span>/nginx/<span class="keyword">conf</span>/nginx.<span class="keyword">conf</span></span><br></pre></td></tr></table></figure></p><p><a href="https://www.soliton.wang/2018/09/01/Nginx-conf/index.html">查看nginx.conf</a></p><p>创建 vhost目录<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">mkdir</span>  /usr/<span class="keyword">local</span>/nginx/<span class="keyword">conf</span>/vhost</span><br></pre></td></tr></table></figure></p><p>创建web主目录<br><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> -p /<span class="built_in">home</span>/www/ceshi</span><br></pre></td></tr></table></figure></p><p>启动服务<br><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nginx</span><br><span class="line">nginx -s <span class="keyword">reload</span>  重启服务</span><br></pre></td></tr></table></figure></p><p>配置开机自启</p><p><ul>创建nginx服务<br><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">vim  /usr/<span class="class"><span class="keyword">lib</span>/<span class="title">systemd</span>/<span class="title">system</span>/<span class="title">nginx</span>.<span class="title">service</span></span></span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=nginx</span><br><span class="line">After=network.target</span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=<span class="regexp">/usr/local</span><span class="regexp">/nginx/sbin</span><span class="regexp">/nginx</span></span><br><span class="line"><span class="regexp">ExecReload=/usr</span><span class="regexp">/local/nginx</span><span class="regexp">/sbin/nginx</span> -s reload</span><br><span class="line">ExecStop=<span class="regexp">/usr/local</span><span class="regexp">/nginx/sbin</span><span class="regexp">/nginx -s quit</span></span><br><span class="line"><span class="regexp">PrivateTmp=true</span></span><br><span class="line"><span class="regexp">[Install]</span></span><br><span class="line"><span class="regexp">WantedBy=multi-user.target</span></span><br></pre></td></tr></table></figure></ul></p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl start<span class="regexp">/stop/</span>restart nginx  <span class="regexp">//</span>启动<span class="regexp">/关闭/</span>重启服务</span><br><span class="line">systemctl enable<span class="regexp">/disable nginx      /</span><span class="regexp">/开机启动/</span>不启动</span><br></pre></td></tr></table></figure><p></p><h3>Nginx编译安装教程结束<p></p></h3>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> -Service_Nginx </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Nginx.conf</title>
      <link href="/2018/09/01/Nginx-conf/"/>
      <url>/2018/09/01/Nginx-conf/</url>
      
        <content type="html"><![CDATA[<p>nginx主配置文件<br><a id="more"></a><br><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">user</span>  nginx nginx;</span><br><span class="line"></span><br><span class="line"><span class="attribute">worker_processes</span> auto;</span><br><span class="line"><span class="attribute">worker_cpu_affinity</span> auto;</span><br><span class="line"></span><br><span class="line"><span class="comment">#error_log  logs/nginx_error.log crit;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#pid        logs/nginx.pid;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Specifies the value for maximum file descriptors that can be opened by this process.</span></span><br><span class="line"><span class="attribute">worker_rlimit_nofile</span> <span class="number">51200</span>;</span><br><span class="line"></span><br><span class="line">events</span><br><span class="line">&#123;</span><br><span class="line"><span class="attribute">use</span> <span class="literal">epoll</span>;</span><br><span class="line"><span class="attribute">worker_connections</span> <span class="number">51200</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http</span><br><span class="line">&#123;</span><br><span class="line"><span class="attribute">include</span>       mime.types;</span><br><span class="line"><span class="attribute">default_type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attribute">server_tokens</span> <span class="literal">off</span>;</span><br><span class="line"><span class="attribute">server_names_hash_bucket_size</span> <span class="number">128</span>;</span><br><span class="line"><span class="attribute">client_header_buffer_size</span> <span class="number">32k</span>;</span><br><span class="line"><span class="attribute">large_client_header_buffers</span> <span class="number">4</span> <span class="number">32k</span>;</span><br><span class="line"><span class="attribute">client_max_body_size</span> <span class="number">100m</span>;</span><br><span class="line"></span><br><span class="line"><span class="attribute">sendfile</span> <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">tcp_nopush</span>     <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line"><span class="attribute">keepalive_timeout</span> <span class="number">60</span>;</span><br><span class="line"></span><br><span class="line"><span class="attribute">tcp_nodelay</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line"><span class="attribute">fastcgi_connect_timeout</span> <span class="number">300</span>;</span><br><span class="line"><span class="attribute">fastcgi_send_timeout</span> <span class="number">300</span>;</span><br><span class="line"><span class="attribute">fastcgi_read_timeout</span> <span class="number">300</span>;</span><br><span class="line"><span class="attribute">fastcgi_buffer_size</span> <span class="number">64k</span>;</span><br><span class="line"><span class="attribute">fastcgi_buffers</span> <span class="number">4</span> <span class="number">64k</span>;</span><br><span class="line"><span class="attribute">fastcgi_busy_buffers_size</span> <span class="number">128k</span>;</span><br><span class="line"><span class="attribute">fastcgi_temp_file_write_size</span> <span class="number">256k</span>;</span><br><span class="line"><span class="attribute">fastcgi_intercept_errors</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line"><span class="attribute">gzip</span> <span class="literal">on</span>;</span><br><span class="line"><span class="attribute">gzip_min_length</span>  <span class="number">1k</span>;</span><br><span class="line"><span class="attribute">gzip_buffers</span>     <span class="number">4</span> <span class="number">16k</span>;</span><br><span class="line"><span class="attribute">gzip_http_version</span> <span class="number">1</span>.<span class="number">0</span>;</span><br><span class="line"><span class="attribute">gzip_comp_level</span> <span class="number">2</span>;</span><br><span class="line"><span class="attribute">gzip_types</span>       text/plain application/x-javascript text/css application/xml;</span><br><span class="line"><span class="attribute">gzip_vary</span> <span class="literal">on</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#limit_zone  crawler  $binary_remote_addr  10m;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#log format</span></span><br><span class="line"><span class="attribute">log_format</span>  access  <span class="string">'<span class="variable">$remote_addr</span> - <span class="variable">$remote_user</span> [<span class="variable">$time_local</span>] "<span class="variable">$request</span>" '</span></span><br><span class="line">             <span class="string">'<span class="variable">$status</span> <span class="variable">$body_bytes_sent</span> "<span class="variable">$http_referer</span>" '</span></span><br><span class="line">             <span class="string">'"<span class="variable">$http_user_agent</span>" <span class="variable">$http_x_forwarded_for</span>'</span>;</span><br><span class="line"><span class="section">server</span> &#123;  </span><br><span class="line">      <span class="attribute">listen</span> <span class="number">80</span> default;  </span><br><span class="line">      <span class="attribute">return</span> <span class="number">500</span>;  </span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attribute">include</span> vhost/<span class="regexp">*.conf</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> Nginx </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Service_Nginx </tag>
            
        </tags>
      
    </entry>
    
  
  
</search>
